import{c as g,u as v,e as _,r as s,b as h,j as c}from"./index-DD5PpQvG.js";import{a as S,b as I}from"./api-BUyL__Lx.js";import b from"./Invoice-CNk0WlyW.js";import{u as j}from"./DefaultLayout-CqqVRJ58.js";/* empty css                */import"./index.esm-Cf16sf0V.js";import"./ChargeTypeModal-CK3JRfYq.js";import"./CForm-DHMglVb5.js";import"./CFormLabel-nywbXjJ8.js";import"./CFormInput-Cn6Oxe7f.js";import"./CFormControlWrapper-BZBLkUPy.js";import"./CFormControlValidation-CeKcElbP.js";import"./CFormCheck-Zn8UkK2E.js";import"./NewCustomerModal-C-xR4-MF.js";import"./CCardBody-DIaUAcaG.js";import"./CCardHeader-xDb1sBm5.js";import"./CInputGroup-CSjvk1Va.js";import"./CInputGroupText-3BZXwTrk.js";import"./cil-search-CDkY_4k-.js";import"./cil-x-0440B5Ce.js";import"./cil-check-circle-BlU9eaow.js";import"./cil-location-pin-CQr6GRP7.js";import"./CFormSelect-BN9mb7wv.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-BpBLObvv.js";import"./CNavItem-BzisaWd0.js";const Z=()=>{const{id:a}=g(),m=v(),d=_(),i=new URLSearchParams(d.search).get("convertTo"),[l,p]=s.useState(null),[u,f]=s.useState(!0),[y,T]=s.useState(!1),{showToast:r}=h(),{t:o}=j("global");s.useEffect(()=>{(async()=>{try{const t=await S(`/api/order/${a}`);console.log("Fetched order:",t),t?(p({projectId:t.project_id||null,projectName:t.customer_name||"N/A",customer_id:t.id||null,customer:{name:t.customer_name||"Unknown",address:t.address||"N/A",mobile:t.mobile_number||"N/A"},lat:t.lat||"",long:"",payLater:t.payLater||!1,isSettled:t.isSettled||!1,invoiceDate:t.invoiceDate,deliveryTime:t.deliveryTime||"",deliveryDate:t.deliveryDate,invoiceType:i?parseInt(i):t.invoiceType||3,items:(t.items||[]).map(e=>({work_type:e.work_type||"",qty:e.qty||0,price:e.price||0,total_price:e.total_price||0,remark:e.remark||null})),orderStatus:i?parseInt(i):t.orderStatus,totalAmount:t.totalAmount||0,discount:t.discount||0,balanceAmount:t.finalAmount-t.paidAmount,paidAmount:t.paidAmount||0,finalAmount:t.finalAmount||0,paymentType:t.paymentType||0}),T(!0)):r("danger","No order data found")}catch(t){console.error("Fetch order error:",t),r("danger",o("TOAST.fetch_order_failed"))}finally{f(!1)}})()},[a,i,r,o]);const A=async n=>{try{const t={...n,id:a,project_id:n.projectId,remainingBalance:n.finalAmount-n.paidAmount};console.log("Updating order:",t);const e=await I(`/api/order/${a}`,t);e!=null&&e.success?(r("success",o("TOAST.order_updated")),m(`/invoice-details/${a}`)):r("danger",(e==null?void 0:e.message)||o("TOAST.update_failed"))}catch(t){console.error("Update error:",t),r("danger",o("TOAST.update_error"))}};return u||!y?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(b,{editMode:!0,initialData:l,onSubmit:A})};export{Z as default};
