import{b as k,r as h,j as e}from"./index-Bp6YZ4a_.js";import{p as N,a as v}from"./api-BUyL__Lx.js";import{a as E,b as L,c as A,d as M,e as S}from"./DefaultLayout-Cl1ShzgU.js";import{C as F}from"./CForm-B0Or3puF.js";import{a as T,b as u,d as y}from"./index.esm-CYpkJS97.js";import{C as d}from"./CFormLabel-D4tkwmcW.js";import{C as _}from"./CFormInput-Bho2i8i0.js";const R=({visible:b,onClose:p,onSuccess:j,initialName:g=""})=>{const{showToast:s}=k(),[x,C]=h.useState(!1),[t,l]=h.useState({customer_name:"",mobile_number:"",gst_number:"",work_place:""});h.useEffect(()=>{b&&l(m=>({...m,customer_name:g||"",mobile_number:"",gst_number:"",work_place:""}))},[b,g]);const i=m=>{const{name:a,value:n}=m.target;if(a==="mobile_number"){const o=n.replace(/\D/g,"");if(o.length>10)return;l(c=>({...c,mobile_number:o}));return}if(a==="gst_number"){if(n.length>15)return;l(o=>({...o,gst_number:n}));return}l(o=>({...o,[a]:n}))},f=async m=>{if(m.preventDefault(),!t.customer_name.trim()){s("danger","Customer name is required");return}if(!t.mobile_number||!/^[6-9]\d{9}$/.test(t.mobile_number)){s("danger","Please enter a valid 10-digit mobile number");return}if(!t.work_place.trim()){s("danger","Location field is required");return}try{C(!0);const a={customer_name:t.customer_name,mobile_number:t.mobile_number,gst_number:t.gst_number||"",work_place:t.work_place||"",project_name:"",project_cost:"",supervisor_id:"",commission:"",start_date:"",end_date:"",is_visible:!0,remark:"",operator_id:[""],machine_id:[]};await N("/api/projects",a);let n=null;try{const o=await v(`/api/projects?searchQuery=${encodeURIComponent(t.customer_name)}`),c=Array.isArray(o)?o:o==null?void 0:o.data;if(c&&Array.isArray(c)){const w=c.map(r=>({id:r.id,project_name:r.project_name||"Unknown Project",customer_name:r.customer_name||"Unknown Customer",work_place:r.work_place||"",project_cost:r.project_cost||"0",mobile_number:r.mobile_number||"",gst_number:r.gst_number||"",remark:r.remark||"",customer_id:r.customer_id||r.id,customer:{name:r.customer_name||"Unknown",address:r.work_place||"N/A",mobile:r.mobile_number||"N/A"}})).filter(r=>r.project_name);n=w.find(r=>r.customer_name.toLowerCase()===t.customer_name.toLowerCase()&&r.mobile_number===t.mobile_number)||w[0]||null}}catch(o){console.error("Error fetching newly created customer project:",o)}j?j(n):s("success","Customer added successfully"),p()}catch(a){console.error("Error adding customer:",a),s("danger","Failed to add customer")}finally{C(!1)}};return e.jsxs(E,{visible:b,onClose:p,children:[e.jsx(L,{closeButton:!0,children:e.jsx(A,{children:"Add New Customer"})}),e.jsx(M,{children:e.jsx(F,{onSubmit:f,children:e.jsxs(T,{className:"g-3",children:[e.jsxs(u,{md:12,children:[e.jsxs(d,{children:["Customer Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"text",name:"customer_name",value:t.customer_name,onChange:i,placeholder:"Enter Customer Name...",required:!0})]}),e.jsxs(u,{md:12,children:[e.jsxs(d,{children:["Mobile Number ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"text",name:"mobile_number",value:t.mobile_number,onChange:i,placeholder:"Enter Customer Mobile...",maxLength:10,required:!0})]}),e.jsxs(u,{md:12,children:[e.jsx(d,{children:"GST Number (Optional)"}),e.jsx(_,{type:"text",name:"gst_number",value:t.gst_number,onChange:i,placeholder:"Enter GST number...",maxLength:15})]}),e.jsxs(u,{md:12,children:[e.jsxs(d,{children:["Location ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"text",name:"work_place",value:t.work_place,onChange:i,placeholder:"Enter Location..."})]})]})})}),e.jsxs(S,{children:[e.jsx(y,{color:"secondary",variant:"outline",onClick:p,children:"Cancel"}),e.jsx(y,{color:"primary",onClick:f,disabled:x,children:x?"Saving...":"Save Customer"})]})]})};export{R as N};
