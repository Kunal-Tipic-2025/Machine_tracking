import{r as a,u as I,j as r,k as q,l as B,m as P}from"./index-Bp6YZ4a_.js";import{e as O,g as G,a as D,p as M}from"./api-BUyL__Lx.js";import{C as H,a as R}from"./CCardBody-CqLGfd9F.js";import{C as Y}from"./CCardHeader-JJf0C1sG.js";import{C as N}from"./RawMaterial-DQRsRjmM.js";import{C as $}from"./CForm-B0Or3puF.js";import{b as l,d as T}from"./index.esm-CYpkJS97.js";import{C as p}from"./CFormLabel-D4tkwmcW.js";import{C as h}from"./CFormInput-Bho2i8i0.js";import"./CFormControlWrapper-CHuDwT-y.js";import"./CFormControlValidation-6izUS8cV.js";const oe=()=>{const[s,j]=a.useState({customer_name:"",mobile_number:"",project_name:"",project_cost:"",supervisor_id:"",work_place:"",commission:"",start_date:"",end_date:"",is_visible:!0,remark:"",gst_number:"",operator_id:[""]}),[i,c]=a.useState({}),[C,_]=a.useState(""),[z,b]=a.useState([]),[J,L]=a.useState([]),[y,d]=a.useState(!1),[g,v]=a.useState([]),w=I(),k=O(),f=G(),x=f==null?void 0:f.id;a.useEffect(()=>{k===2&&x&&j(e=>({...e,supervisor_id:x})),F()},[k,x]),a.useEffect(()=>{U()},[]);const U=async()=>{try{const e=await D("/api/appUsers");console.log("All the users from users:",e.data);const t=e.data.filter(n=>n.type===2);console.log("Filtered users (type = 2):",t),L(t)}catch(e){console.error("Error fetching Users:",e),E("danger","Error fetching Users")}},F=async()=>{try{const e=await D("/api/usersData");b((e==null?void 0:e.users)||[])}catch(e){console.error("Error fetching users:",e),b([])}},m=e=>{const{name:t,value:n,type:u,checked:o}=e.target;j({...s,[t]:u==="checkbox"?o:n})},A=async e=>{var t,n,u;if(e.preventDefault(),c({}),_(""),d(!0),s.end_date&&s.start_date&&new Date(s.end_date)<new Date(s.start_date)){c({end_date:"End date must be after or equal to start date."}),d(!1);return}if(!s.work_place||s.work_place.trim()===""){c({work_place:"Location is required."}),d(!1);return}try{const S={...s,machine_id:[]};console.log("formData payload:",S),await M("/api/projects",S),_("Project created successfully!"),w("/project")}catch(o){console.error("Error creating project:",o),(t=o.response)!=null&&t.data.errors?c(o.response.data.errors):c({general:((u=(n=o.response)==null?void 0:n.data)==null?void 0:u.message)||"Failed to create project."})}finally{d(!1)}},E=(e,t)=>{v([...g,{color:e,message:t,id:Date.now()}])};return r.jsxs("div",{className:"container-lg p-2",children:[r.jsxs(H,{children:[r.jsx(Y,{children:"Add New Customer"}),r.jsxs(R,{children:[C&&r.jsx(N,{color:"success",children:C}),i.general&&r.jsx(N,{color:"danger",children:i.general}),r.jsx($,{onSubmit:A,children:r.jsxs("div",{className:"row g-3",children:[r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Customer Name"}),r.jsx(h,{type:"text",name:"customer_name",value:s.customer_name,onChange:m,required:!0,placeholder:"Enter Customer Name..."})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Customer Mobile Number"}),r.jsx(h,{type:"text",name:"mobile_number",value:s.mobile_number,onChange:e=>{const t=e.target.value.replace(/\D/g,"");t.length<=10&&m({target:{name:"mobile_number",value:t}})},onBlur:e=>{const t=e.target.value;t&&!/^[6-9]\d{9}$/.test(t)&&E("danger","Please enter a valid 10-digit mobile number.")},required:!0,maxLength:10,minLength:10,placeholder:"Enter Customer Mobile..."})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"GST Number (Optional)"}),r.jsx(h,{type:"text",name:"gst_number",value:s.gst_number,onChange:m,placeholder:"Enter GST number...",maxLength:15})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Location"}),r.jsx(h,{type:"text",name:"work_place",value:s.work_place,onChange:m,placeholder:"Enter Your Location...",invalid:!!i.work_place,feedback:i.work_place})]}),r.jsxs(l,{xs:12,children:[r.jsx(T,{type:"submit",color:"primary",disabled:y,children:y?"Submitting...":"Add Customer"}),r.jsx(T,{type:"button",color:"secondary",className:"ms-2",onClick:()=>w("/project"),children:"Cancel"})]})]})})]})]}),r.jsx(q,{placement:"top-end",children:g.map(e=>r.jsx(B,{autohide:!0,visible:!0,color:e.color,className:"text-white",delay:3e3,onClose:()=>v(g.filter(t=>t.id!==e.id)),children:r.jsx(P,{children:e.message})},e.id))})]})};export{oe as default};
