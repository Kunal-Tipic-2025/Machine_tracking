import{r as a,u as W,b as X,j as e}from"./index-Bp6YZ4a_.js";import{a as A,b as Z,d as ee}from"./api-BUyL__Lx.js";import{C as se}from"./ConfirmationModal-Fr2AYT2X.js";import te from"./addQty-qmcX_v_a.js";import{C as ae,a as le}from"./CCardBody-CqLGfd9F.js";import{C as re}from"./CCardHeader-JJf0C1sG.js";import{C as D}from"./CFormSelect-Dyi_UavP.js";import{d as r,a as E,b as j}from"./index.esm-CYpkJS97.js";import{a as ne,b as oe,c as ce,d as ie,e as de}from"./DefaultLayout-Cl1ShzgU.js";import{C as x}from"./CFormLabel-D4tkwmcW.js";import{C as F}from"./CFormInput-Bho2i8i0.js";import"./Feilds-DKJTpBq7.js";import"./CFormCheck-CLKjKTIZ.js";import"./CFormControlValidation-6izUS8cV.js";import"./CFormControlWrapper-CHuDwT-y.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-DQRsRjmM.js";import"./CNavItem-DIKN9LSg.js";const Pe=()=>{const[u,R]=a.useState([]),[p,L]=a.useState([]),[z,C]=a.useState(!1),[f,g]=a.useState(null),[n,M]=a.useState({name:"",local_name:"",project_id:"",current_stock:""}),Q=W(),{showToast:i}=X(),V=async()=>{try{const s=await A("/api/myProjects");L(s||[])}catch(s){console.error("Error fetching projects",s)}},o=async(s="")=>{try{let t="/api/index";s&&(t+=`?project_id=${s}`);const l=await A(t);R(l.materials||[])}catch(t){console.error("Error fetching raw materials",t)}};a.useEffect(()=>{o(),V()},[]);const I=s=>{var l;const t=((l=s.logs)==null?void 0:l[0])||{};g(s),M({name:s.name||"",local_name:s.local_name||"",project_id:t.project_id||"",current_stock:t.current_stock||""}),C(!0)},d=()=>{C(!1),g(null)},h=s=>{M({...n,[s.target.name]:s.target.value})},T=async()=>{if(f)try{await Z(`/api/rawMaterial/${f.id}`,n),i("success","Material updated successfully!"),d(),o()}catch{i("danger","Failed to update material")}},[$,m]=a.useState(!1),[c,b]=a.useState(null),B=s=>{b(s),m(!0)},U=async()=>{if(c)try{await ee(`/api/rawMaterial/${c.id}`)&&(i("success","Material deleted successfully!"),o())}catch{i("danger","Failed to delete the material.")}finally{m(!1),b(null)}},[H,y]=a.useState(!1),[Y,q]=a.useState(null),G=s=>{q(s),y(!0)},[J,K]=a.useState(""),O=s=>{const t=s.target.value;K(t),o(t)};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("strong",{children:"Raw Materials"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxs(D,{size:"sm",className:"w-auto",value:J,onChange:O,children:[e.jsx("option",{value:"",children:"-- All Customers --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.project_name},s.id))]}),e.jsx(r,{color:"danger",size:"sm",onClick:()=>Q("/newRawMaterials"),children:"Add Raw Material"})]})]})}),e.jsx(le,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Material Name"}),e.jsx("th",{children:"Local Name"}),e.jsx("th",{children:"Project Name"}),e.jsx("th",{children:"Current Stock"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:u.length>0?u.map(s=>{var t,l,w,v,_,N,S,k,P;return e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.local_name||"-"}),e.jsx("td",{children:((w=(l=(t=s.logs)==null?void 0:t[0])==null?void 0:l.project)==null?void 0:w.project_name)||"-"}),e.jsx("td",{children:((_=(v=s.logs)==null?void 0:v[0])==null?void 0:_.current_stock)??"-"}),e.jsx("td",{children:((S=(N=s.logs)==null?void 0:N[0])==null?void 0:S.unit)??"-"}),e.jsx("td",{children:((P=(k=s.logs)==null?void 0:k[0])==null?void 0:P.total)??"-"}),e.jsxs("td",{className:"d-flex flex-wrap gap-2",children:[e.jsx(r,{size:"sm",color:"success",onClick:()=>G(s),children:"Add Qty"}),e.jsx(r,{size:"sm",color:"warning",onClick:()=>I(s),children:"Edit"}),e.jsx(r,{size:"sm",color:"danger",onClick:()=>B(s),children:"Delete"})]})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center",children:"No materials found"})})})]})})})]}),e.jsx(se,{visible:$,setVisible:m,onYes:U,resource:`Delete material - ${c==null?void 0:c.name}`}),e.jsx(te,{visible:H,onClose:()=>y(!1),material:Y,refreshList:o}),e.jsxs(ne,{visible:z,onClose:d,children:[e.jsx(oe,{onClose:d,children:e.jsx(ce,{children:"Edit Raw Material"})}),e.jsxs(ie,{children:[e.jsxs(E,{className:"mb-3",children:[e.jsxs(j,{xs:12,md:6,className:"mb-2",children:[e.jsx(x,{children:"Name *"}),e.jsx(F,{name:"name",value:n.name,onChange:h})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(x,{children:"Local Name"}),e.jsx(F,{name:"local_name",value:n.local_name,onChange:h})]})]}),e.jsx(E,{className:"mb-3",children:e.jsxs(j,{xs:12,md:6,children:[e.jsx(x,{children:"Project *"}),e.jsxs(D,{name:"project_id",value:n.project_id,onChange:h,children:[e.jsx("option",{value:"",children:"-- Select Project --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.project_name},s.id))]})]})})]}),e.jsxs(de,{children:[e.jsx(r,{color:"secondary",onClick:d,children:"Cancel"}),e.jsx(r,{color:"primary",onClick:T,children:"Update"})]})]})]})};export{Pe as default};
