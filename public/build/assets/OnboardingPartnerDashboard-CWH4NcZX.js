import{r as c,b as Q,j as e}from"./index-DD5PpQvG.js";import{a as u,b as l,c as j}from"./index.esm-Cf16sf0V.js";import{g as X,a as k}from"./api-BUyL__Lx.js";import{u as Z}from"./DefaultLayout-CqqVRJ58.js";import{C as n,a as m}from"./CCardBody-DIaUAcaG.js";import{C as P}from"./CFormSelect-BN9mb7wv.js";import{c as ee}from"./cil-building-DVuwBvuD.js";import{c as se}from"./cil-check-circle-BlU9eaow.js";import{c as ae}from"./cil-money-Dk3vHnQB.js";import{c as R}from"./cil-wallet-BrU51gCv.js";import{C as te}from"./CInputGroup-CSjvk1Va.js";import{C as le}from"./CFormInput-Cn6Oxe7f.js";import{C as ie}from"./CInputGroupText-3BZXwTrk.js";import{c as re}from"./cil-search-CDkY_4k-.js";import{C as z,a as L,b,c as i,d as A,e as r}from"./CTable-Dxzi_9_r.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-BpBLObvv.js";import"./CNavItem-BzisaWd0.js";import"./CFormControlWrapper-BZBLkUPy.js";import"./CFormControlValidation-CeKcElbP.js";import"./CFormLabel-nywbXjJ8.js";const Ee=()=>{var w,S,D,T;const[o,M]=c.useState(null),[g,B]=c.useState([]),[t,H]=c.useState({commission_rate:"0.00",receipts_commission:[],summary:{total_referred_companies:0,companies_with_payments:0,successful_transactions:0},total_monthly_commission:0,total_receipts:0,total_revenue_generated:0}),[x,Y]=c.useState(new Date().getMonth()+1),[h,G]=c.useState(new Date().getFullYear()),[p,J]=c.useState(""),[W,v]=c.useState(!0),[y,$]=c.useState(null),{showToast:_}=Q();X();const{t:ce,i18n:O}=Z("global");O.language;const f=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],U=[2024,2025,2026],V=async()=>{try{v(!0);const s=await k("/api/partner/dashboard");s&&(M(s.partner),B(s.companies||[])),await C()}catch(s){$("Failed to load dashboard data"),_("danger","Error occurred: "+s.message),console.error("Dashboard fetch error:",s)}finally{v(!1)}},C=async()=>{try{const s=new URLSearchParams({month:x.toString(),year:h.toString()}),a=await k(`/api/partner/receipt-based-commission?${s.toString()}`);a&&H({commission_rate:a.commission_rate||"0.00",receipts_commission:a.receipts_commission||[],summary:a.summary||{total_referred_companies:0,companies_with_payments:0,successful_transactions:0},total_monthly_commission:a.total_monthly_commission||0,total_receipts:a.total_receipts||0,total_revenue_generated:a.total_revenue_generated||0,partner_type:a.partner_type||"Partner"})}catch(s){_("danger","Error occurred: "+s.message),console.error("Receipt Commission fetch error:",s)}};c.useEffect(()=>{V()},[]),c.useEffect(()=>{o&&C()},[x,h]);const q=s=>{const a=s===0;return e.jsx("span",{className:`badge ${a?"bg-success":"bg-danger"}`,style:{padding:"4px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"500"},children:a?"Active":"Blocked"})},K=s=>new Date(s)<new Date,d=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(s||0);return W?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"ms-2",children:"Loading dashboard..."})]}):y?e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("strong",{children:"Error:"})," ",y]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{className:"mb-4",children:e.jsx(m,{children:e.jsxs(u,{className:"align-items-center",children:[e.jsxs(l,{children:[e.jsx("h2",{className:"mb-1",children:"Partner Dashboard"}),e.jsxs("p",{className:"text-muted mb-0",children:["Welcome back, ",o==null?void 0:o.name]}),e.jsx("small",{className:"text-info",children:"Commission based on actual payments received"})]}),e.jsx(l,{xs:"auto",children:e.jsxs(u,{className:"g-2",children:[e.jsx(l,{children:e.jsx(P,{size:"sm",value:x,onChange:s=>Y(parseInt(s.target.value)),children:f.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})}),e.jsx(l,{children:e.jsx(P,{size:"sm",value:h,onChange:s=>G(parseInt(s.target.value)),children:U.map(s=>e.jsx("option",{value:s,children:s},s))})})]})})]})})}),e.jsxs(u,{className:"mb-4",children:[e.jsx(l,{sm:6,lg:3,children:e.jsx(n,{className:"mb-4",children:e.jsx(m,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(j,{icon:ee,className:"text-primary",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Companies"}),e.jsx("div",{className:"fs-4 fw-semibold",children:t.summary.total_referred_companies})]})]})})})}),e.jsx(l,{sm:6,lg:3,children:e.jsx(n,{className:"mb-4",children:e.jsx(m,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(j,{icon:se,className:"text-success",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Companies with Payments"}),e.jsx("div",{className:"fs-4 fw-semibold",children:t.summary.companies_with_payments})]})]})})})}),e.jsx(l,{sm:6,lg:3,children:e.jsx(n,{className:"mb-4",children:e.jsx(m,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(j,{icon:ae,className:"text-warning",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Monthly Commission"}),e.jsx("div",{className:"fs-4 fw-semibold",children:d(t.total_monthly_commission)})]})]})})})}),e.jsx(l,{sm:6,lg:3,children:e.jsx(n,{className:"mb-4",children:e.jsx(m,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(j,{icon:R,className:"text-info",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Successful Transactions"}),e.jsx("div",{className:"fs-4 fw-semibold",children:t.summary.successful_transactions})]})]})})})})]}),e.jsx(n,{className:"mb-4",children:e.jsxs(m,{children:[e.jsx(u,{className:"justify-content-center",children:e.jsx("h4",{className:"card-title mb-3 text-center",children:"Commission Summary - Receipt Based"})}),e.jsxs(u,{children:[e.jsx(l,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Current Month Commission"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:d(t.total_monthly_commission)}),e.jsxs("div",{className:"text-muted small",children:[(w=f.find(s=>s.value===x))==null?void 0:w.label," ",h]})]})}),e.jsx(l,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Revenue Generated"}),e.jsx("div",{className:"fs-3 fw-bold text-success",children:d(t.total_revenue_generated)}),e.jsx("div",{className:"text-muted small",children:"From successful payments"})]})}),e.jsx(l,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Partner Type"}),e.jsx("div",{className:"fs-5 fw-semibold text-info",children:t.partner_type||((S=o==null?void 0:o.partner_types)==null?void 0:S.partner_type)}),e.jsxs("div",{className:"text-muted small",children:[t.commission_rate,"% Commission"]})]})}),e.jsx(l,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Receipts"}),e.jsx("div",{className:"fs-3 fw-bold text-warning",children:t.total_receipts}),e.jsx("div",{className:"text-muted small",children:"This month"})]})})]})]})}),g.length>0&&e.jsx(n,{className:"mb-4",children:e.jsxs(m,{children:[e.jsxs(u,{className:"justify-content-between align-items-center mb-3",children:[e.jsxs(l,{children:[e.jsx("h4",{className:"card-title mb-0",children:"Onboarded Companies"}),e.jsx("small",{className:"text-muted",children:"All companies you have referred"})]}),e.jsx(l,{md:4,children:e.jsxs(te,{size:"sm",children:[e.jsx(le,{style:{borderColor:"#007BFF",color:"#0d6efd"},placeholder:"Search companies...",value:p,onChange:s=>J(s.target.value)}),e.jsx(ie,{style:{borderColor:"#007BFF",backgroundColor:"#0d6efd",color:"white"},children:e.jsx(j,{icon:re})})]})})]}),e.jsx("div",{className:"overflow-x-auto w-full",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(z,{className:"min-w-[600px]",children:[e.jsx(L,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(b,{children:[e.jsx(i,{scope:"col",children:"Company"}),e.jsx(i,{scope:"col",children:"Contact"}),e.jsx(i,{scope:"col",children:"Plan"}),e.jsx(i,{scope:"col",children:"Subscription Validity"}),e.jsx(i,{scope:"col",className:"text-center",children:"Potential Commission"}),e.jsx(i,{scope:"col",className:"text-center",children:"Status"})]})}),e.jsx(A,{children:g.filter(s=>{if(p.length<2)return!0;const a=s.company_name||"",N=s.email_id||"";return a.toLowerCase().includes(p.toLowerCase())||N.toLowerCase().includes(p.toLowerCase())}).map(s=>{var E,F,I;const a=(((E=s.plan_details)==null?void 0:E.price)||0)*parseFloat(t.commission_rate)/100,N=K(s.subscription_validity);return e.jsxs(b,{children:[e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsxs("div",{className:"text-muted small",children:["ID: ",s.company_id]})]})}),e.jsxs(r,{children:[e.jsx("div",{children:s.email_id}),e.jsx("div",{className:"text-muted small",children:s.phone_no})]}),e.jsxs(r,{children:[e.jsx("div",{children:((F=s.plan_details)==null?void 0:F.name)||"N/A"}),e.jsxs("div",{className:"text-muted small",children:[d(((I=s.plan_details)==null?void 0:I.price)||0),"/month"]})]}),e.jsxs(r,{children:[e.jsx("div",{children:new Date(s.subscription_validity).toLocaleDateString()}),e.jsx("div",{className:`small ${N?"text-danger":"text-success"}`,children:N?"Expired":"Active"})]}),e.jsxs(r,{className:"text-center fw-bold",children:[e.jsx("div",{children:d(a)}),e.jsx("div",{className:"text-muted small",children:"per payment"})]}),e.jsx(r,{className:"text-center",children:q(s.block_status)})]},s.company_id)})})]})})]})}),t.receipts_commission&&t.receipts_commission.length>0&&e.jsx(n,{className:"mb-4",children:e.jsxs(m,{children:[e.jsxs("h4",{className:"card-title mb-3",children:["Commission Earned - ",(D=f.find(s=>s.value===x))==null?void 0:D.label," ",h]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Note:"})," These are actual commissions earned from successful payments made by your referred companies."]}),e.jsx("div",{className:"overflow-x-auto w-full",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(z,{children:[e.jsx(L,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(b,{children:[e.jsx(i,{children:"Company"}),e.jsx(i,{children:"Plan"}),e.jsx(i,{className:"text-center",children:"Payment Date"}),e.jsx(i,{className:"text-center",children:"Amount Paid"}),e.jsx(i,{className:"text-center",children:"Commission Rate"}),e.jsx(i,{className:"text-center",children:"Commission Earned"}),e.jsx(i,{className:"text-center",children:"Transaction ID"})]})}),e.jsx(A,{children:t.receipts_commission.map((s,a)=>e.jsxs(b,{children:[e.jsx(r,{className:"fw-semibold",children:s.company_name}),e.jsx(r,{children:s.plan_name}),e.jsx(r,{className:"text-center",children:new Date(s.payment_date).toLocaleDateString()}),e.jsx(r,{className:"text-center",children:d(s.receipt_amount)}),e.jsxs(r,{className:"text-center",children:[s.commission_rate,"%"]}),e.jsx(r,{className:"text-center fw-bold text-success",children:d(s.commission_amount)}),e.jsx(r,{className:"text-center",children:e.jsx("small",{className:"text-muted",children:s.transaction_id})})]},a))})]})})]})}),t.receipts_commission&&t.receipts_commission.length===0&&e.jsx(n,{className:"mb-4",children:e.jsxs(m,{className:"text-center py-5",children:[e.jsx(j,{icon:R,size:"3xl",className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No Commission Earned This Month"}),e.jsxs("p",{className:"text-muted mb-0",children:["No successful payments were made by your referred companies in ",(T=f.find(s=>s.value===x))==null?void 0:T.label," ",h,".",e.jsx("br",{}),"Commission is calculated based on actual payments received from companies."]})]})})]})};export{Ee as default};
