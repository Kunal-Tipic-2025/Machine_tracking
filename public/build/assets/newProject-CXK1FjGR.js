import{r as a,u as I,j as r,k as q,l as B,m as P}from"./index-WEbTLRLZ.js";import{e as O,g as G,a as D,p as M}from"./api-Ba1wfMeh.js";import{C as H,a as R}from"./CCardBody-CtNgr8m7.js";import{C as Y}from"./CCardHeader-LFhc_ZAM.js";import{C as N}from"./RawMaterial-Cd7YjP3x.js";import{C as $}from"./CForm-J01-VhG4.js";import{b as l,d as T}from"./index.esm-CZeMoYDH.js";import{C as p}from"./CFormLabel-D964ZFYD.js";import{C as h}from"./CFormInput-D3dwui72.js";import"./CFormControlWrapper-DljGJ9Vz.js";const ae=()=>{const[t,j]=a.useState({customer_name:"",mobile_number:"",project_name:"",project_cost:"",supervisor_id:"",work_place:"",commission:"",start_date:"",end_date:"",is_visible:!0,remark:"",gst_number:"",operator_id:[""]}),[i,c]=a.useState({}),[C,_]=a.useState(""),[z,b]=a.useState([]),[J,U]=a.useState([]),[y,d]=a.useState(!1),[g,v]=a.useState([]),w=I(),k=O(),f=G(),x=f==null?void 0:f.id;a.useEffect(()=>{k===2&&x&&j(e=>({...e,supervisor_id:x})),L()},[k,x]),a.useEffect(()=>{F()},[]);const F=async()=>{try{const e=await D("/api/appUsers");console.log("All the users from users:",e.data);const s=e.data.filter(n=>n.type===2);console.log("Filtered users (type = 2):",s),U(s)}catch(e){console.error("Error fetching Users:",e),E("danger","Error fetching Users")}},L=async()=>{try{const e=await D("/api/usersData");b((e==null?void 0:e.users)||[])}catch(e){console.error("Error fetching users:",e),b([])}},m=e=>{const{name:s,value:n,type:u,checked:o}=e.target;j({...t,[s]:u==="checkbox"?o:n})},A=async e=>{var s,n,u;if(e.preventDefault(),c({}),_(""),d(!0),t.end_date&&t.start_date&&new Date(t.end_date)<new Date(t.start_date)){c({end_date:"End date must be after or equal to start date."}),d(!1);return}if(!t.work_place||t.work_place.trim()===""){c({work_place:"Location is required."}),d(!1);return}try{const S={...t,machine_id:[]};console.log("formData payload:",S),await M("/api/projects",S),_("Project created successfully!"),w("/project")}catch(o){console.error("Error creating project:",o),(s=o.response)!=null&&s.data.errors?c(o.response.data.errors):c({general:((u=(n=o.response)==null?void 0:n.data)==null?void 0:u.message)||"Failed to create project."})}finally{d(!1)}},E=(e,s)=>{v([...g,{color:e,message:s,id:Date.now()}])};return r.jsxs("div",{className:"container-lg p-2",children:[r.jsxs(H,{children:[r.jsx(Y,{children:"Add New Customer"}),r.jsxs(R,{children:[C&&r.jsx(N,{color:"success",children:C}),i.general&&r.jsx(N,{color:"danger",children:i.general}),r.jsx($,{onSubmit:A,children:r.jsxs("div",{className:"row g-3",children:[r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Customer Name"}),r.jsx(h,{type:"text",name:"customer_name",value:t.customer_name,onChange:m,required:!0,placeholder:"Enter Customer Name..."})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Customer Mobile Number"}),r.jsx(h,{type:"text",name:"mobile_number",value:t.mobile_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=10&&m({target:{name:"mobile_number",value:s}})},onBlur:e=>{const s=e.target.value;s&&!/^[6-9]\d{9}$/.test(s)&&E("danger","Please enter a valid 10-digit mobile number.")},required:!0,maxLength:10,placeholder:"Enter Customer Mobile..."})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"GST Number (Optional)"}),r.jsx(h,{type:"text",name:"gst_number",value:t.gst_number,onChange:m,placeholder:"Enter GST number...",maxLength:15})]}),r.jsxs(l,{md:4,children:[r.jsx(p,{children:"Location"}),r.jsx(h,{type:"text",name:"work_place",value:t.work_place,onChange:m,placeholder:"Enter Your Location...",invalid:!!i.work_place,feedback:i.work_place})]}),r.jsxs(l,{xs:12,children:[r.jsx(T,{type:"submit",color:"primary",disabled:y,children:y?"Submitting...":"Add Customer"}),r.jsx(T,{type:"button",color:"secondary",className:"ms-2",onClick:()=>w("/project"),children:"Cancel"})]})]})})]})]}),r.jsx(q,{placement:"top-end",children:g.map(e=>r.jsx(B,{autohide:!0,visible:!0,color:e.color,className:"text-white",delay:3e3,onClose:()=>v(g.filter(s=>s.id!==e.id)),children:r.jsx(P,{children:e.message})},e.id))})]})};export{ae as default};
