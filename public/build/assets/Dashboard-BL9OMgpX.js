import{r as f,_ as Ra,R as le,g as qa,f as Ia,P as M,n as Wa,j as e,b as $a}from"./index-WEbTLRLZ.js";import{a as K,b as L,d as I}from"./index.esm-CZeMoYDH.js";import{C as za}from"./index.esm-Du-NWDtp.js";import{e as na,g as Oa,a as O,p as J,h as Qa,c as Ua}from"./api-Ba1wfMeh.js";import{u as ra,a as Ke,b as Xe,e as ea,c as aa,d as ta}from"./DefaultLayout-CnBEfSKd.js";import{C as oa,a as la}from"./CCardBody-CtNgr8m7.js";import{g as Va}from"./companyPdf-BbIHxhwg.js";import{C as pe}from"./RawMaterial-Cd7YjP3x.js";import{C as Ae}from"./CForm-J01-VhG4.js";import{C as B}from"./CFormLabel-D964ZFYD.js";import{C as se}from"./CFormSelect-CH5m41hJ.js";import{C as Z}from"./CFormInput-D3dwui72.js";import{C as Ga}from"./CFormCheck-C5vNwkHE.js";import"./cil-user-Dlmw-Gem.js";import"./CNavItem-u5MAKPdZ.js";import"./jspdf.es.min-CO5AHh_Y.js";import"./typeof-QjJsDpFa.js";import"./jspdf.plugin.autotable-DeXDhVya.js";import"./TipicConsultech-B6_BeNSe.js";import"./CFormControlWrapper-DljGJ9Vz.js";var ie=f.forwardRef(function(h,w){var x,T=h.action,A=h.chart,k=h.className,P=h.color,G=h.title,u=h.value,i=Ra(h,["action","chart","className","color","title","value"]);return le.createElement(oa,qa({className:Ia((x={},x["bg-".concat(P)]=P,x["text-white"]=P,x),k)},i,{ref:w}),le.createElement(la,{className:"pb-0 d-flex justify-content-between align-items-start"},le.createElement("div",null,u&&le.createElement("div",{className:"fs-4 fw-semibold"},u),G&&le.createElement("div",null,G)),T),A)});ie.propTypes={action:M.node,chart:M.oneOfType([M.string,M.node]),className:M.string,color:Wa,title:M.oneOfType([M.string,M.node]),value:M.oneOfType([M.string,M.node,M.number])};ie.displayName="CWidgetStatsA";var _=function(h,w){if(!(typeof window>"u")&&!(typeof document>"u")){var x=document.body;return window.getComputedStyle(x,null).getPropertyValue(h).replace(/^\s/,"")}};const ia=h=>{const w=na(),{t:x}=ra("global"),T=f.useRef(null),A=f.useRef(null),[k,P]=f.useState({currentSales:0,currentExpense:0,currentPandL:0,currentMonth:""});new Date().getMonth();const u=(c,C=0)=>c==null||isNaN(c)?"0 â‚¹":`${Math.round(Number(c))} â‚¹`;function i(){var ee,d;if(h.totalSales!==void 0&&h.totalExpense!==void 0){const W=Number(h.totalSales)||0,Y=Number(h.totalExpense)||0,xe=W-Y;P(g=>({...g,currentSales:W,currentExpense:Y,currentPandL:xe,currentMonth:"All"}));return}let c=((ee=h.reportMonth)==null?void 0:ee.monthlySales)||[],C=((d=h.reportMonth)==null?void 0:d.monthlyExpense)||[];const Q=c.reduce((W,Y)=>W+(Number(Y)||0),0),E=C.reduce((W,Y)=>W+(Number(Y)||0),0),he=Q-E;P(W=>({...W,currentSales:Q,currentExpense:E,currentPandL:he,currentMonth:"All"}))}f.useEffect(()=>{i()},[h.reportMonth,h.totalSales,h.totalExpense]),f.useEffect(()=>{document.documentElement.addEventListener("ColorSchemeChange",()=>{T.current&&setTimeout(()=>{T.current.data.datasets[0].pointBackgroundColor=_("--cui-primary"),T.current.update()}),A.current&&setTimeout(()=>{A.current.data.datasets[0].pointBackgroundColor=_("--cui-info"),A.current.update()})})},[T,A]);const X=c=>c===0?u(Math.abs(c)):`${u(Math.abs(c))} (${c>0?x("LABELS.profit"):x("LABELS.loss")})`,$=c=>c===0?"info":c>0?"success":"danger";return e.jsx(e.Fragment,{children:(w===0||w===1)&&e.jsxs(K,{className:h.className,xs:{gutter:4},children:[e.jsx(L,{sm:4,xl:4,xxl:4,className:"vh-[40%]",children:e.jsx(ie,{className:"pb-3",color:$(k.currentPandL),value:e.jsx(e.Fragment,{children:e.jsxs("div",{"d-flex":!0,children:[e.jsx("span",{className:"fs-4",style:{color:"white"},children:X(k.currentPandL)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"white"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]})}),title:e.jsx("span",{style:{color:"white"},children:x("LABELS.profit_loss")})})}),e.jsx(L,{sm:4,xl:4,xxl:4,children:e.jsx(ie,{className:"pb-3",style:{backgroundColor:"#e5ed05"},value:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fs-4",style:{color:"black"},children:u(k.currentSales)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"black"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]}),title:e.jsx("span",{style:{color:"black"},children:x("LABELS.sales")})})}),e.jsx(L,{sm:4,xl:4,xxl:4,children:e.jsx(ie,{className:"pb-3",style:{backgroundColor:"#f73434"},value:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fs-4",style:{color:"white"},children:u(k.currentExpense)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"white"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]}),title:e.jsx("span",{style:{color:"white"},children:x("LABELS.expenses")})})})]})})};ia.propTypes={className:M.string,withCharts:M.bool};const Ya=h=>{const w=f.useRef(null),x=c=>Math.round((c+Number.EPSILON)*100)/100;f.useEffect(()=>{document.documentElement.addEventListener("ColorSchemeChange",()=>{w.current&&setTimeout(()=>{w.current.options.scales.x.grid.borderColor=_("--cui-border-color-translucent"),w.current.options.scales.x.grid.color=_("--cui-border-color-translucent"),w.current.options.scales.x.ticks.color=_("--cui-body-color"),w.current.options.scales.y.grid.borderColor=_("--cui-border-color-translucent"),w.current.options.scales.y.grid.color=_("--cui-border-color-translucent"),w.current.options.scales.y.ticks.color=_("--cui-body-color"),w.current.update()})})},[w]);const T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let A=(h.monthlySales||Array(12).fill(0)).map(c=>x(c)),k=(h.monthlyExpense||Array(12).fill(0)).map(c=>x(c)),P=(h.monthlyPandL||Array(12).fill(0)).map(c=>x(c)),G=T;if(!(A.some(c=>c!==0)||k.some(c=>c!==0)||P.some(c=>c!==0))&&(h.totalSales!==void 0||h.totalExpense!==void 0)){const c=x(Number(h.totalSales)||0),C=x(Number(h.totalExpense)||0),Q=x(h.totalPandL!==void 0?Number(h.totalPandL):(Number(h.totalSales)||0)-(Number(h.totalExpense)||0));A=[c],k=[C],P=[Q],G=["All"]}const i=[...A,...k,...P.map(c=>Math.abs(c))],X=i.length?Math.max(...i):0,$=X===0?10:X+X*.1;return x(A.reduce((c,C)=>c+(C||0),0)),x(k.reduce((c,C)=>c+(C||0),0)),x(P.reduce((c,C)=>c+(C||0),0)),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},children:[e.jsx("div",{style:{flex:"1 1 250px",minWidth:"200px"}}),e.jsxs("div",{style:{display:"flex",gap:"clamp(8px, 2vw, 20px)",flexWrap:"wrap",alignItems:"center",justifyContent:window.innerWidth<768?"flex-start":"flex-end",flex:"1 1 300px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:_("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${_("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#4A90E2",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:_("--cui-body-color"),whiteSpace:"nowrap"},children:"Profit & Loss"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:_("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${_("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#2ECC71",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:_("--cui-body-color"),whiteSpace:"nowrap"},children:"Work Done Amount"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:_("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${_("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#E74C3C",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:_("--cui-body-color"),whiteSpace:"nowrap"},children:"Expense"})]})]})]}),e.jsx("div",{style:{width:"100%",overflow:"hidden"},children:e.jsx(za,{ref:w,style:{height:"clamp(250px, 40vh, 400px)",marginTop:"clamp(20px, 3vw, 40px)",width:"100%"},data:{labels:G,datasets:[{label:"Profit & Loss",backgroundColor:"#4A90E2",borderColor:"#4A90E2",borderWidth:1,data:P,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40},{label:"Work Done Amount",backgroundColor:"#2ECC71",borderColor:"#2ECC71",borderWidth:1,data:A,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40},{label:"Expense",backgroundColor:"#E74C3C",borderColor:"#E74C3C",borderWidth:1,data:k,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40}]},options:{maintainAspectRatio:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(c){const C=x(c.raw);return`${c.dataset.label}: ${C}`}},titleFont:{size:window.innerWidth<768?12:14},bodyFont:{size:window.innerWidth<768?11:13}},datalabels:{display:!1}},scales:{x:{grid:{color:_("--cui-border-color-translucent"),drawOnChartArea:!1},ticks:{color:_("--cui-body-color"),font:{size:window.innerWidth<768?10:12},maxRotation:window.innerWidth<768?45:0,minRotation:0},categoryPercentage:1,barPercentage:1},y:{beginAtZero:!0,border:{color:_("--cui-border-color-translucent")},grid:{color:_("--cui-border-color-translucent")},max:$,ticks:{color:_("--cui-body-color"),maxTicksLimit:window.innerWidth<768?4:5,stepSize:Math.ceil($/(window.innerWidth<768?4:5)),font:{size:window.innerWidth<768?10:12},callback:function(c){return x(c)+"k"}}}},interaction:{mode:"index",intersect:!1},elements:{bar:{borderRadius:2}},layout:{padding:{top:10,left:window.innerWidth<768?5:10,right:window.innerWidth<768?5:10,bottom:5}},animation:{onComplete:function(c){c&&c.config&&c.config.options&&c.config.options.plugins&&(c.config.options.plugins.datalabels={display:!1})}}}})})]})},sa=[{value:1,label:"1 Month"},{value:3,label:"3 Months"},{value:6,label:"6 Months"},{value:12,label:"Yearly"}],xt=h=>{var Ie,We,$e,ze,Oe;const w=na(),[x,T]=f.useState({monthlySales:Array(12).fill(0),monthlyExpense:Array(12).fill(0),monthlyPandL:Array(12).fill(0)}),[A,k]=f.useState([]),[P,G]=f.useState(""),{showToast:u}=$a(),[i,X]=f.useState(Oa()),[$,c]=f.useState(null),[C,Q]=f.useState(!1),[E,he]=f.useState({machineCount:0,totalProfit:0,totalExpenseAll:0,totalNet:0,customerCount:0,totalInvoices:0,totalBilled:0,totalPaid:0,totalOutstanding:0,totalSales:0,ytdPandL:0,totalProjects:0}),ee=((Ie=i==null?void 0:i.company_info)==null?void 0:Ie.appMode)??"advance",{t:d,i18n:W}=ra("global");W.language;const[Y,xe]=f.useState({plans:[]}),[g,H]=f.useState({visible:!1,product:null,addedQty:0,maxAddable:0}),[ae,Pe]=f.useState(""),ne=f.useRef(!1),ca=a=>{const t=a.target.value,n=g.maxAddable;if(t===""){H(s=>({...s,addedQty:""})),ne.current=!1;return}const o=parseInt(t,10);isNaN(o)||o<0?(H(s=>({...s,addedQty:0})),ne.current=!1):o>n?(H(s=>({...s,addedQty:n})),ne.current||(u("warning",d("MESSAGES.maximum_stock_limit",{max:n})),ne.current=!0)):(H(s=>({...s,addedQty:o})),ne.current=!1)},da=async()=>{var a,t;try{const n=g.product.id,o=g.product.product_id,s={size_id:n,added_qty:Number(g.addedQty)},r=await J(`/api/product/${o}/update-quantity`,s);r.success!==!1?(u("success",d("MESSAGES.stock_updated_success")),H({visible:!1,product:null,addedQty:0,maxAddable:0}),de()):u("danger",d("MESSAGES.update_stock_failed",{error:r.message||"-"}))}catch(n){const o=((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||n.message||"-";u("danger",d("MESSAGES.update_stock_failed",{error:o}))}},[y,R]=f.useState({visible:!1,localNameEdited:!1,formData:{name:"",localName:"",slug:"",categoryId:0,incStep:1,desc:"",multiSize:!1,show:!0,returnable:!0,showOnHome:!0,unit:"",qty:"",stock:"",oPrice:"",media:[],sizes:[]},images:[]}),ma=()=>{var n,o;const a=((o=(n=i==null?void 0:i.company_info)==null?void 0:n.subscribed_plan_name)==null?void 0:o.toLowerCase())||"";return["monthly business essential (start-up) - credit report","monthly business essential (start-up) - advanced booking","quarterly business essential (start-up) - credit report","quarterly business essential (start-up) - advanced booking","half-yearly business essential (start-up) - credit report","half-yearly business essential (start-up) - advanced booking","annually business essential (start-up) - credit report","annually business essential (start-up) - advanced booking"].includes(a)},[q,z]=f.useState({visible:!1,csvFile:null,isUploading:!1,message:"",isError:!1}),[ua,re]=f.useState(!1),[l,pa]=f.useState(null),[ce,ha]=f.useState([]),[b,te]=f.useState({plan_id:1,duration:1,validity_date:""}),[xa,Fe]=f.useState(!1),[fa,fe]=f.useState(!1),ye=async()=>{try{if(w===1&&(i!=null&&i.company_id)){Fe(!0),console.log("Fetching subscription status for company:",i.company_id);const a=await O(`/api/company/subscription-status/${i.company_id}`);a&&(console.log("Subscription status received:",a),pa(a),a.is_expired||a.is_expiring_soon?(fe(!0),a.is_expired&&re(!0)):fe(!1))}}catch(a){console.error("Error fetching subscription status:",a),u("danger","Failed to fetch subscription status")}finally{Fe(!1)}},ge=()=>{R(a=>({...a,visible:!1}))},oe=a=>{const{name:t,value:n}=a.target;if(["qty","stock","incStep"].includes(t)){if(n===""){R(r=>({...r,formData:{...r.formData,[t]:""}}));return}let s=parseFloat(n);if(isNaN(s)||s<0)return;if(t==="stock"){const r=parseFloat(y.formData.qty)||0;if(r>0&&s>r){u("warning",`Stock cannot exceed capacity (${r})`);return}}if(t==="qty"){const r=parseFloat(y.formData.stock)||0;if(r>0&&s<r){u("warning",`Capacity cannot be less than current stock (${r})`);return}}R(r=>({...r,formData:{...r.formData,[t]:s}}));return}if(t==="oPrice"){if(n===""){R(r=>({...r,formData:{...r.formData,[t]:""}}));return}if(!/^\d*\.?\d{0,2}$/.test(n))return;R(r=>({...r,formData:{...r.formData,[t]:n}}));return}R(t==="name"?s=>({...s,formData:{...s.formData,name:n,localName:s.localNameEdited?s.formData.localName:n}}):t==="localName"?s=>({...s,localNameEdited:!0,formData:{...s.formData,localName:n}}):s=>({...s,formData:{...s.formData,[t]:n}}))},ya=a=>{const{name:t,checked:n}=a.target;R(o=>({...o,formData:{...o.formData,[t]:n}}))},ga=async a=>{try{if(!y||!Array.isArray(y.images)||y.images.length===0)return console.log("âœ… No images to upload."),{success:!0};const t=y.images.filter(Boolean);if(t.length===0)return console.log("âœ… All images were empty or invalid, skipping upload."),{success:!0};const n=new FormData;t.forEach((s,r)=>{n.append("images[]",s)}),n.append("product_id",a.toString()),console.log("ðŸ“¤ Uploading images for product ID:",a);const o=await Ua("/api/product/media/multiple",n);return console.log("âœ… Image upload success:",o),{success:!0,response:o}}catch(t){return console.error("âŒ Image upload failed:",t),{success:!1,error:t}}},ba=async a=>{a.preventDefault();const t=a.target;if(!t.checkValidity()){t.classList.add("was-validated");return}const n=y.formData.oPrice,o=parseFloat(n);if(isNaN(o)||o<0){u("danger","Please enter a valid selling price");return}const s=parseFloat(y.formData.qty)||0,r=parseFloat(y.formData.stock)||0;if(r>s){u("danger",`Initial stock (${r}) cannot exceed capacity (${s})`);return}let p={...y.formData,sizes:[]};p.slug=p.name.replace(/[^\w]/g,"_"),y.formData.multiSize||(p.sizes.push({name:p.name,localName:p.localName,qty:p.qty,oPrice:n,dPrice:n,stock:p.stock,show:!0,returnable:p.returnable}),delete p.oPrice,delete p.qty,delete p.stock);try{const m=await J("/api/product",p);console.log("âœ… Product creation response:",m),m&&m.id?(u("success","Product added successfully"),console.log("ðŸ“¦ Created product ID:",m.id),console.log("ðŸ–¼ï¸ Images before upload:",y.images),(await ga(m.id)).success?Array.isArray(y.images)&&y.images.filter(Boolean).length&&u("success","Images uploaded successfully"):u("warning","Product saved, but image upload failed."),ge(),de()):m&&m.message?u("danger",m.message):u("danger","Unexpected response from server.")}catch(m){if(console.error("âŒ Product creation error:",m),m.response){const v=m.response.status,S=m.response.data;v===422&&S.errors?Object.entries(S.errors).forEach(([we,_e])=>{_e.forEach(Ne=>{u("danger",Ne)})}):S.message?u("danger",S.message):u("danger",`Server error (${v}).`)}else m.request?u("danger","Network error. Please check your connection."):u("danger","An unexpected error occurred. Please try again.")}},Be=()=>{z(a=>({...a,visible:!1}))},ja=a=>{const t=a.target.files[0];z(n=>({...n,csvFile:t,message:"",isError:!1}))},va=async()=>{var t,n,o;if(!q.csvFile){z(s=>({...s,message:"Please select a CSV file to upload.",isError:!0}));return}if(q.csvFile.type!=="text/csv"&&!q.csvFile.name.endsWith(".csv")){z(s=>({...s,message:"Invalid file type. Please upload a valid CSV file.",isError:!0}));return}const a=new FormData;a.append("csv_file",q.csvFile);try{z(p=>({...p,isUploading:!0}));const s=await Qa("/api/uploadProducts",a,{headers:{"Content-Type":"multipart/form-data"}}),r=((t=s==null?void 0:s.data)==null?void 0:t.message)||(s==null?void 0:s.message);r?(z(p=>({...p,message:r,isError:!1,csvFile:null})),u("success","Products uploaded successfully!"),await de()):z(p=>({...p,message:"Upload failed. Check CSV format.",isError:!0}))}catch(s){console.error("Upload error:",s);const r=((o=(n=s.response)==null?void 0:n.data)==null?void 0:o.error)||"Upload failed. Check CSV format.";z(p=>({...p,message:r,isError:!0})),u("danger",r)}finally{z(s=>({...s,isUploading:!1}))}},wa=()=>{const a=document.createElement("a");a.href="sample_products_template.csv",a.download="SampleProductTemplate.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a)};f.useEffect(()=>{try{ee==="advance"&&(async()=>{const t=await O("/api/getMonthlyReportSummeries");T(t)})()}catch(a){u("danger","Error occurred "+a)}},[]);const de=async()=>{try{const a=await O("/api/stock");k(a)}catch{u("danger","Error occurred while fetching stock")}};f.useEffect(()=>{de()},[]);const Me=a=>{const t=parseFloat(a)||0;if(isNaN(t))return"0.00";const[n,o="00"]=t.toFixed(2).split("."),s=n.slice(-3),r=n.slice(0,-3);return`${r?r.replace(/\B(?=(\d{2})+(?!\d))/g,",")+","+s:s}.${o}`};f.useEffect(()=>{const a=i==null?void 0:i.company_id;if(!a)return;let t=!1;return(async()=>{try{Q(!0);const[o,s,r,p,m]=await Promise.all([O("/api/machineries1").catch(()=>[]),O(`/api/machineLog?company_id=${a}`).catch(()=>[]),O(`/api/expense1?company_id=${a}`).catch(()=>[[]]),O(`/api/project-payments?company_id=${a}`).catch(()=>[]),O(`/api/myProjects?company_id=${a}`).catch(()=>[])]),v=Array.isArray(o)?o:[],S=Array.isArray(s)?s:[],we=Array.isArray(r)?Array.isArray(r[0])?r[0]:r:[],_e=Array.isArray(p)?p:[],Ne=Array.isArray(m)?m.length:0,Ca=j=>v.reduce((N,D)=>{const V=j.filter(Le=>Number(Le.machine_id)===Number(D.id)).reduce((Le,Ee)=>{const He=parseFloat(Ee.start_reading)||0,Je=parseFloat(Ee.end_reading)||0,Ze=parseFloat(Ee.price_per_hour)||0;return Le+(Je>He&&Ze>0?(Je-He)*Ze:0)},0);return N+V},0),La=j=>j.reduce((N,D)=>N+(parseFloat(D.total_price)||0),0),Ea=v.length,Aa=Ca(S),Qe=La(we),Ue=_e.filter(j=>j.company_id===a),Pa=Ue.reduce((j,N)=>{var V;const D=((V=N.project)==null?void 0:V.customer_name)||"Unknown";return j[D]=j[D]||[],j[D].push(N),j},{}),Fa=Object.keys(Pa).length,ue=Ue.filter(j=>!j.is_advance),Ba=ue.length,Se=ue.reduce((j,N)=>j+Number(N.total||0),0),Ve=ue.reduce((j,N)=>j+Number(N.paid_amount||0),0),Ma=Se-Ve,Ge=Se,Da=Ge-Qe,ke=Array(12).fill(0);ue.forEach(j=>{const N=j.created_at||j.invoice_date;if(!N)return;const D=new Date(N);if(Number.isNaN(D.getTime()))return;const V=D.getMonth();ke[V]+=Number(j.total||0)});const Ce=Array(12).fill(0);we.forEach(j=>{const N=j.expense_date||j.created_at;if(!N)return;const D=new Date(N);if(Number.isNaN(D.getTime()))return;const V=D.getMonth();Ce[V]+=Number(j.total_price||0)});const Ye=ke.map((j,N)=>j-Ce[N]),Ta=Ye.reduce((j,N)=>j+N,0);t||(he({machineCount:Ea,totalProfit:Aa,totalExpenseAll:Qe,totalNet:Da,customerCount:Fa,totalInvoices:Ba,totalBilled:Se,totalPaid:Ve,totalOutstanding:Ma,totalSales:Ge,ytdPandL:Ta,totalProjects:Ne}),T({monthlySales:ke,monthlyExpense:Ce,monthlyPandL:Ye}))}catch{u("danger","Failed to load dashboard summary")}finally{t||Q(!1)}})(),()=>{t=!0}},[i==null?void 0:i.company_id]),f.useEffect(()=>{(async()=>{await Promise.all([ye(),_a()])})();const t=setInterval(()=>{ye()},5*60*1e3);return()=>clearInterval(t)},[i==null?void 0:i.company_id]);const _a=async()=>{try{const a=await O("/api/detailsForCompany");console.log("Raw response:",a);const t=(a==null?void 0:a.plans)||[];xe(o=>({...o,plans:t}));const n=t.filter(o=>{var r;const s=((r=o.name)==null?void 0:r.toLowerCase())||"";return(s.includes("monthly")||s.includes("annually")||s.includes("quarterly")||s.includes("half-yearly"))&&!s.includes("free trial")});console.log("Filtered Plans:",n),ha(n)}catch(a){console.error("Error fetching plans:",a),u("danger","Failed to fetch subscription plans")}},De=(a=null)=>{const t=a??b.duration;if(!(l!=null&&l.subscription_validity)){const p=new Date,m=new Date(p);return m.setMonth(m.getMonth()+parseInt(t)),m.toISOString().split("T")[0]}const n=new Date(l.subscription_validity),o=new Date,s=n>o?n:o,r=new Date(s);return r.setMonth(r.getMonth()+parseInt(t)),r.toISOString().split("T")[0]},Te=a=>{var o,s,r,p;const{name:t,value:n}=a.target;if(t==="plan_id"){const m=ce.find(S=>S.id===parseInt(n));let v=1;(o=m==null?void 0:m.name)!=null&&o.toLowerCase().includes("annually")?v=12:(s=m==null?void 0:m.name)!=null&&s.toLowerCase().includes("monthly")?v=1:(r=m==null?void 0:m.name)!=null&&r.toLowerCase().includes("quarterly")?v=3:(p=m==null?void 0:m.name)!=null&&p.toLowerCase().includes("half-yearly")&&(v=6),te(S=>({...S,plan_id:n,duration:v,validity_date:De(v)}))}else te(m=>({...m,[t]:n}))},Re=a=>{const t=parseInt(a.target.value);te(n=>({...{...n,duration:t},validity_date:De()}))};f.useEffect(()=>{if(b.duration&&(l!=null&&l.subscription_validity)){const a=new Date(l.subscription_validity),t=new Date,n=a>t?a:t,o=new Date(n);o.setMonth(o.getMonth()+parseInt(b.duration));const s=o.toISOString().split("T")[0];s!==b.validity_date&&te(r=>({...r,validity_date:s}))}},[b.duration,b.plan_id,l]);const be=a=>Math.round(a*5)/5,F=()=>ce.find(a=>a.id==b.plan_id),je=()=>{const a=F();if(!a)return 0;const n=a.price*b.duration/1.18;return be(n)},ve=()=>{const a=F();if(!a)return 0;const t=a.price*b.duration,n=t/1.18,o=t-n;return be(o)},U=()=>{const a=F();if(!a)return 0;const t=a.price*b.duration;return be(t)},Na=(a,t)=>{var n,o,s,r,p;try{const m={company:{company_name:((n=i==null?void 0:i.company_info)==null?void 0:n.company_name)||(i==null?void 0:i.name)||"N/A",phone_no:(i==null?void 0:i.mobile)||((o=i==null?void 0:i.company_info)==null?void 0:o.phone_no)||"N/A",email_id:(i==null?void 0:i.email)||((s=i==null?void 0:i.company_info)==null?void 0:s.email_id)||"N/A"},plan:{name:((r=F())==null?void 0:r.name)||"Selected Plan",price:((p=F())==null?void 0:p.price)||0},transaction_id:(a==null?void 0:a.razorpay_payment_id)||"N/A",total_amount:je(),gst:ve(),payable_amount:U(),valid_till:b.validity_date,created_at:new Date().toISOString(),renewal_duration:b.duration};console.log("Generating PDF with data:",m);const v=Va(m);return console.log("PDF generated successfully:",v),u("success","Receipt downloaded successfully!"),v}catch(m){console.error("Error generating PDF receipt:",m),u("warning","Subscription renewed successfully, but failed to generate receipt PDF")}},Sa=a=>a.is_expired?"expired":a.is_trial?"trial":a.days_remaining<15?"critical":a.days_remaining<=30?"warning":"active",ka=a=>a.is_expired||a.days_remaining<15?"danger":a.is_trial||a.days_remaining<=30?"warning":"success",qe=async()=>{var a;try{if(!b.plan_id||!b.duration){u("danger","Please select a plan and duration");return}if(!window.Razorpay){const o=document.createElement("script");o.src="https://checkout.razorpay.com/v1/checkout.js",await new Promise((s,r)=>{o.onload=s,o.onerror=r,document.body.appendChild(o)})}const t={amount:U()},n=await J("/api/create-order",t);if(n){const o={key:n.key,amount:n.order.amount,currency:n.order.currency,order_id:n.order.id,name:"Subscription Renewal",description:`${(a=F())==null?void 0:a.name} - ${b.duration} months`,handler:async r=>{try{const p=await J("/api/verify-payment",{razorpay_order_id:r.razorpay_order_id,razorpay_payment_id:r.razorpay_payment_id,razorpay_signature:r.razorpay_signature});if(p!=null&&p.success){const m={company_id:i.company_id,plan_id:b.plan_id,total_amount:U(),valid_till:b.validity_date,transaction_id:r.razorpay_payment_id,transaction_status:"success",renewal_type:"extension"},v=await J("/api/company-receipt",m),S=await J("/api/company/update-validity",{company_id:i.company_id,valid_till:b.validity_date,plan_id:b.plan_id});v!=null&&v.success&&(S!=null&&S.success)?(u("success","Subscription renewed successfully!"),setTimeout(()=>{Na(r,v)},1e3),re(!1),fe(!1),await ye()):u("danger","Payment successful but failed to update subscription. Please contact support.")}else u("danger","Payment verification failed")}catch(p){u("danger","Payment successful but failed to update subscription: "+p),console.error("Renewal error:",p)}},prefill:{name:i.name,email:i.email,contact:i.mobile},theme:{color:"#3399cc"}},s=new window.Razorpay(o);s.open(),s.on("payment.failed",async r=>{var p,m,v;console.error("Payment Failed:",r.error),u("danger","Payment failed. Please try again.");try{const S={company_id:i.company_id,plan_id:b.plan_id,user_id:i.id,total_amount:U(),valid_till:b.validity_date,transaction_id:((m=(p=r.error)==null?void 0:p.metadata)==null?void 0:m.payment_id)??"failed",transaction_status:((v=r.error)==null?void 0:v.description)??"Failed",renewal_type:"extension_failed"};await J("/api/company-receipt",S)}catch(S){console.error("Error logging failed payment:",S)}})}}catch(t){console.error("Payment error:",t),u("danger","Something went wrong with payment: "+t.message)}},me=(a,t)=>{const n=parseInt(a)||0,o=parseInt(t)||1,s=n/o*100;return s<20?{level:"critical",color:"danger",strobe:!0,percentage:s.toFixed(1),description:"Critical - Less than 20% stock remaining"}:s>=20&&s<=50?{level:"low",color:"warning",strobe:!0,percentage:s.toFixed(1),description:"Low - 20-50% stock remaining"}:{level:"good",color:"success",strobe:!1,percentage:s.toFixed(1),description:"Good - More than 50% stock remaining"}};return A.filter(a=>{if(!a.product||!a.product.showOnHome)return!1;const t=(a.name||"").toLowerCase(),n=(a.localName||"").toLowerCase(),o=P.toLowerCase(),s=t.includes(o)||n.includes(o);if($){const r=a.stock/a.qty*100;if($==="critical"&&r>=20||$==="low"&&(r<20||r>50)||$==="good"&&r<=50)return!1}return s}),xa&&!l?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):l!=null&&l.is_expired&&w===1?e.jsx(e.Fragment,{children:e.jsxs(Ke,{visible:!0,backdrop:"static",keyboard:!1,size:"lg",children:[e.jsx(Xe,{closeButton:!1,children:e.jsx(ea,{children:"Subscription Expired"})}),e.jsxs(aa,{children:[e.jsx(pe,{color:"danger",children:e.jsxs("div",{children:[e.jsx("h5",{children:"Your subscription has expired!"}),e.jsxs("p",{children:["Your subscription expired on ",l.validity_date_formatted,"."]}),e.jsx("p",{children:"Please renew your subscription to continue using the service."})]})}),e.jsxs(Ae,{children:[e.jsxs(K,{children:[e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"billing_type",children:"Billing Type"}),e.jsxs(se,{id:"billing_type",name:"billing_type",value:ae,onChange:a=>{Pe(a.target.value),te(t=>({...t,plan_id:""}))},children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"half-yearly",children:"Half-Yearly"}),e.jsx("option",{value:"annually",children:"Annually"})]})]})}),e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"plan_id",children:"Select Plan"}),e.jsx(se,{id:"plan_id",name:"plan_id",value:b.plan_id,onChange:Te,options:[{value:"",label:"Select a plan..."},...ce.filter(a=>{var n;const t=((n=a.name)==null?void 0:n.toLowerCase())||"";return ae?t.includes(ae.toLowerCase()):t.includes("monthly")}).map(a=>({value:a.id,label:`${a.name} (â‚¹${a.price}/month incl. GST)`}))]})]})}),e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"duration",children:"Duration"}),e.jsx(se,{id:"duration",name:"duration",value:b.duration,onChange:Re,options:sa,disabled:!0})]})})]}),e.jsx(K,{children:e.jsx(L,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"validity_date",children:"New Validity Date"}),e.jsx(Z,{type:"date",id:"validity_date",name:"validity_date",value:b.validity_date,readOnly:!0})]})})}),F()&&e.jsxs(pe,{color:"info",children:[e.jsx("h6",{children:"Payment Summary"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Plan: ",(We=F())==null?void 0:We.name]}),e.jsxs("p",{className:"mb-1",children:["Duration: ",b.duration," months"]}),e.jsxs("p",{className:"mb-1",children:["Rate: â‚¹",($e=F())==null?void 0:$e.price,"/month (incl. GST)"]})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Base Amount: â‚¹",je()]}),e.jsxs("p",{className:"mb-1",children:["GST (18%): â‚¹",ve()]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:["Total: â‚¹",U()]})})]})]})]})]})]}),e.jsx(ta,{children:e.jsxs(I,{color:"primary",onClick:qe,disabled:!F(),size:"lg",children:["Pay â‚¹",U()," & Renew Now"]})})]})}):e.jsxs(e.Fragment,{children:[fa&&l&&e.jsxs("div",{className:`subscription-banner ${Sa(l)}`,children:[e.jsx("style",{children:`
        @keyframes flicker {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .subscription-banner {
          border-radius: 5px;
          margin-bottom: 20px;
          animation: flicker 2s infinite;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 15px;
          flex-wrap: wrap;
        }
        
        /* Expired - Red */
        .subscription-banner.expired {
          background-color: #f8d7da;
          border: 1px solid #f5c6cb;
          color: #721c24;
        }
        
        /* Critical (less than 15 days) - Red */
        .subscription-banner.critical {
          background-color: #f8d7da;
          border: 1px solid #f5c6cb;
          color: #721c24;
        }
        
        /* Warning (1 month or less) - Yellow */
        .subscription-banner.warning {
          background-color: #fff3cd;
          border: 1px solid #ffeaa7;
          color: #856404;
        }
        
        /* Free Trial - Orange */
        .subscription-banner.trial {
          background-color: #ffe8d1;
          border: 1px solid #ffb347;
          color: #8b4513;
        }
        
        /* Active (more than 1 month) - Green */
        .subscription-banner.active {
          background-color: #d4edda;
          border: 1px solid #c3e6cb;
          color: #155724;
        }
        
        .subscription-banner .banner-text {
          font-weight: bold;
          flex: 1;
          min-width: 300px;
          margin-right: 15px;
        }
        
        .subscription-banner .banner-button {
          flex-shrink: 0;
        }
        
        /* Mobile Responsive - Text left, button right like in your image */
        @media (max-width: 767px) {
          .subscription-banner {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            gap: 10px;
          }
          
          .subscription-banner .banner-text {
            min-width: auto;
            margin-right: 10px;
            font-size: 13px;
            line-height: 1.3;
            text-align: left;
            flex: 1;
          }
          
          .subscription-banner .banner-button {
            flex-shrink: 0;
            width: auto;
          }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
          .subscription-banner {
            padding: 10px;
            gap: 8px;
          }
          
          .subscription-banner .banner-text {
            font-size: 12px;
            line-height: 1.2;
            margin-right: 8px;
          }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
          .subscription-banner {
            padding: 8px;
            gap: 6px;
          }
          
          .subscription-banner .banner-text {
            font-size: 11px;
            margin-right: 6px;
          }
        }
      `}),e.jsx("div",{className:"banner-text",children:l.is_expired?e.jsxs("span",{children:["Your subscription has expired! Your subscription expired on ",l.validity_date_formatted,". Please renew your subscription to continue using the service."]}):e.jsx("span",{children:l.is_trial?`Free trial expiring in ${Math.abs(l.days_remaining)} days on ${l.validity_date_formatted}. Upgrade now to continue using the service.`:`Subscription expiring in ${Math.abs(l.days_remaining)} days on ${l.validity_date_formatted}. Renew now to avoid service interruption.`})}),e.jsx("div",{className:"banner-button",children:e.jsx(I,{color:ka(l),size:"sm",onClick:()=>re(!0),style:{fontWeight:"bold"},children:l.is_trial?"Upgrade Now":"Renew Now"})})]}),ee==="advance"&&e.jsx(ia,{className:"mb-4",reportMonth:x,totalSales:E.totalSales,totalExpense:E.totalExpenseAll}),(w===0||w===1)&&e.jsxs(K,{className:"g-2 mb-4",children:[e.jsx(L,{xs:6,md:3,lg:4,children:e.jsxs("div",{className:"rounded p-2 text-center bg-primary text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Total Machines"}),e.jsx("strong",{className:"fs-6",children:C?"-":E.machineCount})]})}),e.jsx(L,{xs:6,md:3,lg:4,children:e.jsxs("div",{className:`rounded p-2 text-center shadow-sm ${E.totalSales-E.totalOutstanding>=0?"bg-secondary text-white":"bg-danger text-white"}`,children:[e.jsx("small",{className:"d-block",children:"Payment Received"}),e.jsx("strong",{className:"fs-6",children:C?"-":Me(E.totalSales-E.totalOutstanding)})]})}),e.jsx(L,{xs:6,md:3,lg:4,children:e.jsxs("div",{className:"rounded p-2 text-center bg-danger text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Credit Amount"}),e.jsx("strong",{className:"fs-6",children:C?"-":Me(E.totalOutstanding)})]})})]}),e.jsxs(Ke,{visible:ua,onClose:l!=null&&l.is_expired?void 0:()=>re(!1),backdrop:l!=null&&l.is_expired?"static":!0,keyboard:!(l!=null&&l.is_expired),size:"lg",children:[e.jsx(Xe,{closeButton:!(l!=null&&l.is_expired),children:e.jsx(ea,{children:l!=null&&l.is_expired?"Subscription Expired":"Subscription Expiring Soon"})}),e.jsxs(aa,{children:[e.jsx(pe,{color:l!=null&&l.is_expired?"danger":"warning",children:l!=null&&l.is_expired?e.jsxs("div",{children:[e.jsx("h5",{children:"Your subscription has expired!"}),e.jsxs("p",{children:["Your subscription expired ",Math.abs(l.days_remaining)," days ago on ",l.validity_date_formatted,"."]}),e.jsx("p",{children:"Please renew your subscription to continue using the service."})]}):e.jsxs("div",{children:[e.jsx("h5",{children:"Subscription Expiring Soon!"}),e.jsxs("p",{children:["Your subscription will expire in ",l==null?void 0:l.days_remaining," days on ",l==null?void 0:l.validity_date_formatted,"."]}),e.jsx("p",{children:"Renew now to avoid service interruption."})]})}),e.jsxs(Ae,{children:[e.jsxs(K,{children:[e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"billing_type",children:"Billing Type"}),e.jsxs(se,{id:"billing_type",name:"billing_type",value:ae,onChange:a=>{Pe(a.target.value),te(t=>({...t,plan_id:""}))},children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"half-yearly",children:"Half-Yearly"}),e.jsx("option",{value:"annually",children:"Annually"})]})]})}),e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"plan_id",children:"Select Plan"}),e.jsx(se,{id:"plan_id",name:"plan_id",value:b.plan_id,onChange:Te,options:[{value:"",label:"Select a plan..."},...ce.filter(a=>{var n;const t=((n=a.name)==null?void 0:n.toLowerCase())||"";return ae?t.includes(ae.toLowerCase()):t.includes("monthly")}).map(a=>({value:a.id,label:`${a.name} (â‚¹${a.price}/month incl. GST)`}))]})]})}),e.jsx(L,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"duration",children:"Duration"}),e.jsx(se,{id:"duration",name:"duration",value:b.duration,onChange:Re,options:sa,disabled:!0})]})})]}),e.jsx(K,{children:e.jsx(L,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"validity_date",children:"New Validity Date"}),e.jsx(Z,{type:"date",id:"validity_date",name:"validity_date",value:b.validity_date,readOnly:!0})]})})}),F()&&e.jsxs(pe,{color:"info",children:[e.jsx("h6",{children:"Payment Summary"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Plan: ",(ze=F())==null?void 0:ze.name]}),e.jsxs("p",{className:"mb-1",children:["Duration: ",b.duration," months"]}),e.jsxs("p",{className:"mb-1",children:["Rate: â‚¹",(Oe=F())==null?void 0:Oe.price,"/month (incl. GST)"]})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Base Amount: â‚¹",je()]}),e.jsxs("p",{className:"mb-1",children:["GST (18%): â‚¹",ve()]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:["Total: â‚¹",U()]})})]})]})]})]})]}),e.jsxs(ta,{children:[!(l!=null&&l.is_expired)&&e.jsx(I,{color:"secondary",onClick:()=>re(!1),children:"Later"}),e.jsxs(I,{color:"primary",onClick:qe,disabled:!F(),children:["Pay â‚¹",U()," & Renew"]})]})]}),y.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0.5rem auto",maxWidth:"min(600px, calc(100vw - 1rem))",width:"100%"},children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:d("LABELS.create_new_product")}),e.jsx("button",{type:"button",className:"btn-close",onClick:ge})]}),e.jsx("div",{className:"modal-body",children:e.jsxs(Ae,{className:"needs-validation",noValidate:!0,onSubmit:ba,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-12 col-sm-6 mb-3 mb-sm-0",children:[e.jsx(B,{htmlFor:"pname",children:e.jsx("b",{children:d("LABELS.product_name")})}),e.jsx(Z,{type:"text",id:"pname",placeholder:d("LABELS.product_name"),name:"name",value:y.formData.name,onChange:oe,required:!0,feedbackInvalid:d("LABELS.please_provide_name"),feedbackValid:d("LABELS.looks_good")}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.product_name_required")})]}),e.jsxs("div",{className:"col-12 col-sm-6",children:[e.jsx(B,{htmlFor:"plname",children:e.jsx("b",{children:d("LABELS.local_name")})}),e.jsx(Z,{type:"text",id:"plname",placeholder:d("LABELS.local_name"),name:"localName",value:y.formData.localName,onChange:oe}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.local_name_required")})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-12 col-sm-4 mb-3 mb-sm-0",children:[e.jsx(B,{htmlFor:"qty",children:e.jsx("b",{children:d("LABELS.capacity")})}),e.jsx(Z,{type:"number",id:"qty",placeholder:"0",min:"0",onWheel:a=>a.target.blur(),name:"qty",value:y.formData.qty,onChange:oe,required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.quantity_required")})]}),e.jsxs("div",{className:"col-12 col-sm-4 mb-3 mb-sm-0",children:[e.jsx(B,{htmlFor:"stock",children:e.jsx("b",{children:d("LABELS.initial_stock")})}),e.jsx(Z,{type:"number",id:"stock",placeholder:"0",min:"0",onWheel:a=>a.target.blur(),max:y.formData.qty||void 0,name:"stock",value:y.formData.stock,onChange:oe,required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.initial_stock_required")}),y.formData.qty&&y.formData.stock>y.formData.qty&&e.jsxs("div",{className:"text-danger small mt-1",children:["Stock cannot exceed capacity (",y.formData.qty,")"]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx(B,{htmlFor:"oPrice",children:e.jsx("b",{children:d("LABELS.selling_price")})}),e.jsx(Z,{type:"text",id:"oPrice",placeholder:"0.00",name:"oPrice",onWheel:a=>a.target.blur(),value:y.formData.oPrice,onChange:oe,onBlur:a=>{const t=a.target.value;if(t&&!isNaN(parseFloat(t))){const n=parseFloat(t).toFixed(2);R(o=>({...o,formData:{...o.formData,oPrice:n}}))}},pattern:"^\\d*\\.?\\d{0,2}$",title:"Please enter a valid price (up to 2 decimal places)",required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.selling_price_required")})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{children:e.jsx("b",{children:"Upload Images"})}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"form-control",onChange:a=>{R(t=>({...t,images:[...a.target.files]}))}})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsx(Ga,{id:"show",label:d("LABELS.show_for_invoicing"),name:"show",checked:y.formData.show,onChange:ya})})}),e.jsxs("div",{className:"modal-footer d-flex gap-2",children:[e.jsx(I,{color:"secondary",onClick:ge,className:"flex-fill flex-sm-grow-0",children:d("LABELS.cancel")}),e.jsx(I,{color:"success",type:"submit",className:"flex-fill flex-sm-grow-0",disabled:y.formData.stock>y.formData.qty||!y.formData.name||!y.formData.qty||!y.formData.oPrice,children:d("LABELS.create_product")})]})]})})]})})}),q.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:d("LABELS.upload_product_csv")}),e.jsx("button",{type:"button",className:"btn-close",onClick:Be})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3 d-flex align-items-center",children:[e.jsx("strong",{className:"me-2",children:d("LABELS.sample_csv_template")}),e.jsxs(I,{color:"success",variant:"outline",size:"sm",title:d("LABELS.download_sample_template"),onClick:wa,children:["ðŸ“¥ ",d("LABELS.download")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"csvFile",className:"form-label",children:e.jsx("strong",{children:d("LABELS.select_csv_file")})}),e.jsx("input",{type:"file",id:"csvFile",className:"form-control",accept:".csv",onChange:ja})]}),q.message&&e.jsx("div",{className:`alert ${q.isError?"alert-danger":"alert-success"}`,role:"alert",children:q.message})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(I,{color:"secondary",onClick:Be,children:d("LABELS.cancel")}),e.jsx(I,{color:"success",onClick:va,disabled:q.isUploading||!q.csvFile,children:q.isUploading?d("LABELS.uploading"):d("LABELS.upload_csv")})]})]})})}),g.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[d("LABELS.add_stock")," - ",g.product.name]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>H({visible:!1,product:null,addedQty:0,maxAddable:0})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("p",{className:"mb-1",children:[e.jsxs("b",{children:[d("LABELS.total_quantity"),":"]})," ",e.jsx("span",{className:"badge bg-primary",children:g.product.qty??0})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("p",{className:"mb-1",children:[e.jsxs("b",{children:[d("LABELS.current_stock"),":"]})," ",e.jsx("span",{className:`badge ${me(g.product.stock??0,g.product.qty||1).color==="danger"?"bg-danger":me(g.product.stock??0,g.product.qty||1).color==="warning"?"bg-warning text-dark":"bg-success"}`,style:{animation:me(g.product.stock??0,g.product.qty||1).strobe?"stockStrobe 1.5s infinite":"none"},children:g.product.stock??0})]})})]}),e.jsx("div",{className:"alert alert-info",children:e.jsxs("small",{children:[e.jsxs("strong",{children:[d("LABELS.stock_percentage"),":"]})," ",me(g.product.stock??0,g.product.qty||1).percentage,"% ",d("LABELS.of_total_quantity")]})}),g.maxAddable>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsxs("b",{children:[d("LABELS.stock_to_add"),":"]}),e.jsxs("small",{className:"text-muted ms-2",children:["(",d("LABELS.max"),": ",g.maxAddable,")"]})]}),e.jsx("input",{type:"number",min:"1",max:g.maxAddable,onWheel:a=>a.target.blur(),className:"form-control custom-placeholder",placeholder:`${d("LABELS.enter_stock_to_add")} (${d("LABELS.max")}: ${g.maxAddable})`,value:g.addedQty,onChange:ca})]}),e.jsx("div",{className:"alert alert-success",children:e.jsxs("small",{children:[e.jsxs("strong",{children:[d("LABELS.after_adding"),":"]})," ",d("LABELS.stock_will_be")," ",(g.product.stock??0)+(parseInt(g.addedQty)||0)," / ",g.product.qty??0]})})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsxs("strong",{children:[d("LABELS.stock_is_full"),"!"]})," ",d("LABELS.stock_full_message")]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(I,{color:"secondary",onClick:()=>H({visible:!1,product:null,addedQty:0,maxAddable:0}),children:d("LABELS.cancel")}),e.jsx(I,{color:"primary",onClick:da,disabled:!g.addedQty||parseInt(g.addedQty)<1||g.maxAddable<=0,children:d("LABELS.add_stock")})]})]})})}),(w===0||w===1)&&ee==="advance"&&!ma()&&e.jsx(oa,{className:"mt-4 mb-4",children:e.jsxs(la,{children:[e.jsxs(K,{children:[e.jsxs(L,{sm:5,children:[e.jsx("h4",{id:"traffic",className:"card-title mb-0",children:"P&L (In Thousands)"}),e.jsx("div",{className:"small text-body-secondary",children:"January - December"})]}),e.jsx(L,{sm:7,className:"d-none d-md-block"})]}),e.jsx(Ya,{monthlyPandL:x.monthlyPandL,monthlySales:x.monthlySales,monthlyExpense:x.monthlyExpense,totalSales:E.totalSales,totalExpense:E.totalExpenseAll,totalPandL:E.totalSales-E.totalExpenseAll})]})})]})};export{xt as default};
