import{u as w,r as d,b as M,j as t}from"./index-Cn-27-TL.js";import{a as I}from"./api-BUyL__Lx.js";import{a as B,b as E,d as k}from"./index.esm-2RRpQEeO.js";import{C as H,a as V}from"./CCardBody-Bfh-O-BQ.js";import{C as q}from"./CCardHeader-DyQDv_BY.js";import{C as L}from"./CForm-D5S3-WLx.js";import{C as h}from"./CFormLabel-CFBomnnz.js";import{C as x}from"./CFormInput-CL8d5WGe.js";import{C as O,a as z,b as m,c as o,d as G,e as l}from"./CTable-CtRsnfwM.js";import{C as j}from"./DefaultLayout-Vrb03iJh.js";import"./CFormControlWrapper-CPiMjLs0.js";import"./CFormControlValidation-BvfkKe2L.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-O4w4bCVl.js";import"./CNavItem-EvCITOBp.js";const nt=()=>{w();const[p,C]=d.useState([]),[v,A]=d.useState(0),[b,f]=d.useState(0),[g,S]=d.useState(0),[D,T]=d.useState(!1),{showToast:c}=M(),[i,_]=d.useState({start_date:"",end_date:""}),u=a=>{const{name:r,value:n}=a.target;_({...i,[r]:n})},y=async()=>{try{const a=await I("/api/reportSales?startDate="+i.start_date+"&endDate="+i.end_date);if(a){const r=a.reduce((e,s)=>(e[s.invoiceDate]||(e[s.invoiceDate]={invoiceDate:s.invoiceDate,totalAmount:0,paidAmount:0}),e[s.invoiceDate].totalAmount+=s.totalAmount,e[s.invoiceDate].paidAmount+=s.paidAmount,e),{}),n=Object.values(r).map(e=>({...e,totalAmount:Math.round(e.totalAmount),paidAmount:Math.round(e.paidAmount),remainingAmount:Math.round(e.totalAmount-e.paidAmount)}));C(n);const R=n.reduce((e,s)=>e+s.totalAmount,0),P=n.reduce((e,s)=>e+s.paidAmount,0),F=n.reduce((e,s)=>e+s.remainingAmount,0);A(Math.round(R)),f(Math.round(P)),S(Math.round(F))}else c("danger","Failed to fetch records")}catch(a){c("danger","Error occured "+a)}},N=async a=>{try{const r=a.currentTarget;a.preventDefault(),a.stopPropagation(),T(!0),r.checkValidity()&&await y()}catch(r){c("danger","Failed to fetch records"+r)}};return t.jsx(B,{children:t.jsx(E,{xs:12,children:t.jsxs(H,{className:"mb-4",children:[t.jsx(q,{children:t.jsx("strong",{children:"Sales Report"})}),t.jsxs(V,{children:[t.jsx(L,{onSubmit:N,noValidate:!0,validated:D,children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"col-sm-4",children:t.jsxs("div",{className:"mb-1",children:[t.jsx(h,{htmlFor:"start_date",children:"Start Date"}),t.jsx(x,{type:"date",id:"start_date",name:"start_date",value:i.start_date,onChange:u,required:!0,feedbackInvalid:"Please select date."})]})}),t.jsx("div",{className:"col-sm-4",children:t.jsxs("div",{className:"mb-1",children:[t.jsx(h,{htmlFor:"end_date",children:"End Date"}),t.jsx(x,{type:"date",id:"end_date",name:"end_date",value:i.end_date,onChange:u,required:!0,feedbackInvalid:"Please select date."})]})}),t.jsx("div",{className:"col-sm-4",children:t.jsx("div",{className:"mb-1 mt-4",children:t.jsx(k,{color:"success",type:"submit",children:"Submit"})})})]})}),t.jsx("hr",{}),t.jsx("div",{className:"table-responsive",children:t.jsxs(O,{children:[t.jsx(z,{children:t.jsxs(m,{children:[t.jsx(o,{children:"Invoice Date"}),t.jsx(o,{children:"Total Amount"}),t.jsx(o,{children:"Paid Amount"}),t.jsx(o,{children:"Remaining Amount"})]})}),t.jsxs(G,{children:[p.map((a,r)=>t.jsxs(m,{children:[t.jsx(l,{children:a.invoiceDate}),t.jsx(l,{children:a.totalAmount}),t.jsx(l,{children:a.paidAmount}),t.jsx(l,{children:a.remainingAmount})]},r)),t.jsxs(m,{children:[t.jsx(o,{children:"Total"}),t.jsx(o,{children:v}),t.jsx(o,{children:t.jsx(j,{color:"success",children:b})}),t.jsx(o,{children:t.jsx(j,{color:"danger",children:g})})]})]})]})})]})]})})})};export{nt as default};
