import{r as a,j as e,C as Z,b as as}from"./index-WEbTLRLZ.js";import{d as j,c as K,a as U,b as p}from"./index.esm-CZeMoYDH.js";import{a as O,g as Fe,f as Ze,b as rs}from"./api-Ba1wfMeh.js";import{g as Ke,h as is}from"./InvoiceMulPdf-DzIaj4zp.js";import{C as Ae,a as Se}from"./CCardBody-CtNgr8m7.js";import{C as ke}from"./CCardHeader-LFhc_ZAM.js";import{C as De,j as cs,a as ie,b as ce,e as de,c as le,d as He}from"./DefaultLayout-CnBEfSKd.js";import{C as ds}from"./RawMaterial-Cd7YjP3x.js";import{C as fe,a as ye,b as f,c as o,d as be,e as c}from"./CTable-DcVbcKI_.js";import{C as ls}from"./CInputGroup-Ds1aMRVv.js";import{C as os}from"./CInputGroupText-Bqk6jF70.js";import{C as Pe}from"./CFormInput-D3dwui72.js";import{C as Be}from"./CTooltip-BbSRXrJn.js";import{c as ms}from"./cil-money-Dk3vHnQB.js";import{c as xs}from"./cil-history-D-FQjjfl.js";import"./jspdf.es.min-CO5AHh_Y.js";import"./typeof-QjJsDpFa.js";import"./html2canvas.esm-DZlvpFNH.js";import"./cil-user-Dlmw-Gem.js";import"./CNavItem-u5MAKPdZ.js";import"./CFormControlWrapper-DljGJ9Vz.js";import"./CFormLabel-D964ZFYD.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";var Ie=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"];const hs=({projectId:m,inModal:r=!1})=>{const[n,oe]=a.useState([]),[T,V]=a.useState(!0),[A,Q]=a.useState([]),[S,z]=a.useState({show:!1,message:"",type:"success"}),[u,M]=a.useState([]),[k,H]=a.useState(!1),[W,ee]=a.useState(!1),[$,Y]=a.useState([]),[y,B]=a.useState(!1);a.useState(null),a.useState(null),a.useState(!1);const[b,me]=a.useState([]),[q,Ne]=a.useState([]),[L,Te]=a.useState([]),[ve,J]=a.useState(!1),h=async()=>{try{const t=await O("/api/machine-operators");console.log("machineries",t),me(t||[])}catch(t){console.error("Error fetching machineries:",t)}},Me=async()=>{try{const t=await O("/api/machineLog");Ne(t||[])}catch(t){console.error("Error fetching machine logs:",t)}};a.useEffect(()=>{if(n!=null&&n.worklog_ids&&q.length>0){const t=q.filter(P=>n.worklog_ids.includes(P.id));Te(t),console.log("Filtered Logs:",t)}},[n,q]);const E=async()=>{try{V(!0);const t=await O(`/api/project-payments/${m}`);console.log(t),oe(t)}catch(t){console.error("Error fetching orders:",t),se("Failed to fetch orders","danger")}finally{V(!1)}},_e=()=>{O("/api/operatorsByCompanyIdOperator").then(t=>{console.log(t),Y(t)}).catch(t=>{console.log(t.message)})};a.useEffect(()=>{E()},[m]),a.useEffect(()=>{Me(),_e(),h(),xe()},[]);const se=(t,P="success")=>{z({show:!0,message:t,type:P}),setTimeout(()=>z({show:!1,message:"",type:"success"}),5e3)},xe=async()=>{try{const t=await O("/api/machine-price");Q(t)}catch(t){console.error("Error fetching machine price:",t)}},he=async()=>{if(u.length===0){se("Please select at least one work order to download","warning");return}H(!0);try{await generateWorkOrdersPDF(u),se(`PDF generated successfully for ${u.length} work order(s)`,"success"),M([])}catch(t){console.error("Error generating PDF:",t),se("Failed to generate PDF. Please try again.","danger")}finally{H(!1)}},ue=()=>{B(!0)},we=async()=>{var t,P,D,F,I;if(!(!n||Object.keys(n).length===0))try{J(!0);const x=(t=Fe())==null?void 0:t.company_info;if(!x){S("Company information not found. Please log in again.");return}const ae=te(n.created_at),$e={invoice_number:n.invoice_number,date:ae,customer:{name:((P=n.project)==null?void 0:P.customer_name)||"N/A",address:((D=n.project)==null?void 0:D.work_place)||"",mobile:((F=n.project)==null?void 0:F.mobile_number)||"",gst_number:((I=n.project)==null?void 0:I.gst_number)||""},consignee:{name:x.company_name,address:`${x.land_mark||""}, ${x.Tal||""}, ${x.Dist||""}, ${x.pincode||""}`,phone_no:x.phone_no,gst_number:x.gst_number,email_id:x.email_id},totalAmount:n.total,amountPaid:n.paid_amount,finalAmount:n.total,paymentMode:n.payment_mode,transaction_id:n.transaction_id,is_fixed_bid:n.is_fixed_bid==1,is_advance:n.is_advance==1,remark:n.remark},re=L.map(pe=>({id:pe.id,data:pe}));await Ke($e,re,$,b,A,re,"english","save")}catch(x){console.error("Error generating PDF:",x),S("Failed to generate PDF. Please try again.")}finally{J(!1)}},te=t=>t?new Date(t).toLocaleDateString("en-GB"):"";if(T)return e.jsx("div",{className:"d-flex justify-content-center align-items-center p-5",children:e.jsx(Z,{color:"primary"})});if(!n||Object.keys(n).length===0)return e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-muted",children:"No invoice data found."})});const G=(n==null?void 0:n.total)-(n==null?void 0:n.paid_amount),ne=G<=0;return e.jsx("div",{className:"p-4",children:e.jsxs(Ae,{children:[e.jsx(ke,{className:"bg-primary text-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[e.jsx("h5",{className:"mb-0",children:"Invoice Details"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(De,{color:ne?"success":"warning",className:"fs-6 px-3 py-2 rounded-pill",children:ne?"✔️ Completed":"⏳ Pending"}),e.jsx(j,{color:"success",size:"sm",onClick:we,disabled:ve||!n,children:ve?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-1"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:Ie,className:"me-1"}),"Download PDF"]})})]})]})}),e.jsxs(Se,{children:[e.jsxs(U,{className:"mb-4",children:[e.jsxs(p,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Invoice Number:"}),e.jsx("div",{className:"text-muted",children:n.invoice_number||"-"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Date:"}),e.jsx("div",{className:"text-muted",children:te(n.created_at)})]})]}),e.jsxs(p,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Payment Mode:"}),e.jsx("div",{className:"text-muted",children:n.payment_mode||"-"})]}),n.transaction_id&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Transaction ID:"}),e.jsx("div",{className:"text-muted",children:n.transaction_id})]}),n.project&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Customer:"}),e.jsx("div",{className:"text-muted",children:n.project.customer_name||"-"})]})]})]}),!r&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2",children:[e.jsx("div",{children:u.length>0&&e.jsxs("span",{className:"text-muted small",children:[u.length," work order(s) selected"]})}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(j,{color:"primary",onClick:he,disabled:u.length===0||k,className:"d-flex align-items-center",size:"sm",children:k?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-md-inline",children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:Ie,className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Work Order PDF"}),e.jsx("span",{className:"d-inline d-sm-none",children:"WO"}),u.length>0&&` (${u.length})`]})}),e.jsx(j,{color:"success",onClick:ue,disabled:W,className:"d-flex align-items-center",size:"sm",children:W?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-md-inline",children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:cs,className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Income Report"}),e.jsx("span",{className:"d-inline d-sm-none",children:"Income"})]})})]})]})}),S.show&&e.jsx(ds,{color:S.type,dismissible:!0,onClose:()=>z({show:!1,message:"",type:"success"}),children:S.message}),e.jsx("div",{className:"table-responsive",style:{maxHeight:"70vh",overflowY:"auto",overflowX:"auto",borderRadius:"6px"},children:e.jsxs(fe,{striped:!0,bordered:!0,hover:!0,className:"mb-0",children:[e.jsx(ye,{style:{position:"sticky",top:0,zIndex:2,backgroundColor:"#f8f9fa",boxShadow:"0 2px 3px rgba(0,0,0,0.05)"},children:e.jsxs(f,{children:[e.jsx(o,{children:"Sr no."}),e.jsx(o,{children:"Work Date"}),e.jsx(o,{children:"Machine"}),e.jsx(o,{children:"Operator"}),e.jsx(o,{children:"Start Reading"}),e.jsx(o,{children:"End Reading"}),e.jsx(o,{children:"Net Reading"}),e.jsx(o,{children:"Mode"}),e.jsx(o,{children:"Price Per Hour"}),e.jsx(o,{className:"text-end",children:"Total Price"})]})}),e.jsxs(be,{children:[L.length>0?L.map((t,P)=>{var D,F,I;return e.jsxs(f,{children:[e.jsx(c,{children:P+1}),e.jsx(c,{children:(t==null?void 0:t.work_date)||"-"}),e.jsx(c,{children:((D=b.find(x=>String(x.id)===String(t==null?void 0:t.machine_id)))==null?void 0:D.machine_name)||"N/A"}),e.jsx(c,{children:((F=$.find(x=>x.id===Number(t==null?void 0:t.operator_id)))==null?void 0:F.name)||"Unknown Operator"}),e.jsx(c,{children:(t==null?void 0:t.start_reading)||"-"}),e.jsx(c,{children:(t==null?void 0:t.end_reading)||"-"}),e.jsx(c,{children:t!=null&&t.end_reading&&(t!=null&&t.start_reading)?t.end_reading-t.start_reading:"-"}),e.jsx(c,{children:((I=A.find(x=>x.id===Number(t.mode_id)))==null?void 0:I.mode)||"-"}),e.jsxs(c,{children:["₹",(t==null?void 0:t.price_per_hour)||"0"]}),e.jsxs(c,{className:"text-end",children:["₹",t!=null&&t.end_reading&&(t!=null&&t.start_reading)&&(t!=null&&t.price_per_hour)?((t.end_reading-t.start_reading)*t.price_per_hour).toFixed(2):"0.00"]})]},t.id)}):e.jsx(f,{children:e.jsx(c,{colSpan:10,className:"text-center text-muted py-4",children:"No work orders found for this invoice."})}),e.jsxs(f,{className:"fw-bold bg-light",children:[e.jsx(c,{colSpan:9,className:"text-end",children:"Grand Total"}),e.jsxs(c,{className:"text-end",children:["₹",Number((n==null?void 0:n.total)||0).toFixed(2)]})]}),e.jsxs(f,{className:"bg-light",children:[e.jsx(c,{colSpan:9,className:"text-end",children:"Paid Amount"}),e.jsxs(c,{className:"text-end text-success",children:["₹",Number((n==null?void 0:n.paid_amount)||0).toFixed(2)]})]}),e.jsxs(f,{className:"fw-bold bg-light",children:[e.jsx(c,{colSpan:9,className:"text-end",children:"Remaining Amount"}),e.jsxs(c,{className:`text-end ${G>0?"text-danger":"text-success"}`,children:["₹",G.toFixed(2)]})]})]})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-light rounded",children:[e.jsxs(U,{children:[e.jsx(p,{md:4,children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("span",{className:"fw-bold me-2",children:"Total Amount:"}),e.jsxs("span",{className:"fs-5 fw-bold",children:["₹",Number((n==null?void 0:n.total)||0).toFixed(2)]})]})}),e.jsx(p,{md:4,children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("span",{className:"fw-bold me-2",children:"Paid Amount:"}),e.jsxs("span",{className:"fs-5 fw-bold text-success",children:["₹",Number((n==null?void 0:n.paid_amount)||0).toFixed(2)]})]})}),e.jsx(p,{md:4,children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("span",{className:"fw-bold me-2",children:"Remaining:"}),e.jsxs("span",{className:`fs-5 fw-bold ${G>0?"text-danger":"text-success"}`,children:["₹",G.toFixed(2)]})]})})]}),n.payment_mode&&e.jsx("div",{className:"mt-2 pt-2 border-top",children:e.jsxs("div",{className:"",children:[e.jsx("span",{className:"fw-bold me-2",children:"Payment Mode:"}),e.jsx(De,{color:"info",className:"fs-6",children:n.payment_mode})]})})]})]})]})})},us=({paymentId:m})=>{const[r,n]=a.useState(null),[oe,T]=a.useState(!0),[V,A]=a.useState(!1);a.useEffect(()=>{m&&Q()},[m]);const Q=async()=>{try{T(!0);const u=await O(`/api/project-payments/${m}`);n(u)}catch(u){console.error("Error fetching advance payment:",u)}finally{T(!1)}},S=u=>u?new Date(u).toLocaleDateString("en-GB"):"",z=async()=>{var u,M,k,H,W,ee,$,Y;if(r)try{A(!0);const y=(u=Fe())==null?void 0:u.company_info;if(!y){alert("Company information not found. Please log in again.");return}const B=S(r.created_at),b=r.is_fixed_bid==1,me=!b,q={invoice_number:r.invoice_number,date:B,customer:{name:((M=r.project)==null?void 0:M.customer_name)||"N/A",address:((k=r.project)==null?void 0:k.work_place)||"",mobile:((H=r.project)==null?void 0:H.mobile_number)||"",gst_number:((W=r.project)==null?void 0:W.gst_number)||""},consignee:{name:y.company_name,address:`${y.land_mark||""}, ${y.Tal||""}, ${y.Dist||""}, ${y.pincode||""}`,phone_no:y.phone_no,gst_number:y.gst_number,email_id:y.email_id},totalAmount:r.total,amountPaid:r.paid_amount,finalAmount:r.total,paymentMode:r.payment_mode||(b?"Fixed Bid":"Advance"),transaction_id:r.transaction_id,is_fixed_bid:b,is_advance:me,remark:r.remark,name:((ee=r.project)==null?void 0:ee.customer_name)||"N/A",address:(($=r.project)==null?void 0:$.work_place)||"",mobile:((Y=r.project)==null?void 0:Y.mobile_number)||"",total:r.total};await Ke(q,[],[],[],[],[],"english","save")}catch(y){console.error("Error generating PDF:",y),alert("Failed to generate PDF. Please try again.")}finally{A(!1)}};return oe?e.jsx("div",{className:"d-flex justify-content-center align-items-center p-5",children:e.jsx(Z,{color:"primary"})}):r?e.jsx("div",{className:"p-4",children:e.jsxs(Ae,{children:[e.jsxs(ke,{className:"bg-warning text-dark d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:r.is_fixed_bid==1?"Fixed Bid Invoice":"Advance Payment Invoice"}),e.jsx(j,{color:"success",size:"sm",onClick:z,disabled:V||!r,children:V?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-1"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{icon:Ie,className:"me-1"}),"Download PDF"]})})]}),e.jsxs(Se,{children:[e.jsxs(U,{className:"mb-4",children:[e.jsxs(p,{md:6,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Invoice Number:"})," ",e.jsx("span",{className:"text-muted",children:r.invoice_number||"-"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Date:"})," ",e.jsx("span",{className:"text-muted",children:S(r.created_at)})]})]}),e.jsxs(p,{md:6,children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Payment Mode:"})," ",e.jsx("span",{className:"text-muted",children:r.payment_mode||(r.is_fixed_bid==1?"Fixed Bid":"Advance")})]}),r.transaction_id&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Transaction ID:"})," ",e.jsx("span",{className:"text-muted",children:r.transaction_id})]})]})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs(fe,{striped:!0,bordered:!0,children:[e.jsx(ye,{children:e.jsxs(f,{children:[e.jsx(o,{children:"Description"}),e.jsx(o,{className:"text-end",children:"Amount"}),e.jsx(o,{className:"text-end",children:"Remaining"})]})}),e.jsxs(be,{children:[e.jsxs(f,{children:[e.jsxs(c,{children:[e.jsx("strong",{children:r.is_fixed_bid==1?"Fixed Bid Work":"Advance Payment"}),r.remark&&e.jsx("div",{className:"text-muted small mt-1",children:r.remark})]}),e.jsx(c,{className:"text-end",children:e.jsxs("strong",{className:"text-success",children:["₹",Number(r.total||0).toFixed(2)]})}),e.jsx(c,{className:"text-end",children:e.jsxs("strong",{className:"text-danger",children:["₹",(Number(r.total||0)-Number(r.paid_amount||0)).toFixed(2)]})})]}),e.jsxs(f,{children:[e.jsx(c,{colSpan:2,children:e.jsx("strong",{children:"Total Paid Amount"})}),e.jsx(c,{className:"text-end",children:e.jsxs("strong",{className:"text-success fs-5",children:["₹",Number(r.paid_amount||0).toFixed(2)]})})]})]})]})}),e.jsx("div",{className:"mt-4 p-3 bg-light rounded",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"fw-bold",children:"Payment Mode:"}),e.jsx("span",{className:"badge bg-info fs-6 ms-2",children:r.payment_mode||(r.is_fixed_bid==1?"Fixed Bid":"Advance")})]})}),r.project&&e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"fw-bold",children:"Cust. Name :"}),e.jsx("span",{className:"text-muted ms-2",children:r.project.customer_name||"-"})]})})]})})]})]})}):e.jsx("div",{className:"p-4 text-center",children:e.jsx("p",{className:"text-muted",children:"No payment data found."})})},ps=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-eye",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"}),e.jsx("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"})]}),zs=()=>{var Ue,Ve;const{showToast:m}=as(),r=(Ue=Fe())==null?void 0:Ue.company_id;if(!r)return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("p",{className:"text-muted",children:"Unable to determine company. Please log in again."})});const[n,oe]=a.useState([]),[T,V]=a.useState(""),[A,Q]=a.useState(""),[S,z]=a.useState(""),[u,M]=a.useState(!1),[k,H]=a.useState(null),[W,ee]=a.useState(!1),[$,Y]=a.useState(null),[y,B]=a.useState(!1);a.useState("");const[b,me]=a.useState(null),[q,Ne]=a.useState(!1),[L,Te]=a.useState([]),[ve,J]=a.useState(!1),[h,Me]=a.useState(null),[E,_e]=a.useState(""),[se,xe]=a.useState(!1),[he,ue]=a.useState(""),[we,te]=a.useState(""),[G,ne]=a.useState([]);a.useState(!1);const[t,P]=a.useState(!1),[D,F]=a.useState(""),[I,x]=a.useState(!1),ae=async()=>{M(!0);try{const s=await O(`/api/project-payments?company_id=${r}`);oe(Array.isArray(s)?s:[])}catch(s){m("danger","Error fetching project payments: "+((s==null?void 0:s.message)||s))}finally{M(!1)}},$e=async()=>{try{const s=await O("/api/projects");if(!Array.isArray(s)){ne([]);return}const i={};s.forEach(d=>{var N;if(d.company_id!==r)return;const l=(N=d.customer_name)==null?void 0:N.trim();l&&(i[l]||(i[l]={name:l,mobile:d.mobile_number||"",projects:[]}),i[l].projects.push({id:d.id,company_id:d.company_id}))}),ne(Object.values(i))}catch(s){console.error(s),ne([])}},re=async()=>{if(b){M(!0);try{const s=await O(`/api/repayments?company_id=${r}&project_id=${b}`);Te(Array.isArray(s)?s:[])}catch(s){m("danger","Error fetching history: "+((s==null?void 0:s.message)||s))}finally{M(!1)}}};a.useEffect(()=>{ae(),$e()},[r]),a.useEffect(()=>{b&&re()},[b,r]);const pe=s=>s?new Date(s).toLocaleDateString("en-GB"):"",Ee=s=>`₹${Number(s||0).toFixed(2)}`,Le=a.useMemo(()=>n.filter(s=>s.company_id===r),[n,r]),Ce=a.useMemo(()=>{const s={};if(Le.forEach(i=>{var l;const d=((l=i.project)==null?void 0:l.customer_name)||"Unknown";s[d]||(s[d]=[]),s[d].push(i)}),A){const i=A.toLowerCase();return Object.fromEntries(Object.entries(s).filter(([d])=>d.toLowerCase().includes(i)))}return s},[Le,A]),je=a.useMemo(()=>{const s=Object.values(Ce),i=s.flat(),d=i.filter(w=>!w.is_advance),l=s.length,N=i.length,g=d.reduce((w,ge)=>w+Number(ge.total||0),0),_=d.reduce((w,ge)=>w+Number(ge.paid_amount||0),0),C=g-_;return{customerCount:l,totalInvoices:N,totalBilled:g,totalPaid:_,totalOutstanding:C}},[Ce]);if(u&&!n.length)return e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(Z,{color:"primary",size:"lg"}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading project payments..."})]});const Qe=async()=>{var g;if(!h||!E||Number(E)<=0)return;const s=Number(E),i=Number(h.paid_amount)+s,d=Number(h.total)-i;try{const _={paid_amount:i,payment_mode:h.payment_mode||null},C=await fetch(`/api/project-payments/${h.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(!C.ok){const w=await C.text();throw new Error(`Failed to update payment: ${w}`)}m("success","Payment updated successfully")}catch(_){console.error("Payment update error:",_),m("danger","Failed to update payment: "+_.message);return}const l=new Date().toISOString().split("T")[0],N={company_id:r,project_id:(g=h.project)==null?void 0:g.id,invoice_id:h.invoice_number,payment:s,total:h.total,remaining:d,is_completed:d<=0,date:l};try{await fetch("/api/repayment/single",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)}),_e(""),J(!1),ae(),b&&re()}catch(_){console.error("Repayment recording error:",_),m("danger","Payment recorded but history failed to save.")}};if(!k)return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx(p,{xs:12,children:e.jsxs(Ae,{className:"shadow-sm",children:[e.jsx(ke,{className:"bg-light d-flex justify-content-between align-items-center",children:e.jsxs("div",{children:[e.jsx("strong",{className:"fs-5",children:"Customers Payment Report"}),e.jsxs(De,{color:"info",className:"ms-2",children:[je.customerCount," customers"]})]})}),e.jsxs(Se,{children:[e.jsxs(U,{className:"mb-2",children:[e.jsx(p,{xs:12,md:6,children:e.jsxs(ls,{children:[e.jsx(os,{children:"Search"}),e.jsx(Pe,{placeholder:"Search by customer name...",value:S,onChange:s=>{z(s.target.value),Q(s.target.value)}})]})}),A&&e.jsx(p,{xs:12,md:3,className:"mt-2 mt-md-0",children:e.jsx(j,{color:"light",size:"sm",onClick:()=>{z(""),Q("")},children:"Clear"})})]}),e.jsxs(U,{className:"g-2 mb-3",children:[e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"rounded p-2 text-center bg-primary text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Invoices"}),e.jsx("strong",{className:"fs-6",children:je.totalInvoices})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"rounded p-2 text-center bg-success text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Total Billed"}),e.jsx("strong",{className:"fs-6",children:Ee(je.totalBilled)})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"rounded p-2 text-center bg-warning text-dark shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Paid"}),e.jsx("strong",{className:"fs-6",children:Ee(je.totalPaid)})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"rounded p-2 text-center bg-info text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Outstanding"}),e.jsx("strong",{className:"fs-6",children:Ee(je.totalOutstanding)})]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs(fe,{striped:!0,hover:!0,bordered:!0,children:[e.jsx(ye,{children:e.jsxs(f,{children:[e.jsx(o,{className:"text-center align-middle",children:"Sr. No."}),e.jsx(o,{className:"text-center align-middle",children:"Customer Name"}),e.jsx(o,{className:"text-center align-middle",children:"Total"}),e.jsx(o,{className:"text-center align-middle",children:"Paid"}),e.jsx(o,{className:"text-center align-middle",children:"Remaining"}),e.jsx(o,{className:"text-center align-middle",children:"Action"})]})}),e.jsx(be,{children:Object.entries(Ce).map(([s,i],d)=>{const l=i.filter(C=>!C.is_advance),N=l.reduce((C,w)=>C+Number(w.total||0),0),g=l.reduce((C,w)=>C+Number(w.paid_amount||0),0),_=N-g;return e.jsxs(f,{children:[e.jsx(c,{children:d+1}),e.jsx(c,{children:s}),e.jsxs(c,{className:"text-end",children:["₹",N.toFixed(2)]}),e.jsxs(c,{className:"text-success fw-bold text-end",children:["₹",g.toFixed(2)]}),e.jsxs(c,{className:"text-danger fw-bold text-end",children:["₹",_.toFixed(2)]}),e.jsx(c,{className:"text-center",children:e.jsx(j,{size:"sm",color:"info",onClick:()=>{H(s),me(i[0].project_id)},children:"View Invoices"})})]},s)})})]})})]})]})})}),e.jsxs(ie,{visible:se,onClose:()=>{xe(!1),ue(""),te("")},children:[e.jsx(ce,{children:e.jsx(de,{children:"Advance Payment"})}),e.jsxs(le,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Customer"}),e.jsxs("select",{className:"form-select",value:he,onChange:s=>ue(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select --"}),G.map(s=>e.jsxs("option",{value:s.name,children:[s.name," ",s.mobile?`(${s.mobile})`:""]},s.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Amount"}),e.jsx(Pe,{type:"number",placeholder:"Enter amount",value:we,onChange:s=>te(s.target.value),min:"0"})]})]}),e.jsxs(He,{children:[e.jsx(j,{color:"secondary",onClick:()=>xe(!1),children:"Cancel"}),e.jsx(j,{color:"primary",onClick:async()=>{var N;if(!he)return m("danger","Select a customer");const s=Number(we);if(!s||s<=0)return m("danger","Enter a valid amount");const i=G.find(g=>g.name===he);if(!((N=i==null?void 0:i.projects)!=null&&N.length))return m("danger","No project for this customer");const{id:d,company_id:l}=i.projects[0];try{await Ze("/api/advance-payment",{company_id:l,project_id:d,amount:s}),m("success","Advance payment recorded"),xe(!1),ue(""),te(""),ae()}catch(g){m("danger","Failed: "+((g==null?void 0:g.message)||"Unknown error"))}},children:"Submit"})]})]})]});const Re=Ce[k]||[],Ge=Re.filter(s=>!s.is_advance),Oe=Ge.reduce((s,i)=>s+Number(i.total||0),0),ze=Ge.reduce((s,i)=>s+Number(i.paid_amount||0),0),X=Oe-ze,R=(L||[]).filter(s=>s.is_advance&&!s.advance_taken).reduce((s,i)=>s+Number(i.payment||0),0),es=async()=>{const d=(Number(D)||0)+(I?R:0);if(d<=0)return m("danger","Total payment must be greater than 0");if(d>X)return m("danger","Total amount exceeds remaining balance");try{if(await Ze("/api/repayments",{project_id:b,payment:d}),I)try{const l=await rs("/api/repayments/mark-advance-taken",{company_id:r,project_id:b});l.success?m("success",l.message||"Advance payments marked as cleared"):m("warning",l.message||"Advance status update failed")}catch(l){console.error("Advance clear update failed:",l),m("warning","Repayment saved, but advance status update failed: "+(l.message||"Unknown error"))}m("success","Payment recorded successfully"),B(!1),F(""),x(!1),ae(),re()}catch(l){m("danger","Error: "+((l==null?void 0:l.message)||l))}},ss=async()=>{var Ye,qe,Je,Xe;const s=n.find(v=>v.invoice_number===T);if(!s)return;const i=L.filter(v=>(v==null?void 0:v.invoice_id)===T);if(i.length===0){m("warning","No history to download");return}const d=(Ye=Fe())==null?void 0:Ye.company_info;if(!d){alert("Company information not found. Please log in again.");return}const l=((qe=s.project)==null?void 0:qe.customer_name)||"N/A",N=s.is_fixed_bid==1?"FIXED BID INVOICE":"INVOICE",g=Number(s.total||0).toFixed(2),_=Number(s.paid_amount||0).toFixed(2),C=(Number(s.total)-Number(s.paid_amount)).toFixed(2),w=i.map((v,ns)=>`
            <tr>
                <td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">${ns+1}</td>
                <td style="border: 1px solid #dee2e6; padding: 8px; text-align: center;">
                    ${v!=null&&v.date?v.date.slice(0,10).split("-").reverse().join("-"):"-"}
                </td>
                <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">₹${Number(v.payment).toFixed(2)}</td>
                <td style="border: 1px solid #dee2e6; padding: 8px; text-align: right;">₹${Number(v.remaining).toFixed(2)}</td>
            </tr>
        `).join(""),ge=`
            <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
                <!-- Header Section -->
                <div style="border-bottom: 3px solid #0d6efd; padding-bottom: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            ${d.logo?`<img src="/img/${d.logo}" alt="Logo" style="max-width: 120px; height: auto;" />`:""}
                        </div>
                        <div style="text-align: right; flex: 1;">
                            <h2 style="margin: 0; color: #333; font-size: 24px;">${d.company_name||""}</h2>
                            <p style="margin: 5px 0; color: #666; font-size: 14px;">${d.land_mark||""}, ${d.Tal||""}, ${d.Dist||""}</p>
                            <p style="margin: 5px 0; color: #666; font-size: 14px;">Pincode: ${d.pincode||""}</p>
                            <p style="margin: 5px 0; color: #666; font-size: 14px;">Phone: ${d.phone_no||""}</p>
                        </div>
                    </div>
                </div>

                <!-- Title -->
                <div style="text-align: center; background-color: #0d6efd; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <h2 style="margin: 0; color: #fff; font-size: 20px;">PAYMENT HISTORY - ${N}</h2>
                </div>

                <!-- Invoice & Customer Details -->
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div style="flex: 1;">
                        <h3 style="color: #333; border-bottom: 2px solid #0d6efd; padding-bottom: 5px; margin-bottom: 10px;">Invoice Details</h3>
                        <p style="margin: 5px 0;"><strong>Invoice Number:</strong> ${s.invoice_number}</p>
                        <p style="margin: 5px 0;"><strong>Date:</strong> ${pe(s.created_at)}</p>
                        <p style="margin: 5px 0;"><strong>Total Amount:</strong> ₹${g}</p>
                        <p style="margin: 5px 0;"><strong>Paid Amount:</strong> ₹${_}</p>
                        <p style="margin: 5px 0;"><strong>Remaining:</strong> ₹${C}</p>
                    </div>
                    <div style="flex: 1;">
                        <h3 style="color: #333; border-bottom: 2px solid #0d6efd; padding-bottom: 5px; margin-bottom: 10px;">Customer Details</h3>
                        <p style="margin: 5px 0;"><strong>Customer Name:</strong> ${l}</p>
                        <p style="margin: 5px 0;"><strong>Mobile:</strong> ${((Je=s.project)==null?void 0:Je.mobile_number)||"-"}</p>
                        <p style="margin: 5px 0;"><strong>Site:</strong> ${((Xe=s.project)==null?void 0:Xe.work_place)||"-"}</p>
                    </div>
                </div>

                <!-- History Table -->
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 12px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">Sr. No.</th>
                            <th style="border: 1px solid #dee2e6; padding: 10px; text-align: center;">Date</th>
                            <th style="border: 1px solid #dee2e6; padding: 10px; text-align: right;">Paid Amount</th>
                            <th style="border: 1px solid #dee2e6; padding: 10px; text-align: right;">Remaining</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${w}
                    </tbody>
                </table>

                <!-- Footer -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6; text-align: center; color: #666; font-size: 12px;">
                    <p>This is a computer-generated document and is valid without signature.</p>
                </div>
            </div>
        `,We=document.createElement("div");We.innerHTML=ge;const ts={margin:[10,10,10,10],filename:`History-${s.invoice_number}-${l}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};try{await is().set(ts).from(We).save(),m("success","History PDF downloaded successfully")}catch(v){console.error("PDF generation error:",v),m("danger","Failed to generate PDF")}};return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx(p,{xs:12,children:e.jsxs(Ae,{className:"shadow-sm",children:[e.jsxs(ke,{className:"bg-light d-flex justify-content-between align-items-center flex-wrap",children:[e.jsxs("div",{children:[e.jsxs("strong",{className:"fs-5",children:["Invoices for ",k]}),e.jsxs(De,{color:"info",className:"ms-2",children:[Re.length," entries"]})]}),e.jsxs("div",{className:"d-flex gap-2 mt-2 mt-md-0",children:[e.jsx(j,{color:"success",onClick:()=>{B(!0);const s=R>0&&R<=X;x(s),F("")},children:"Record Payment"}),e.jsx(j,{color:"secondary",size:"sm",onClick:()=>H(null),children:"Back"})]})]}),e.jsxs(Se,{children:[e.jsxs(U,{className:"g-2 mb-2",children:[e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"p-2 rounded bg-primary text-center text-white shadow-sm",children:[e.jsx("small",{children:"Total"}),e.jsxs("div",{className:"fw-semibold fs-6 mt-1",children:["₹",Oe.toFixed(2)]})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"p-2 rounded bg-success text-center text-white shadow-sm",children:[e.jsx("small",{children:"Paid"}),e.jsxs("div",{className:"fw-semibold fs-6 mt-1",children:["₹",ze.toFixed(2)]})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"p-2 rounded bg-danger text-center text-white shadow-sm",children:[e.jsx("small",{children:"Remaining"}),e.jsxs("div",{className:"fw-semibold fs-6 mt-1",children:["₹",X.toFixed(2)]})]})}),e.jsx(p,{xs:6,md:3,children:e.jsxs("div",{className:"p-2 rounded bg-secondary text-center text-white shadow-sm",children:[e.jsx("small",{children:"Advance"}),e.jsxs("div",{className:"fw-semibold fs-6 mt-1",children:["₹",R.toFixed(2)]})]})})]}),e.jsx("div",{className:"table-responsive",style:{maxHeight:"500px",overflowY:"auto"},children:e.jsxs(fe,{hover:!0,bordered:!0,children:[e.jsx(ye,{style:{position:"sticky",top:0,backgroundColor:"#f8f9fa"},children:e.jsxs(f,{children:[e.jsx(o,{className:"text-center align-middle",children:"Sr. No."}),e.jsx(o,{className:"text-center align-middle",children:"Invoice"}),e.jsx(o,{className:"text-center align-middle",children:"Date"}),e.jsx(o,{className:"text-center align-middle",children:"Total"}),e.jsx(o,{className:"text-center align-middle",children:"Paid"}),e.jsx(o,{className:"text-center align-middle",children:"Remaining"}),e.jsx(o,{className:"text-center align-middle",children:"Mode"}),e.jsx(o,{className:"text-center align-middle",children:"Action"})]})}),e.jsx(be,{children:Re.sort((s,i)=>new Date(i.created_at)-new Date(s.created_at)).map((s,i)=>{const d=(Number(s.total)-Number(s.paid_amount)).toFixed(2);return e.jsxs(f,{className:s.is_advance==1?"table-primary":s.is_fixed_bid==1?"table-warning":"",children:[e.jsx(c,{children:i+1}),e.jsx(c,{children:s.is_advance==1?"Advance Payment":s.invoice_number}),e.jsx(c,{className:"text-center align-middle",children:pe(s.created_at)}),e.jsxs(c,{className:"text-end fw-bold",children:["₹",Number(s.total).toFixed(2)]}),e.jsxs(c,{className:"text-success fw-bold text-end",children:["₹",Number(s.paid_amount).toFixed(2)]}),e.jsxs(c,{className:"text-danger fw-bold text-end",children:["₹",d]}),e.jsx(c,{children:s.payment_mode||"-"}),e.jsx(c,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[s.is_advance==0&&e.jsx(Be,{content:"Add Payment",placement:"top",children:e.jsx(j,{color:"success",size:"sm",onClick:()=>{Me(s),J(!0)},children:e.jsx(K,{icon:ms})})}),s.is_advance==0&&e.jsx(Be,{content:"Payment History",placement:"top",children:e.jsx(j,{color:"info",size:"sm",onClick:()=>{V(s.invoice_number),Ne(!0)},children:e.jsx(K,{icon:xs})})}),e.jsx(Be,{content:s.is_advance==1?"View Advance Invoice":s.is_fixed_bid==1?"View Fixed Bid Invoice":"View Invoice",placement:"top",children:e.jsx(j,{color:s.is_advance==1||s.is_fixed_bid==1?"warning":"secondary",size:"sm",onClick:()=>{s.is_advance==1||s.is_fixed_bid==1?(Y(s.id),P(!0)):(Y(s.id),ee(!0))},children:e.jsx(ps,{})})})]})})]},s.id)})})]})})]})]})})}),e.jsxs(ie,{visible:t,onClose:()=>P(!1),size:"xl",backdrop:"static",children:[e.jsx(ce,{children:e.jsx(de,{children:((Ve=n.find(s=>s.id===$))==null?void 0:Ve.is_fixed_bid)==1?"Fixed Bid Invoice":"Advance Invoice"})}),e.jsx(le,{style:{overflowY:"visible",padding:0},children:e.jsx(us,{paymentId:$})})]}),e.jsxs(ie,{visible:y,onClose:()=>B(!1),children:[e.jsx(ce,{children:e.jsxs(de,{children:["Add Repayment - ",k]})}),e.jsxs(le,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total :"})," ₹",Oe.toFixed(2)]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Advance Paid:"})," ",e.jsxs("span",{className:"text-success",children:["₹",R.toFixed(2)]})]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Paid :"})," ",e.jsxs("span",{className:"text-success",children:["₹",ze.toFixed(2)]})]}),e.jsxs("p",{className:"mb-3",children:[e.jsx("strong",{children:"Remaining :"})," ",e.jsxs("span",{className:"text-danger",children:["₹",X.toFixed(2)]})]}),e.jsx("hr",{}),X>0?e.jsx(e.Fragment,{children:R>0&&R<=X?e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"useAdvanceCheck",checked:I,onChange:s=>x(s.target.checked)}),e.jsxs("label",{className:"form-check-label",htmlFor:"useAdvanceCheck",children:["Clear from Advance (₹",R.toFixed(2),")"]})]}),e.jsx("label",{className:"form-label",children:"Additional Amount"}),e.jsx(Pe,{type:"number",placeholder:"Enter additional amount",value:D,onChange:s=>F(s.target.value),min:"0"}),e.jsxs("div",{className:"mt-2 text-end",children:[e.jsx("strong",{children:"Total Payment: "}),"₹",((I?R:0)+(Number(D)||0)).toFixed(2)]})]}):e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Amount"}),e.jsx(Pe,{type:"number",placeholder:"Enter amount to pay",value:D,onChange:s=>F(s.target.value),min:"0"})]})}):e.jsx("div",{className:"alert alert-success text-center",children:"Payment Complete! No outstanding balance."})]}),e.jsxs(He,{children:[e.jsx(j,{color:"secondary",onClick:()=>{B(!1),x(!1),F("")},children:"Cancel"}),e.jsx(j,{color:"primary",onClick:es,disabled:X<=0,children:"Submit"})]})]}),e.jsxs(ie,{visible:q,onClose:()=>Ne(!1),size:"lg",children:[e.jsx(ce,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center w-100",children:[e.jsx(de,{children:"Payment History"}),e.jsxs(j,{color:"success",size:"sm",className:"me-4",onClick:ss,title:"Download History PDF",children:[e.jsx(K,{icon:Ie,className:"me-1"}),"Download PDF"]})]})}),e.jsx(le,{children:L.filter(s=>(s==null?void 0:s.invoice_id)===T).length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(fe,{striped:!0,hover:!0,bordered:!0,children:[e.jsx(ye,{color:"dark",children:e.jsxs(f,{children:[e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Paid"}),e.jsx(o,{children:"Remaining"})]})}),e.jsx(be,{children:L.filter(s=>(s==null?void 0:s.invoice_id)===T).map((s,i)=>e.jsxs(f,{children:[e.jsx(c,{children:s!=null&&s.date?s.date.slice(0,10).split("-").reverse().join("-"):""}),e.jsxs(c,{children:["₹",s.payment]}),e.jsxs(c,{children:["₹",s.remaining]})]},i))})]})}):e.jsx("div",{className:"text-center py-4 text-muted",children:e.jsx("p",{className:"mb-0",children:"No payment history found for this invoice."})})})]}),e.jsxs(ie,{visible:ve,onClose:()=>J(!1),children:[e.jsx(ce,{closeButton:!0,children:e.jsx(de,{children:"Make Payment"})}),e.jsx(le,{children:h&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Invoice:"})," ",h.invoice_number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total:"})," ₹",h.total]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Remaining:"})," ₹",h.total-h.paid_amount]}),h.total-h.paid_amount>0?e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Amount to Pay"}),e.jsx("input",{type:"number",className:"form-control",value:E,onChange:s=>_e(s.target.value),min:"1",max:h.total-h.paid_amount})]}):e.jsx("div",{className:"alert alert-success text-center",children:"Payment Complete! No outstanding balance."})]})}),e.jsxs(He,{children:[e.jsx(j,{color:"secondary",onClick:()=>J(!1),children:"Cancel"}),e.jsx(j,{color:"success",onClick:()=>{if(!E||Number(E)<=0)return m("danger","Enter a valid amount");const s=Number(h.total)-Number(h.paid_amount);if(Number(E)>s)return m("danger","Amount cannot be greater than remaining amount");Qe()},children:"Confirm"})]})]}),e.jsxs(ie,{visible:W,onClose:()=>ee(!1),size:"xl",backdrop:"static",children:[e.jsx(ce,{children:e.jsx(de,{children:"Invoice"})}),e.jsx(le,{style:{overflowY:"visible",padding:0},children:e.jsx(hs,{projectId:$,inModal:!0})})]})]})};export{zs as default};
