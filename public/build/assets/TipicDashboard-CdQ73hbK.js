import{r as j,b as Ge,j as e}from"./index-Cn-27-TL.js";import{a as o,b as r,c as u}from"./index.esm-2RRpQEeO.js";import{g as We,a as Qe}from"./api-BUyL__Lx.js";import{u as Je,j as He,k as Ke,l as Xe,m as M,C as $}from"./DefaultLayout-Vrb03iJh.js";import{C as Ie}from"./RawMaterial-O4w4bCVl.js";import{C as _,a as C}from"./CCardBody-Bfh-O-BQ.js";import{C as Me}from"./CFormSelect-BzqPV41T.js";import{c as es}from"./cil-building-DVuwBvuD.js";import{c as ss}from"./cil-money-Dk3vHnQB.js";import{C as rs,a as L,b as O}from"./CNavItem-EvCITOBp.js";import{c as is}from"./cil-people-DQU-yEHN.js";import{c as as}from"./cil-credit-card-KG5pHjdT.js";import{C as ls}from"./CInputGroup-DlnfNMD-.js";import{C as ts}from"./CFormInput-CL8d5WGe.js";import{C as ns}from"./CInputGroupText-D1PL96Mo.js";import{c as cs}from"./cil-search-CDkY_4k-.js";import{C as P,a as T,b as p,c as a,d as D,e as i}from"./CTable-CtRsnfwM.js";import{c as ds,a as os}from"./cil-phone-DD-NWLBR.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-CPiMjLs0.js";import"./CFormControlValidation-BvfkKe2L.js";import"./CFormLabel-CFBomnnz.js";var ms=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M450.27,348.569,406.6,267.945V184c0-83.813-68.187-152-152-152s-152,68.187-152,152v83.945L58.928,348.568A24,24,0,0,0,80.031,384h86.935c-.238,2.636-.367,5.3-.367,8a88,88,0,0,0,176,0c0-2.7-.129-5.364-.367-8h86.935a24,24,0,0,0,21.1-35.431ZM310.6,392a56,56,0,1,1-111.419-8H310.018A56.14,56.14,0,0,1,310.6,392ZM93.462,352,134.6,276.055V184a120,120,0,0,1,240,0v92.055L415.736,352Z' class='ci-primary'/>"],xs=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M472,96H384V40H352V96H160V40H128V96H40a24.028,24.028,0,0,0-24,24V456a24.028,24.028,0,0,0,24,24H472a24.028,24.028,0,0,0,24-24V120A24.028,24.028,0,0,0,472,96Zm-8,352H48V128h80v40h32V128H352v40h32V128h80Z' class='ci-primary'/><rect width='32' height='32' x='112' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='224' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='112' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='296' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='112' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='200' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='280' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='368' y='368' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],hs=["512 512","<rect width='32' height='176' x='240' y='176' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='384' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M274.014,16H237.986L16,445.174V496H496V445.174ZM464,464H48V452.959L256,50.826,464,452.959Z' class='ci-primary'/>"];const Ms=()=>{var W,Q,J,K,X,ee,se,re,ie,ae,le,te,ne,ce,de,oe,me,xe,he,je,ue,pe,ve,ge,be,ye,Ne,fe,we,_e,Ce,Se,ke,Ae,Pe,Te,De,Re,Ee;const[m,$e]=j.useState(null),[y,R]=j.useState(0),[U,Le]=j.useState(new Date().toISOString().split("T")[0].slice(0,8)+"01"),[Z,Oe]=j.useState(new Date().toISOString().split("T")[0]),[Y,Ve]=j.useState(""),[Fe,q]=j.useState(!0),[G,ze]=j.useState(null),[x,E]=j.useState("all"),V=new Date().getFullYear(),[S,Ye]=j.useState(V),[H,Be]=j.useState("all"),{showToast:F}=Ge();We(),Je("global");const k=(m==null?void 0:m.sales_summary)||{},A=(m==null?void 0:m.partners_summary)||{},f=(m==null?void 0:m.payment_overview)||{},w=(m==null?void 0:m.commission_summary)||{},t=(m==null?void 0:m.renewal_alerts)||{},B=j.useMemo(()=>{const s=t.expiring_companies||[],g=(t.expired_companies||[]).map(c=>({...c,days_remaining:c.days_remaining!==void 0?c.days_remaining:c.days_overdue?-Math.abs(c.days_overdue):-1})),v=[...s,...g];if(v.length===0)return[];switch(x){case"critical":return v.filter(c=>c.days_remaining<=7&&c.days_remaining>=0);case"upcoming":return v.filter(c=>c.days_remaining>7&&c.days_remaining<=30);case"overdue":return v.filter(c=>c.days_remaining<0);default:return v}},[t.expiring_companies,t.expired_companies,x]),z=s=>{const n=t.expiring_companies||[],v=(t.expired_companies||[]).map(l=>({...l,days_remaining:l.days_remaining!==void 0?l.days_remaining:l.days_overdue?-Math.abs(l.days_overdue):-1})),c=[...n,...v];let h=[],N="";switch(s){case"critical":h=c.filter(l=>l.days_remaining<=7&&l.days_remaining>=0),N="Critical_Renewals";break;case"upcoming":h=c.filter(l=>l.days_remaining>7&&l.days_remaining<=30),N="Upcoming_Renewals";break;case"overdue":h=c.filter(l=>l.days_remaining<0),N="Overdue_Renewals";break;default:h=c,N="All_Renewals"}const I=h.map(l=>{let b;return l.days_remaining<0?b=`${Math.abs(l.days_remaining)} days overdue`:l.days_remaining<=7?b="Critical":l.days_remaining<=15?b="Warning":b="Upcoming",{"Company Name":l.company_name||"N/A","Company ID":l.company_id||"N/A",Email:l.email_id||"N/A","Phone Number":l.phone_no||"N/A","Days Remaining":l.days_remaining,Status:b,"Export Date":new Date().toLocaleDateString(),"Export Time":new Date().toLocaleTimeString()}});console.log(`Attempting to export ${h.length} ${s} records`),console.log("Sample data:",h.slice(0,2)),I.length>0?(Ue(I,N),F("success",`Exported ${I.length} records to ${N}.csv`)):(F("warning",`No ${s} data to export`),console.log("All companies data:",c))},Ue=(s,n)=>{if(s.length===0){F("warning","No data to export");return}const g=Object.keys(s[0]),v=[g.join(","),...s.map(I=>g.map(l=>{const b=I[l]||"";return typeof b=="string"&&(b.includes(",")||b.includes('"'))?`"${b.replace(/"/g,'""')}"`:b}).join(","))].join(`
`),c=new Blob([v],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a"),N=URL.createObjectURL(c);h.setAttribute("href",N),h.setAttribute("download",`${n}.csv`),h.style.visibility="hidden",document.body.appendChild(h),h.click(),document.body.removeChild(h)},Ze=async()=>{try{q(!0);const s=new URLSearchParams({startDate:U,endDate:Z}),n=await Qe(`/api/admin/dashboard/overview?${s.toString()}`);if(n&&n.success)$e(n.data);else throw new Error("Failed to fetch dashboard data")}catch(s){ze("Failed to load dashboard data"),F("danger","Error occurred: "+s.message),console.error("Dashboard fetch error:",s)}finally{q(!1)}};j.useEffect(()=>{let s,n;H==="all"?(s=new Date(S,0,1),n=new Date(S,11,31)):(s=new Date(S,H-1,1),n=new Date(S,H,0)),Le(s.toISOString().split("T")[0]),Oe(n.toISOString().split("T")[0])},[S,H]),j.useEffect(()=>{Ze()},[U,Z]);const d=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(s||0),qe=s=>new Date(s).toLocaleDateString("en-IN");return Fe?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"ms-2",children:"Loading Tipic Admin Dashboard..."})]}):G?e.jsxs(Ie,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",G]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mb-4",children:e.jsx(C,{children:e.jsxs(o,{className:"align-items-center",children:[e.jsxs(r,{children:[e.jsx("h2",{className:"mb-1",children:"Tipic Admin Dashboard"}),e.jsx("p",{className:"text-muted mb-0",children:"Complete business overview and analytics"})]}),e.jsx(r,{xs:"auto",children:e.jsxs(o,{className:"g-2",children:[e.jsxs(r,{children:[e.jsx("label",{className:"form-label small",children:"Select Month"}),e.jsxs(Me,{size:"sm",value:H,onChange:s=>Be(s.target.value),children:[e.jsx("option",{value:"all",children:"All Months"}),[...Array(12).keys()].map(s=>e.jsx("option",{value:s+1,children:new Date(0,s).toLocaleString("default",{month:"long"})},s+1))]})]}),e.jsxs(r,{children:[e.jsx("label",{className:"form-label small",children:"Select Year"}),e.jsx(Me,{size:"sm",value:S,onChange:s=>Ye(parseInt(s.target.value)),children:[...Array(5).keys()].map(s=>e.jsx("option",{value:V-s,children:V-s},V-s))})]})]})})]})})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{sm:6,lg:3,children:e.jsx(_,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:es,className:"text-primary",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Active Companies"}),e.jsx("div",{className:"fs-4 fw-semibold",children:((W=k.summary)==null?void 0:W.total_companies)||0})]})]})})})}),e.jsx(r,{sm:6,lg:3,children:e.jsx(_,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:He,className:"text-success",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Companies Sales"}),e.jsx("div",{className:"fs-4 fw-semibold",children:d((Q=k.summary)==null?void 0:Q.total_sales)})]})]})})})}),e.jsx(r,{sm:6,lg:3,children:e.jsx(_,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:ss,className:"text-warning",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Commission"}),e.jsx("div",{className:"fs-4 fw-semibold",children:d((J=w.summary)==null?void 0:J.total_commission_paid)})]})]})})})}),e.jsx(r,{sm:6,lg:3,children:e.jsx(_,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-danger bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:ms,className:"text-danger",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Renewal Alerts"}),e.jsx("div",{className:"fs-4 fw-semibold",children:((K=t.renewal_stats)==null?void 0:K.total_requiring_attention)||0})]})]})})})})]}),t.renewal_stats&&t.renewal_stats.total_requiring_attention>0&&e.jsxs(Ie,{color:"warning",className:"mb-4",children:[e.jsx(u,{icon:hs,className:"me-2"}),e.jsx("strong",{children:"Attention Required:"})," ",t.renewal_stats.critical_renewals," critical renewals,"," ",t.renewal_stats.upcoming_renewals," upcoming renewals, and"," ",t.renewal_stats.overdue_renewals," overdue subscriptions need follow-up."]}),e.jsx(_,{children:e.jsxs(C,{children:[e.jsxs(rs,{variant:"tabs",role:"tablist",children:[e.jsx(L,{children:e.jsxs(O,{active:y===0,onClick:()=>R(0),style:{cursor:"pointer"},children:[e.jsx(u,{icon:He,className:"me-2"}),"Sales Summary"]})}),e.jsx(L,{children:e.jsxs(O,{active:y===1,onClick:()=>R(1),style:{cursor:"pointer"},children:[e.jsx(u,{icon:is,className:"me-2"}),"Partners Summary"]})}),e.jsx(L,{children:e.jsxs(O,{active:y===2,onClick:()=>R(2),style:{cursor:"pointer"},children:[e.jsx(u,{icon:as,className:"me-2"}),"Payment Overview"]})}),e.jsx(L,{children:e.jsxs(O,{active:y===3,onClick:()=>R(3),style:{cursor:"pointer"},children:[e.jsx(u,{icon:Ke,className:"me-2"}),"Commission Details"]})}),e.jsx(L,{children:e.jsxs(O,{active:y===4,onClick:()=>R(4),style:{cursor:"pointer"},children:[e.jsx(u,{icon:xs,className:"me-2"}),"Renewal Alerts"]})})]}),e.jsxs(Xe,{className:"mt-3",children:[e.jsxs(M,{role:"tabpanel",visible:y===0,children:[e.jsxs(o,{className:"mb-3",children:[e.jsxs(r,{children:[e.jsx("h4",{children:"All Companies Sales Summary"}),e.jsx("p",{className:"text-muted",children:"Sales performance of all onboarded companies"})]}),e.jsx(r,{md:4,children:e.jsxs(ls,{size:"sm",children:[e.jsx(ts,{placeholder:"Search companies...",value:Y,onChange:s=>Ve(s.target.value)}),e.jsx(ns,{children:e.jsx(u,{icon:cs})})]})})]}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Orders"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((X=k.summary)==null?void 0:X.total_orders)||0})]})}),e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-secondary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Avg Sale/Company"}),e.jsx("div",{className:"fs-6 fw-bold text-secondary",children:d((ee=k.summary)==null?void 0:ee.average_sale_per_company)})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(a,{style:{width:"25%"},children:"Company Details"}),e.jsx(a,{style:{width:"25%"},children:"Partner"}),e.jsx(a,{style:{width:"25%"},children:"Orders"}),e.jsx(a,{style:{width:"25%"},children:"Total Sales"})]})}),e.jsx(D,{children:(se=k.companies_sales)==null?void 0:se.filter(s=>!Y||s.company_name.toLowerCase().includes(Y.toLowerCase())).map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.phone_no]})]})}),e.jsx(i,{children:s.partner_name?e.jsxs("div",{children:[e.jsx("div",{children:s.partner_name}),e.jsx("div",{className:"text-muted small",children:s.partner_mobile})]}):e.jsx("span",{className:"text-muted",children:"Direct"})}),e.jsx(i,{className:"fw-semibold",children:s.total_orders}),e.jsx(i,{className:" fw-semibold",children:d(s.total_sales)})]},n))})]})})]}),e.jsxs(M,{role:"tabpanel",visible:y===1,children:[e.jsx(o,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx("h4",{children:"Sales Partners Performance"}),e.jsx("p",{className:"text-muted",children:"Customer onboarding by sales partners"})]})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Partners"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((re=A.summary)==null?void 0:re.total_partners)||0})]})}),e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Active Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:((ie=A.summary)==null?void 0:ie.total_active_customers)||0})]})}),e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Blocked Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:((ae=A.summary)==null?void 0:ae.total_blocked_customers)||0})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total New Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-info",children:((le=A.summary)==null?void 0:le.total_end_customers)||0})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(a,{children:"Partner Details"}),e.jsx(a,{children:"Partner Type"}),e.jsx(a,{className:"text-center",children:"Companies Onboarded"}),e.jsx(a,{className:"text-center",children:"Active/Blocked"}),e.jsx(a,{className:"text-center",children:"Recent Growth"})]})}),e.jsx(D,{children:(te=A.partners)==null?void 0:te.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.partner_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.partner_mobile]}),e.jsxs("div",{className:"text-muted small",children:["Email: ",s.partner_email]})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx($,{color:"info",children:s.partner_type}),e.jsxs("div",{className:"text-muted small mt-1",children:["Commission: ",s.commission_rate,"%"]})]})}),e.jsx(i,{className:"text-center fw-semibold",children:s.total_customers_onboarded}),e.jsxs(i,{className:"text-center",children:[e.jsxs("div",{className:"text-success",children:[s.active_customers," Active"]}),e.jsxs("div",{className:"text-danger",children:[s.blocked_customers," Blocked"]})]}),e.jsx(i,{className:"text-center",children:e.jsxs($,{color:"success",children:["+",s.new_customers_last_30_days," (30d)"]})})]},n))})]})})]}),e.jsxs(M,{role:"tabpanel",visible:y===2,children:[e.jsx(o,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx("h4",{children:"Payment Overview"}),e.jsx("p",{className:"text-muted",children:"Payment details across all categories"})]})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Subscription Revenue"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:d((ne=f.summary)==null?void 0:ne.total_subscription_revenue)})]})}),e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Partner Commission"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:d((ce=f.summary)==null?void 0:ce.total_partner_commission)})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Customer Outstanding"}),e.jsx("div",{className:"fs-6 fw-bold text-info",children:d((de=f.summary)==null?void 0:de.total_customer_outstanding)})]})}),e.jsx(r,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Receivable"}),e.jsx("div",{className:"fs-6 fw-bold text-primary",children:d((oe=f.summary)==null?void 0:oe.total_customer_receivable)})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-danger bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Payable"}),e.jsx("div",{className:"fs-6 fw-bold text-danger",children:d((me=f.summary)==null?void 0:me.total_customer_payable)})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Subscription Payments"}),e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{children:e.jsxs(p,{children:[e.jsx(a,{children:"Plan Name"}),e.jsx(a,{children:"Plan Price"}),e.jsx(a,{className:"text-center",children:"Total Subscriptions"}),e.jsx(a,{className:"text-center",children:"Total Revenue"})]})}),e.jsx(D,{children:(xe=f.subscription_payments)==null?void 0:xe.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{className:"fw-semibold",children:s.plan_name}),e.jsx(i,{children:d(s.plan_price)}),e.jsx(i,{className:"text-center",children:s.total_subscriptions}),e.jsx(i,{className:"text-center fw-semibold",children:d(s.total_revenue)})]},n))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Customer Payment Details"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(a,{children:"Company"}),e.jsx(a,{children:"Plan"}),e.jsx(a,{className:"text-center",children:"Amount Paid"}),e.jsx(a,{className:"text-center",children:"Outstanding"}),e.jsx(a,{className:"text-center",children:"Payment Status"}),e.jsx(a,{className:"text-center",children:"Last Payment"})]})}),e.jsx(D,{children:(he=f.customer_payments)==null?void 0:he.map((s,n)=>{var g;return e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsx("div",{className:"text-muted small",children:s.owner_name})]})}),e.jsx(i,{children:e.jsx($,{color:"info",children:s.plan_name})}),e.jsx(i,{className:"text-center text-success fw-semibold",children:d(s.amount_paid)}),e.jsx(i,{className:"text-center text-warning",children:d(s.outstanding_amount)}),e.jsx(i,{className:"text-center",children:e.jsx($,{color:s.payment_status==="paid"?"success":s.payment_status==="partial"?"warning":"danger",children:(g=s.payment_status)==null?void 0:g.toUpperCase()})}),e.jsx(i,{className:"text-center",children:s.last_payment_date?qe(s.last_payment_date):"N/A"})]},n)})})]})})]})]}),e.jsxs(M,{role:"tabpanel",visible:y===3,children:[e.jsx(o,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx("h4",{children:"Commission Calculation Summary"}),e.jsxs("p",{className:"text-muted",children:["Commission details for all sales partners - ",(je=w.period)==null?void 0:je.month_name]})]})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Commission Paid"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:d((ue=w.summary)==null?void 0:ue.total_commission_paid)})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Revenue Generated"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:d((pe=w.summary)==null?void 0:pe.total_revenue_generated)})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Partners with Earnings"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((ve=w.summary)==null?void 0:ve.partners_with_earnings)||0})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Avg Commission/Partner"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:d((ge=w.summary)==null?void 0:ge.average_commission_per_partner)})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(a,{children:"Partner Details"}),e.jsx(a,{children:"Partner Type"}),e.jsx(a,{className:"text-center",children:"Referred Companies"}),e.jsx(a,{className:"text-center",children:"Companies with Payments"}),e.jsx(a,{className:"text-center",children:"Revenue Generated"}),e.jsx(a,{className:"text-center",children:"Commission Earned"})]})}),e.jsx(D,{children:(be=w.partners_commission)==null?void 0:be.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.partner_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.partner_mobile]}),e.jsxs("div",{className:"text-muted small",children:["Email: ",s.partner_email]})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx($,{color:"info",children:s.partner_type}),e.jsxs("div",{className:"text-muted small mt-1",children:["Rate: ",s.commission_rate,"%"]})]})}),e.jsx(i,{className:"text-center fw-semibold",children:s.total_referred_companies}),e.jsx(i,{className:"text-center",children:s.companies_with_payments}),e.jsx(i,{className:"text-center text-success fw-semibold",children:d(s.revenue_generated)}),e.jsx(i,{className:"text-center text-warning fw-semibold",children:d(s.commission_earned)})]},n))})]})})]}),e.jsxs(M,{role:"tabpanel",visible:y===4,children:[e.jsx(o,{className:"mb-3",children:e.jsxs(r,{children:[e.jsx("h4",{children:"Subscription Renewal Alerts"}),e.jsx("p",{className:"text-muted",children:"Companies requiring subscription renewal follow-up"})]})}),e.jsxs(o,{className:"mb-4",children:[e.jsx(r,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-warning bg-opacity-10 rounded cursor-pointer border ${x==="critical"?"border-warning border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="critical"?"all":"critical"),title:"Click to filter critical renewals",children:[e.jsx("div",{className:"text-muted small",children:"Critical (â‰¤7 days)"}),e.jsx("div",{className:"fs-5 fw-bold text-warning",children:((ye=t.summary)==null?void 0:ye.critical_renewals)||0}),x==="critical"&&e.jsx("div",{className:"small text-warning mt-1",children:"â— Filtered"})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-info bg-opacity-10 rounded cursor-pointer border ${x==="upcoming"?"border-info border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="upcoming"?"all":"upcoming"),title:"Click to filter upcoming renewals",children:[e.jsx("div",{className:"text-muted small",children:"Upcoming (â‰¤30 days)"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((Ne=t.summary)==null?void 0:Ne.upcoming_renewals)||0}),x==="upcoming"&&e.jsx("div",{className:"small text-info mt-1",children:"â— Filtered"})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-danger bg-opacity-10 rounded cursor-pointer border ${x==="overdue"?"border-danger border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="overdue"?"all":"overdue"),title:"Click to filter overdue renewals",children:[e.jsx("div",{className:"text-muted small",children:"Overdue"}),e.jsx("div",{className:"fs-5 fw-bold text-danger",children:((fe=t.summary)==null?void 0:fe.overdue_renewals)||0}),x==="overdue"&&e.jsx("div",{className:"small text-danger mt-1",children:"â— Filtered"})]})}),e.jsx(r,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-info bg-opacity-10 rounded cursor-pointer border ${x==="all"?"border-info border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E("all"),title:"Click to show all renewals",children:[e.jsx("div",{className:"text-muted small",children:"Total Requiring Attention"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((we=t.renewal_stats)==null?void 0:we.total_requiring_attention)||0}),x==="all"&&e.jsx("div",{className:"small text-info mt-1",children:"â— All Data"})]})})]}),x!=="all"&&e.jsx(o,{className:"mb-3",children:e.jsx(r,{children:e.jsxs("div",{className:"alert alert-danger d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Filter Active:"})," Showing ",B.length," ",x," renewal(s)"]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>E("all"),children:"Clear Filter"})]})})}),e.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(a,{children:"Company Name"}),e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Days Remaining"}),e.jsx(a,{children:"Call"}),e.jsx(a,{children:"Message"})]})}),e.jsxs(D,{children:[B.map((s,n)=>{var g,v;return e.jsxs(p,{className:s.days_remaining<0?"table-danger":s.days_remaining<=7?"table-warning":s.days_remaining<=15?"table-info":"",children:[e.jsxs(i,{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsxs("div",{className:"text-muted small",children:["ID: ",s.company_id]})]}),e.jsx(i,{children:s.email_id||"N/A"}),e.jsx(i,{children:s.days_remaining>=0?e.jsxs("span",{className:`fw-bold ${s.days_remaining<=7?"text-warning":(s.days_remaining<=15,"text-info")}`,children:[s.days_remaining," days left"]}):e.jsxs("span",{className:"fw-bold text-danger",children:[Math.abs(s.days_remaining)," days overdue"]})}),e.jsx(i,{className:"text-center",children:e.jsx("a",{className:"btn btn-outline-primary btn-sm",href:`tel:+91${(g=s.phone_no)==null?void 0:g.replace(/^(\+91)?/,"")}`,title:"Call Customer",children:e.jsx(u,{icon:ds})})}),e.jsx(i,{className:"text-center",children:e.jsx("a",{className:"btn btn-outline-success btn-sm",href:`sms:+91${(v=s.phone_no)==null?void 0:v.replace(/^(\+91)?/,"")}?body=${encodeURIComponent(s.days_remaining>=0?`Hi ${s.company_name}, your subscription expires in ${s.days_remaining} days.

Available Plans:
- Yearly Plan: â‚¹9999
- Half Yearly Plan: â‚¹4999.50

Please renew soon to continue enjoying our services-TiPic ConsulTech.`:`Hi ${s.company_name}, your subscription expired ${Math.abs(s.days_remaining)} days ago.

Available Plans:
- Yearly Plan: â‚¹9999
- Half Yearly Plan: â‚¹4999.50

Please renew immediately to restore services.`)}`,title:"Send SMS",children:e.jsx(u,{icon:os})})})]},n)}),B.length===0&&e.jsx(p,{children:e.jsx(i,{colSpan:5,className:"text-center text-muted py-4",children:e.jsxs("div",{className:"py-3",children:[e.jsx("div",{className:"fs-5 mb-2",children:"ðŸ“‹"}),e.jsx("div",{children:"No companies found for the selected filter."}),e.jsx("small",{className:"text-muted",children:"Try selecting a different filter or clear the current filter."})]})})})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{children:"Quick Actions"}),e.jsxs(o,{className:"mb-3",children:[e.jsx(r,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-warning",onClick:()=>z("critical"),disabled:!((_e=t.summary)!=null&&_e.critical_renewals),children:["Export Critical Renewals (",((Ce=t.summary)==null?void 0:Ce.critical_renewals)||0,")"]})})}),e.jsx(r,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-info",onClick:()=>z("upcoming"),disabled:!((Se=t.summary)!=null&&Se.upcoming_renewals),children:["Export Upcoming Renewals (",((ke=t.summary)==null?void 0:ke.upcoming_renewals)||0,")"]})})}),e.jsx(r,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-danger",onClick:()=>z("overdue"),disabled:!((Ae=t.summary)!=null&&Ae.overdue_renewals),children:["Export Overdue Renewals (",((Pe=t.summary)==null?void 0:Pe.overdue_renewals)||0,")"]})})}),e.jsx(r,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-info",onClick:()=>z("all"),disabled:!((Te=t.expiring_companies)!=null&&Te.length),children:["Export All Renewals (",((De=t.expiring_companies)==null?void 0:De.length)||0,")"]})})})]})]})]})]})]})}),e.jsxs(o,{className:"mt-4 mb-5",children:["  ",e.jsx(r,{md:6,children:e.jsx(_,{children:e.jsxs(C,{children:[e.jsx("h5",{children:"System Health"}),e.jsxs("div",{className:"row text-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"text-muted small",children:"Active Partners"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((Re=A.summary)==null?void 0:Re.total_partners)||0})]}),e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"text-muted small",children:"Active Companies"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((Ee=k.summary)==null?void 0:Ee.total_companies)||0})]})]})]})})})]})]})};export{Ms as default};
