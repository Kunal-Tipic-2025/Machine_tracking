import{u as q,b as I,r as c,j as e}from"./index-Cn-27-TL.js";import{g as F,a as v,h as H}from"./api-BUyL__Lx.js";import{C as L,a as z}from"./CCardBody-Bfh-O-BQ.js";import{C as B}from"./CCardHeader-DyQDv_BY.js";import{a as x,b as o,d as m}from"./index.esm-2RRpQEeO.js";import{C as j}from"./CFormLabel-CFBomnnz.js";import{C as N}from"./CFormInput-CL8d5WGe.js";import{C as f}from"./CFormSelect-BzqPV41T.js";import"./CFormControlWrapper-CPiMjLs0.js";import"./CFormControlValidation-BvfkKe2L.js";function Z(){const h=F(),p=h==null?void 0:h.company_info,b=q(),{showToast:i}=I(),[n,l]=c.useState({machine_name:"",register_number:"",ownership_type:"",operator_id:[],mode_id:[],company_id:(p==null?void 0:p.company_id)||null}),[_,w]=c.useState([]),[y,M]=c.useState([]),[d,C]=c.useState([]),S=async()=>{try{const r=(await v("/api/appUsers")).data.filter(a=>a.type===2);w(r)}catch(s){console.error("Error fetching Users:",s),i("danger","Error fetching Users")}},R=async()=>{try{const s=await v("/api/machine-price");M(s||[])}catch(s){console.error("Error fetching modes:",s),i("danger","Error fetching modes")}};c.useEffect(()=>{S(),R()},[]);const u=s=>{const{name:r,value:a}=s.target;l({...n,[r]:a})},A=s=>{const r=s.target.value;r&&(l(a=>a.operator_id.includes(String(r))?a:{...a,operator_id:[...a.operator_id,String(r)]}),s.target.value="")},O=s=>{l(r=>({...r,operator_id:r.operator_id.filter(a=>String(a)!==String(s))}))},E=s=>{const r=s.target.value;if(!r||d.some(t=>t.mode===r))return;const a=y.find(t=>t.mode===r);a&&(C(t=>[...t,a]),l(t=>({...t,mode_id:[...t.mode_id,String(a.id)]})),s.target.value="")},k=s=>{const r=d[s],a=d.filter((t,g)=>g!==s);C(a),l(t=>({...t,mode_id:t.mode_id.filter(g=>String(g)!==String(r.id))}))},T=async()=>{var s,r;if(!n.machine_name.trim())return i("danger","Machine Name is required");if(!n.register_number.trim())return i("danger","Registration Number is required");if(!n.ownership_type)return i("danger","Ownership Type is required");try{await H("/api/machine-operators",{machine_name:n.machine_name,register_number:n.register_number,ownership_type:n.ownership_type,operator_id:n.operator_id,mode_id:n.mode_id,company_id:n.company_id}),i("success","Machine added successfully!"),b("/MachineriesTable")}catch(a){const t=((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||a.message;i("danger",t)}},U=[...new Set(y.map(s=>s.mode))].filter(s=>!d.some(r=>r.mode===s));return e.jsxs(L,{className:"mb-4",children:[e.jsx(B,{children:e.jsx("strong",{children:"Add New Machinery"})}),e.jsxs(z,{children:[e.jsxs(x,{children:[e.jsxs(o,{md:4,children:[e.jsx(j,{children:"Machine Name"}),e.jsx(N,{name:"machine_name",placeholder:"Enter Machine Name",value:n.machine_name,onChange:u})]}),e.jsxs(o,{md:4,children:[e.jsx(j,{children:"Reg. Number"}),e.jsx(N,{name:"register_number",placeholder:"Enter Registration Number",value:n.register_number,onChange:u})]}),e.jsxs(o,{md:4,children:[e.jsx(j,{children:"Ownership Type"}),e.jsxs(f,{name:"ownership_type",value:n.ownership_type,onChange:u,children:[e.jsx("option",{value:"",children:"-- Select Ownership Type --"}),e.jsx("option",{value:"owned",children:"Own"}),e.jsx("option",{value:"rented",children:"Rent"}),e.jsx("option",{value:"leased",children:"Lease"})]})]})]}),e.jsxs("div",{className:"position-relative mt-4",children:[e.jsx("span",{className:"fw-bold text-primary",children:"Add Modes"}),e.jsx("hr",{className:"mt-2 border-2 border-primary"})]}),e.jsxs(x,{className:"align-items-start mt-3",children:[e.jsx(o,{md:6,children:e.jsxs(f,{className:"mt-2",defaultValue:"",onChange:E,label:"Add Mode",children:[e.jsx("option",{value:"",children:"-- Select Mode --"}),U.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsxs(o,{md:6,children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Assigned Modes"})}),e.jsx("div",{className:"p-2 border rounded bg-light",style:{maxHeight:"250px",overflowY:"auto"},children:d.length>0?d.map((s,r)=>e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("span",{children:[e.jsx("span",{style:{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:"#0d6efd",marginRight:"8px"}}),s.mode," - ",e.jsxs("span",{className:"fw-semibold",children:["â‚¹",s.price]})]}),e.jsx(m,{color:"danger",size:"sm",onClick:()=>k(r),children:"Remove"})]},r)):e.jsx("div",{className:"text-muted",children:"No modes assigned"})})]})]}),e.jsxs("div",{className:"position-relative mt-4",children:[e.jsx("span",{className:"fw-bold text-primary",children:"Add Operators"}),e.jsx("hr",{className:"mt-2 border-2 border-primary"})]}),e.jsxs(x,{className:"align-items-start mt-3",children:[e.jsx(o,{md:6,children:e.jsxs(f,{className:"mt-2",defaultValue:"",onChange:A,label:"Add Operator",children:[e.jsx("option",{value:"",children:"-- Select Operator --"}),_.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsxs(o,{md:6,children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Assigned Operators"})}),e.jsx("div",{className:"p-2 border rounded bg-light",style:{maxHeight:"250px",overflowY:"auto"},children:n.operator_id.length>0?n.operator_id.map(s=>{const r=_.find(a=>String(a.id)===String(s));return e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsxs("span",{children:[e.jsx("span",{style:{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:"#0d6efd",marginRight:"8px"}}),r?r.name:`Operator ID ${s}`]}),e.jsx(m,{color:"danger",size:"sm",onClick:()=>O(s),children:"Remove"})]},s)}):e.jsx("div",{className:"text-muted",children:"No operators assigned"})})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(m,{color:"primary",onClick:T,children:"Add Machinery"}),e.jsx(m,{color:"secondary",className:"ms-2",onClick:()=>b("/MachineriesTable"),children:"Cancel"})]})]})]})}export{Z as default};
