import{r as i,b as da,u as ma,j as a}from"./index-WEbTLRLZ.js";import{c as A,a as U,b as f,d as p}from"./index.esm-CZeMoYDH.js";import{g as ha,a as M,p as le,c as ua}from"./api-Ba1wfMeh.js";import{S as de}from"./react-select.esm-tOfyDdog.js";import{C as Fe}from"./RawMaterial-Cd7YjP3x.js";import{C as H,a as D}from"./CCardBody-CtNgr8m7.js";import{C as pa}from"./CCardHeader-LFhc_ZAM.js";import{g as ga,a as Ae,b as Ie,e as Te,c as $e,d as Oe}from"./DefaultLayout-CnBEfSKd.js";import{C as ze}from"./CForm-J01-VhG4.js";import{C as j}from"./CFormLabel-D964ZFYD.js";import{C as fa}from"./CInputGroup-Ds1aMRVv.js";import{C}from"./CFormInput-D3dwui72.js";import{c as Le}from"./cil-x-0440B5Ce.js";import{c as Ue}from"./cil-file-CeQgYs_D.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-Dj9ObznP.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./cil-user-Dlmw-Gem.js";import"./CNavItem-u5MAKPdZ.js";import"./CFormControlWrapper-DljGJ9Vz.js";var _a=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M471.993,112h-89.2L366.551,65.25a32.023,32.023,0,0,0-30.229-21.5H175.241a31.991,31.991,0,0,0-30.294,21.691L129.1,112h-89.1a24.027,24.027,0,0,0-24,24V448a24.027,24.027,0,0,0,24,24H471.993a24.027,24.027,0,0,0,24-24V136A24.027,24.027,0,0,0,471.993,112Zm-8,328H48.007V144h104.01l23.224-68.25H336.322L360.032,144H463.993Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M256,168A114,114,0,1,0,370,282,114.13,114.13,0,0,0,256,168Zm0,196a82,82,0,1,1,82-82A82.093,82.093,0,0,1,256,364Z' class='ci-primary'/>"];const ee=()=>new Date().toISOString().split("T")[0],He=()=>({project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null}]}),Da=()=>{var ke;const c=ha(),_=c==null?void 0:c.type;c==null||c.name;const[d,v]=i.useState(()=>{var e;return{project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:_===2&&((e=c==null?void 0:c.id)==null?void 0:e.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null}]}}),{showToast:o}=da(),[De,ae]=i.useState(!1),[me,se]=i.useState([]),[B,b]=i.useState(""),[q,he]=i.useState([]),[I,Be]=i.useState([]),[qe,te]=i.useState([]),[Ve,w]=i.useState(!1),[ue,Ge]=i.useState(0),[T,V]=i.useState(!1),[pe,G]=i.useState(null),[re,Z]=i.useState(null),[ne,Ze]=i.useState(null),[$,Qe]=i.useState(""),[R,N]=i.useState([]);i.useState([]);const[ge,fe]=i.useState(!1),[_e,je]=i.useState(!1),[xe,ie]=i.useState([]),[ce,Q]=i.useState(!1),[g,Y]=i.useState({customer_name:"",mobile_number:"",project_cost:"",supervisor_id:"",work_place:"",commission:"",start_date:"",end_date:"",is_visible:!0,remark:"",gst_number:"",operator_id:[""]}),[ve,O]=i.useState({}),[ye,W]=i.useState(!1),[ja,Ye]=i.useState([]),[xa,We]=i.useState([]),[va,Xe]=i.useState({}),[P,Je]=i.useState(!1),[X,Ce]=i.useState("environment"),J=i.useCallback(()=>{var e;v({project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:_===2&&((e=c==null?void 0:c.id)==null?void 0:e.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null}]}),b(""),N([]),k(!1),te([]),w(!1)},[_,c==null?void 0:c.id]);i.useEffect(()=>{J()},[J]),i.useEffect(()=>{const e=async()=>{try{const r=await M("/api/operatorsByCompanyIdOperator");Ye(r||[])}catch(r){console.error("Error fetching operators:",r)}},s=async()=>{try{const r=await M("/api/machine-operators");We(r||[]);const t={};r==null||r.forEach(l=>{Array.isArray(l.operator_id)&&l.operator_id.forEach(n=>{t[n]||(t[n]=[]),t[n].push(l)})}),Xe(t)}catch(r){console.error("Error fetching machines:",r)}};ce&&(e(),s())},[ce]);const[E,k]=i.useState(!1);ma();const be=async(e,s)=>{if(!e)return o("danger","No image file to upload."),null;const r=new FormData;r.append("file",e),r.append("dest",s);try{const t=await ua("/api/fileUpload",r);if(t&&t.success)return o("success",t.message),t.fileName;throw new Error(t.message||"File upload failed.")}catch(t){return console.error("Error uploading image:",t),o("danger",t.message||"Could not upload image."),null}},z=i.useRef(null),oe=i.useRef(null),F=i.useRef(null);i.useRef(!1),q.filter(e=>qe.includes(e.value));const K=i.useCallback(async e=>{try{const s=await M(`/api/projects?searchQuery=${e}`);se(s||[])}catch(s){console.error("Error fetching projects:",s),se([])}},[]);i.useEffect(()=>{M("/api/operatorsByType").then(e=>{const s=e.map(r=>({value:r.id.toString(),label:r.name}));if(_===2&&(c!=null&&c.id)){const r=s.find(t=>t.value===c.id.toString());he(r?[r]:s)}else he(s)}).catch(e=>{console.error("Error fetching operators:",e)})},[_,c==null?void 0:c.id]),i.useEffect(()=>{(async()=>{try{const s=await M("/api/machine-operators");console.log("machines from workslog",s),Array.isArray(s)&&Be(s)}catch(s){console.error("Error fetching machineries:",s)}})()},[]),i.useEffect(()=>{(async()=>{try{const s=await M("/api/machine-price");console.log("machine prices",s),Array.isArray(s)?ie(s):(console.error("Unexpected response format:",s),ie([]))}catch(s){console.error("Error fetching machine prices:",s),ie([])}})()},[]),i.useEffect(()=>{const e=setTimeout(()=>{K(B)},300);return()=>clearTimeout(e)},[B,K]);const Ke=()=>{b(""),K(""),w(!0)},we=i.useCallback(async()=>{if(!P)try{const e={video:{facingMode:X,width:{ideal:1280},height:{ideal:720}}},s=await navigator.mediaDevices.getUserMedia(e);F.current=s,z.current&&(z.current.srcObject=s)}catch(e){console.error("Camera access failed:",e),o("danger","Camera access denied. Please allow camera permission."),Je(!0)}},[X,P,o]),L=i.useCallback(()=>{F.current&&(F.current.getTracks().forEach(e=>e.stop()),F.current=null)},[]),Se=i.useCallback((e,s=.7,r=800,t=600)=>new Promise(l=>{const n=document.createElement("canvas"),u=n.getContext("2d"),m=new Image;m.onload=()=>{let{width:h,height:x}=m;if(h>r||x>t){const S=Math.min(r/h,t/x);h*=S,x*=S}n.width=h,n.height=x,u.drawImage(m,0,0,h,x),n.toBlob(S=>{const la=new File([S],"machine_photo.jpg",{type:"image/jpeg",lastModified:Date.now()});l(la)},"image/jpeg",s)},m.src=URL.createObjectURL(e)}),[]),ea=i.useCallback(async()=>{if(!z.current||!oe.current)return;const e=oe.current,s=z.current,r=e.getContext("2d");e.width=s.videoWidth,e.height=s.videoHeight,r.drawImage(s,0,0),e.toBlob(async t=>{if(t){G(URL.createObjectURL(t));const l=await Se(t);Z(l),o("success","Photo captured successfully")}},"image/jpeg",.8)},[Se,o]),Ne=i.useCallback((e,s)=>{Ze(e),Qe(s),G(null),Z(null),V(!0)},[]),aa=i.useCallback(async()=>{if(!re){o("warning","Please capture a photo");return}const s=await be(re,$==="start"?"machine_start_photos":"machine_end_photos");if(s){if(E&&$==="end"){const r=[...R];r[ne].machine_end_pic=s,N(r)}else{const r=$==="start"?"machine_start_pic":"machine_end_pic",t=[...d.machineReading];t[ne][r]=s,v({...d,machineReading:t})}V(!1),G(null),Z(null),L()}},[re,ne,$,d,R,E,L,o,be]),sa=(e,s)=>{const r=[...d.machineReading];r[e][s]=null,v({...d,machineReading:r})},ta=(e,s)=>{if(!e||!s)return 0;const r=parseFloat(s)-parseFloat(e);return r>=0?r.toFixed(2):0},y=(e,s,r)=>{const t=[...d.machineReading];t[e][s]=r,(s==="machine_start"||s==="machine_end")&&(t[e].actual_machine_hr=ta(t[e].machine_start,t[e].machine_end)),v({...d,machineReading:t})},Me=(e,s,r)=>{const t=[...R];if(s==="machine_end"){let u=r.replace(/[^0-9.]/g,"");const m=u.split(".");m.length>2&&(u=m[0]+"."+m.slice(1).join("")),t[e][s]=u}else t[e][s]=r;const l=parseFloat(t[e].start_reading)||0,n=parseFloat(t[e].machine_end);!isNaN(n)&&n>0?t[e].actual_machine_hr=(n-l>=0?n-l:0).toFixed(2):t[e].actual_machine_hr=0,N(t)},Re=i.useCallback(async e=>{if(!e)return[];try{const s=await M(`/api/pending?project_id=${e}`);return console.log("pending",s),Array.isArray(s)?s:[]}catch(s){return console.error("Error fetching pending readings from server",s),[]}},[]),Pe=async e=>{v(s=>({...s,project_id:e.id,project_name:e.project_name})),te(e.operator_id||[]),b(e.customer_name),se([]),w(!1);try{const s=await Re(e.id);s&&s.length>0?(o("info",`Found ${s.length} machine(s) with pending end readings.`),N(s),k(!0)):(o("success","No pending readings found. You can add new start readings."),k(!1))}catch(s){console.error("Error fetching pending readings:",s),o("danger","Failed to check project status from the server.")}},ra=(e,s)=>{v(r=>({...r,[e]:s}))},na=i.useCallback(async e=>{fe(!0);try{console.log("validReadings"),console.log(e);const s=e.map(r=>{const t={project_id:d.project_id,machine_id:r.machine_id,operator_id:r.operator_id,mode_id:r.mode_id,machine_start:r.machine_start,date:d.date,machine_start_pic:r.machine_start_pic};return le("/api/start",t)});await Promise.all(s)}finally{fe(!1)}},[d.date,d.project_id]),ia=async()=>{if(!d.project_id){o("danger","Please select a Customer.");return}_===2&&(d.machineReading=d.machineReading.map(t=>({...t,operator_id:c.id.toString()})));const e=[],s=[],r=[];if(d.machineReading.forEach((t,l)=>{const n=t.operator_id&&t.machine_id&&t.mode_id&&t.machine_start,u=_===2?!!t.machine_start_pic:!0;n&&u?e.push(t):n?u||s.push(l+1):r.push(l+1)}),e.length===0){s.length>0?o("danger",`Start photo is required for row(s): ${s.join(", ")}. Please upload a photo.`):r.length>0?o("danger",`Incomplete data in row(s): ${r.join(", ")}. Please fill machine, mode, and start reading.`):o("danger","Please add at least one complete machine reading.");return}try{await na(e),o("success",`${e.length} start reading(s) saved successfully.`);const t=await Re(d.project_id);t.length>0?(N(t),k(!0)):(J(),o("success","Form cleared. Ready to add a new work log."))}catch{o("danger","Error saving start readings. Please try again.")}},ca=i.useCallback(async e=>{if(!e||!e.id)throw new Error("Invalid reading to update");const s={machine_end:parseFloat(e.machine_end).toFixed(2),machine_end_pic:e.machine_end_pic};return await le(`/api/end/${e.id}`,s)},[]),oa=async()=>{const e=[],s=[],r=[];if(R.forEach((t,l)=>{var h;const n=parseFloat(t.machine_end),u=parseFloat(t.start_reading)||0,m=((h=I.find(x=>x.id===parseInt(t.machine_id)))==null?void 0:h.machine_name)||`Machine #${t.machine_id}`;if(isNaN(n)){r.push(m);return}if(n<=u){s.push(m);return}_===2&&!t.machine_end_pic&&e.push(m)}),e.length>0){o("danger",`End photo is required for: ${e.slice(0,3).join(", ")}${e.length>3?` and ${e.length-3} more`:""}.`);return}if(s.length>0){o("danger",`End reading must be greater than start reading for: ${s.slice(0,3).join(", ")}${s.length>3?` and ${s.length-3} more`:""}.`);return}if(r.length>0){o("danger",`Invalid end reading (not a number) for: ${r.slice(0,3).join(", ")}${r.length>3?` and ${r.length-3} more`:""}.`);return}je(!0);try{const t=R.map(n=>ca(n));await Promise.all(t),o("success","All end readings have been submitted successfully!"),ae(!0),setTimeout(()=>ae(!1),2500);const l=He();v(l),N([]),k(!1),b(""),te([]),w(!1),J(),o("success","Form reset. Ready for new entry.")}catch(t){o("danger","An error occurred while saving end readings."),console.error(t)}finally{je(!1)}},Ee=i.useCallback(e=>e?I.filter(s=>Array.isArray(s.operator_id)&&s.operator_id.includes(String(e))).map(s=>({value:s.id,label:s.machine_name})):[],[I]);return i.useEffect(()=>{if(!T){L();return}if(!P){const e=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);Ce(e?"environment":"user")}},[T,P,L]),i.useEffect(()=>{!T||P||(L(),we())},[X,T,P]),i.useEffect(()=>{_===2&&(c!=null&&c.id)&&Ge(c.id.toString())},[_,c==null?void 0:c.id]),a.jsx("div",{className:"",children:a.jsxs("div",{fluid:!0,children:[De&&a.jsx(Fe,{color:"success",dismissible:!0,onClose:()=>ae(!1),children:"Form submitted successfully!"}),a.jsxs(H,{className:"",children:[a.jsx(pa,{className:"bg-primary text-white",children:a.jsxs("h1",{className:"mb-2 h4 d-flex align-items-center",children:[a.jsx(A,{icon:ga,className:"me-2"})," Daily Work"]})}),a.jsx(D,{className:"p-2",children:a.jsxs(ze,{children:[a.jsx(H,{className:"mb-4 border-0",color:"info",textColor:"dark",children:a.jsx(D,{className:"bg-info-subtle rounded rounded-lg",children:a.jsxs(U,{className:"g-3",children:[a.jsxs(f,{md:6,children:[a.jsx(j,{children:"Customer Name"}),a.jsxs(fa,{children:[a.jsx(C,{type:"text",value:B,onChange:e=>{b(e.target.value),w(!0)},placeholder:"Search for a customer...",disabled:E}),d.project_name&&a.jsx(p,{type:"button",color:"danger",variant:"outline",onClick:()=>{v(He()),N([]),k(!1),b(""),w(!1)},children:"âœ•"}),a.jsx(p,{type:"button",color:"danger",variant:"outline",onClick:Ke,children:"Show All"})]}),Ve&&a.jsx("div",{className:"border rounded bg-white",style:{maxHeight:"150px",overflowY:"auto"},children:me.length>0?me.map(e=>a.jsxs("div",{className:"p-2 hover-bg-light",style:{cursor:"pointer"},onClick:()=>{Pe(e),b(e.customer_name),w(!1)},children:[a.jsx("div",{children:e.customer_name}),a.jsx("div",{className:"text-muted small",style:{fontSize:"0.85em"},children:e.mobile_number||"No Mobile"})]},e.id)):a.jsxs("div",{className:"p-2",children:[a.jsx("div",{children:"No Customer found."}),a.jsx(p,{color:"primary",size:"sm",className:"mt-2",onClick:()=>Q(!0),children:"Add New Customer"})]})})]}),a.jsxs(f,{md:6,children:[a.jsx(j,{children:"Date "}),a.jsx(C,{type:"date",value:d.date||ee(),onChange:e=>ra("date",e.target.value),disabled:E||_===2})]})]})})}),E?a.jsx(H,{className:"mb-4 border-0",color:"warning",textColor:"dark",children:a.jsxs(D,{className:"bg-warning-subtle rounded rounded-lg",children:[a.jsx("h5",{className:"text-warning-emphasis mb-3 d-flex align-items-center",children:"Add Machine End Readings"}),R.map((e,s)=>{var m;const r=((m=q.find(h=>h.value===e.operator_id))==null?void 0:m.label)||"N/A",t=xe.find(h=>h.id===parseInt(e.mode_id)),l=t?t.mode.charAt(0).toUpperCase()+t.mode.slice(1).replace(/-/g," "):"N/A",n=I.find(h=>h.id===parseInt(e.machine_id)),u=(n==null?void 0:n.machine_name)||"N/A";return a.jsx(H,{className:"mb-3",children:a.jsx(D,{children:a.jsxs(U,{className:"align-items-center gx-3",children:[a.jsx(f,{md:4,children:a.jsxs("div",{className:"p-2 border border-secondary rounded bg-light",children:[a.jsxs("p",{className:"mb-1",children:[a.jsx("strong",{children:"Operator:"})," ",r]}),a.jsxs("p",{className:"mb-0",children:[a.jsx("strong",{children:"Machine:"})," ",u]}),a.jsxs("p",{className:"mb-0",children:[a.jsx("strong",{children:"Mode:"})," ",l]})]})}),a.jsxs(f,{md:2,className:"text-center",children:[a.jsx(j,{children:"Total Reading"}),a.jsx("p",{className:"fw-bold fs-5 mb-0",children:Math.max(e.machine_end-e.start_reading,0).toFixed(2)})]}),a.jsx(f,{sm:4,children:a.jsxs(U,{className:"gx-2 align-items-end",children:[a.jsxs(f,{xs:6,children:[a.jsx(j,{children:"Start Reading"}),a.jsx(C,{type:"text",value:e.start_reading,readOnly:!0,disabled:!0})]}),a.jsxs(f,{xs:6,children:[a.jsxs(j,{children:["End Reading ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(C,{type:"text",inputMode:"numeric",pattern:"[0-9]*\\.?[0-9]*",value:e.machine_end||"",placeholder:"0",invalid:e.machine_end!==void 0&&e.machine_end!==""&&parseFloat(e.machine_end)<=parseFloat(e.start_reading),onChange:h=>{let x=h.target.value.replace(/[^0-9.]/g,"");const S=x.split(".");S.length>2&&(x=S[0]+"."+S.slice(1).join("")),Me(s,"machine_end",x)}}),e.machine_end!==void 0&&e.machine_end!==""&&parseFloat(e.machine_end)<=parseFloat(e.start_reading)&&a.jsxs("small",{className:"text-danger d-block",children:["End reading must be greater than ",e.start_reading]})]})]})}),a.jsxs(f,{md:2,children:[a.jsxs(j,{children:["End Photo  ",_===2&&a.jsx("span",{style:{color:"red"},children:"*"})]}),e.machine_end_pic?a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx("span",{className:"text-success small",children:"âœ“ Captured"}),a.jsx(p,{color:"danger",variant:"ghost",size:"sm",onClick:()=>Me(s,"machine_end_pic",null),children:a.jsx(A,{icon:Le})})]}):a.jsx(p,{color:"primary",size:"sm",onClick:()=>Ne(s,"end"),disabled:!e.machine_end,className:"w-100",children:"ðŸ“· End Reading Photo"})]})]})})},e.id)})]})}):a.jsx(H,{className:"mb-4 border-0",color:"success",textColor:"dark",children:a.jsxs(D,{className:"bg-success-subtle rounded rounded-lg",children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-center md:mb-3",children:[a.jsx("h5",{className:"text-success mb-3 d-flex align-items-center",children:"Add Machine Start Readings"}),_===1&&a.jsxs("div",{className:"d-flex gap-2",children:[d.machineReading.length>1&&a.jsx(p,{color:"danger",variant:"outline",type:"button",size:"md",className:"d-flex align-items-center",onClick:()=>{if(d.machineReading.length<=1)return;const e=[...d.machineReading];e.pop(),v(s=>({...s,machineReading:e}))},children:"Remove Last"}),a.jsx(p,{color:"success",variant:"outline",type:"button",size:"md",className:"d-flex align-items-center",onClick:()=>v(e=>{var s;return{...e,machineReading:[...e.machineReading,{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:_===2&&((s=c==null?void 0:c.id)==null?void 0:s.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,machine_start_pic:null,machine_end_pic:null}]}}),children:"Add"})]})]}),a.jsx(U,{className:"g-1",children:d.machineReading.map((e,s)=>{var l;const r=I.find(n=>n.id===parseInt(e.machine_id)),t=(l=r==null?void 0:r.mode_id)!=null&&l.length?xe.filter(n=>r.mode_id.map(String).includes(String(n.id))).map(n=>({price_per_hour:n.price,id:n.id,value:n.id,label:n.mode.charAt(0).toUpperCase()+n.mode.slice(1).replace(/-/g," ")})):[];return a.jsxs(U,{className:"mb-2 gx-1",children:[_===1&&a.jsxs(f,{xs:12,md:3,className:"p-1",children:[a.jsxs(j,{children:["Select Operator ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(de,{options:q,isSearchable:!0,placeholder:"Operators",value:q.find(n=>n.value===e.operator_id)||null,onChange:n=>{y(s,"operator_id",n?n.value:""),y(s,"machine_id",""),y(s,"mode_id",""),y(s,"mode","")}})]}),a.jsxs(f,{xs:12,md:3,className:"p-1",children:[a.jsxs(j,{children:["Select Machine ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(de,{options:Ee(e.operator_id||ue),isSearchable:!0,placeholder:"Machinery",value:Ee(e.operator_id||ue).find(n=>n.value===e.machine_id)||null,onChange:n=>{y(s,"machine_id",n?n.value:""),y(s,"mode_id",""),y(s,"mode","")}})]}),a.jsxs(f,{xs:12,md:2,className:"p-1",children:[a.jsxs(j,{children:["Select Mode ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(de,{options:t,isSearchable:!1,placeholder:"Select Mode",isDisabled:!e.machine_id||t.length===0,value:t.find(n=>n.value===e.mode_id)||null,onChange:n=>{y(s,"mode_id",n?n.value:""),y(s,"price_per_hour",n?n.price_per_hour:0)}})]}),a.jsxs(f,{xs:12,md:2,className:"p-1",children:[a.jsx(j,{children:"Start Reading"}),a.jsx(C,{type:"text",inputMode:"numeric",pattern:"[0-9.:]*",value:e.machine_start===0?"":e.machine_start,placeholder:"0",onChange:n=>{let u=n.target.value.replace(/[^0-9.:]/g,"");y(s,"machine_start",u===""?0:u)}})]}),a.jsxs(f,{xs:12,md:2,className:"p-1",children:[a.jsx(j,{children:"Start Reading Photo "}),e.machine_start_pic?a.jsxs("div",{className:"d-flex align-items-center gap-2 w-100",children:[a.jsx("span",{className:"text-muted small",children:"Photo captured"}),a.jsx(p,{color:"danger",variant:"ghost",size:"sm",onClick:()=>sa(s,"machine_start_pic"),children:a.jsx(A,{icon:Le})})]}):a.jsx(p,{color:"primary",size:"sm",onClick:()=>Ne(s,"start"),disabled:!e.machine_start,className:"w-100",children:"ðŸ“· Start Reading Photo"})]})]},e.uid||s)})})]})}),a.jsx("div",{className:"d-flex justify-content-center",children:E?a.jsxs(p,{color:"warning",size:"lg",className:"px-5 d-flex align-items-center",onClick:oa,disabled:_e,children:[a.jsx(A,{icon:Ue,className:"me-2"})," ",_e?"Saving...":"Save End Readings"]}):a.jsxs(p,{color:"danger",size:"lg",className:"px-5 d-flex align-items-center",onClick:ia,disabled:ge,children:[a.jsx(A,{icon:Ue,className:"me-2"})," ",ge?"Saving...":"Save Start Readings"]})})]})})]}),a.jsxs(Ae,{visible:T,onClose:()=>V(!1),size:"lg",alignment:"center",children:[a.jsxs(Ie,{className:"d-flex align-items-center justify-content-between",children:[a.jsx("div",{className:"d-flex align-items-center",children:a.jsx(Te,{className:"me-3",children:$==="start"?"ðŸ“¸ Capture Start Photo":"ðŸ“· Capture End Photo"})}),a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[F.current&&a.jsx("span",{className:"text-muted small",children:((ke=F.current.getVideoTracks()[0])==null?void 0:ke.getSettings().facingMode)==="environment"?"Rear Camera Active":"Front Camera Active"}),a.jsx(p,{color:"primary",variant:"outline",size:"sm",className:"rounded-pill px-3 fw-semibold shadow-sm",onClick:()=>{Ce(e=>e==="environment"?"user":"environment")},children:X==="environment"?"Switch to Front":"Switch to Rear"})]})]}),a.jsx($e,{children:a.jsx("div",{className:"text-center",children:pe?a.jsxs("div",{children:[a.jsx("div",{className:"mb-3",children:a.jsx("img",{src:pe,alt:"Captured",className:"img-fluid rounded",style:{maxHeight:"400px",objectFit:"cover"}})}),a.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[a.jsx(p,{color:"secondary",onClick:()=>{G(null),Z(null),we()},children:"Retake"}),a.jsx(p,{color:"success",onClick:aa,children:"Submit Photo"})]})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"position-relative mb-3",children:[a.jsx("video",{ref:z,autoPlay:!0,playsInline:!0,muted:!0,className:"w-100 rounded",style:{maxHeight:"400px",objectFit:"cover"}}),a.jsx("canvas",{ref:oe,style:{display:"none"}})]}),a.jsxs(p,{color:"primary",size:"lg",onClick:ea,className:"mb-3",children:[a.jsx(A,{icon:_a,className:"me-2"})," Capture Photo"]})]})})}),a.jsx(Oe,{children:a.jsx(p,{color:"secondary",onClick:()=>V(!1),children:"Cancel"})})]}),a.jsxs(Ae,{visible:ce,onClose:()=>Q(!1),size:"xl",alignment:"center",children:[a.jsx(Ie,{children:a.jsx(Te,{children:"Add New Customer"})}),a.jsx($e,{children:a.jsx(ze,{id:"new-project-form",onSubmit:async e=>{var r,t,l;if(e.preventDefault(),O({}),W(!0),g.end_date&&g.start_date&&new Date(g.end_date)<new Date(g.start_date)){O({end_date:"End date must be after or equal to start date."}),W(!1);return}if(g.operator_id.some((n,u)=>{if(!n||n==="")return!1;const m=g[`machine_${u}`];return!m||m===""})){O({general:"Please assign a machine to all selected operators."}),W(!1);return}try{const n=g.operator_id.map((h,x)=>h&&h!==""?g[`machine_${x}`]:null).filter(h=>h!==null),u={...g,machine_id:n},m=await le("/api/projects",u);o("success","Customer added successfully!"),Q(!1),K(B),Pe(m),b(m.customer_name),w(!1)}catch(n){console.error("Error creating project:",n),(r=n.response)!=null&&r.data.errors?O(n.response.data.errors):O({general:((l=(t=n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to create project."})}finally{W(!1)}},children:a.jsxs("div",{className:"row g-3",children:[ve.general&&a.jsx(Fe,{color:"danger",children:ve.general}),a.jsxs(f,{md:4,children:[a.jsx(j,{children:"Customer Name"}),a.jsx(C,{type:"text",name:"customer_name",value:g.customer_name,onChange:e=>Y({...g,[e.target.name]:e.target.value}),required:!0,placeholder:"Enter Customer Name..."})]}),a.jsxs(f,{md:4,children:[a.jsx(j,{children:"Customer Mobile Number"}),a.jsx(C,{type:"text",name:"mobile_number",value:g.mobile_number,onChange:e=>{const s=e.target.value.replace(/\D/g,"");s.length<=10&&Y({...g,mobile_number:s})},required:!0,placeholder:"Enter Customer Mobile..."})]}),a.jsxs(f,{md:4,children:[a.jsx(j,{children:"GST number"}),a.jsx(C,{type:"text",name:"gst_number",value:g.gst_number,onChange:e=>Y({...g,[e.target.name]:e.target.value}),placeholder:"Enter GST number...",maxLength:15})]}),a.jsxs(f,{md:4,children:[a.jsx(j,{children:"Location"}),a.jsx(C,{type:"text",name:"work_place",value:g.work_place,onChange:e=>Y({...g,[e.target.name]:e.target.value}),placeholder:"Enter Your Location..."})]})]})})}),a.jsxs(Oe,{children:[a.jsx(p,{color:"secondary",onClick:()=>Q(!1),children:"Cancel"}),a.jsx(p,{type:"submit",form:"new-project-form",color:"primary",disabled:ye,children:ye?"Submitting...":"Add Customer"})]})]})]})})};export{Da as default};
