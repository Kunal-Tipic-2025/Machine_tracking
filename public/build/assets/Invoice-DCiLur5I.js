import{r as o,u as st,b as at,j as e,C as Fe}from"./index-WEbTLRLZ.js";/* empty css                */import{a as ce,b as A,c as Le,d as I}from"./index.esm-CZeMoYDH.js";import{a as L,b as V,p as Y}from"./api-Ba1wfMeh.js";import{u as nt,a as ot,b as ct,c as it,d as dt}from"./DefaultLayout-CnBEfSKd.js";import{C as lt,a as mt}from"./CCardBody-CtNgr8m7.js";import{C as ut}from"./CCardHeader-LFhc_ZAM.js";import{C as Te}from"./CForm-J01-VhG4.js";import{C as p}from"./CFormLabel-D964ZFYD.js";import{C as ht}from"./CInputGroup-Ds1aMRVv.js";import{C as _}from"./CFormInput-D3dwui72.js";import{C as pt}from"./CInputGroupText-Bqk6jF70.js";import{c as xt}from"./cil-search-CDkY_4k-.js";import{c as gt}from"./cil-x-0440B5Ce.js";import{C as Me}from"./CFormSelect-CH5m41hJ.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-Cd7YjP3x.js";import"./CNavItem-u5MAKPdZ.js";import"./CFormControlWrapper-DljGJ9Vz.js";const Ut=({editMode:T=!1,initialData:u=null,onSubmit:ie=null})=>{const[Be,Re]=o.useState(!1),[$,f]=o.useState(!1),[de,le]=o.useState(!0),[Ue,$e]=o.useState([]),We=st();nt();const{showToast:l}=at(),[M,C]=o.useState([]),[b,Oe]=o.useState([]),[_t,X]=o.useState([]),[h,W]=o.useState(""),[B,E]=o.useState(!1),[J,K]=o.useState([]),[Z,ee]=o.useState([]),[De,qe]=o.useState([]),[N,O]=o.useState([]),[x,te]=o.useState([]),re=o.useRef(null),D=o.useRef(null),[y,me]=o.useState(!1),[P,ue]=o.useState(""),[he,pe]=o.useState(""),[xe,ge]=o.useState(""),[_e,je]=o.useState(""),[v,fe]=o.useState(!1),[k,be]=o.useState(""),[F,Ne]=o.useState(""),[ye,ve]=o.useState(""),[we,Ce]=o.useState(""),[ke,Se]=o.useState(""),[i,q]=o.useState({projectId:null,customer_id:null,customer_name:"",address:"",mobile_number:"",customer:{name:"",address:"",mobile:""},invoiceType:3,invoiceDate:new Date().toISOString().split("T")[0],discount:0,paidAmount:0,finalAmount:0,projectCost:0,payed:0,start_date:"",end_date:"",selectedMachines:[],company_id:null}),[jt,ze]=o.useState([{work_type:"",qty:0,price:0,total_price:0,remark:""}]),[R,se]=o.useState(null),[ae,z]=o.useState(""),[Ge,G]=o.useState(!1),[g,U]=o.useState({customer_name:"",mobile_number:"",gst_number:"",work_place:""}),H=o.useCallback(async(t="")=>{le(!0);try{const s=t?`/api/projects?searchQuery=${encodeURIComponent(t)}`:"/api/projects",r=await L(s),a=Array.isArray(r)?r:r==null?void 0:r.data;if(!a||!Array.isArray(a)){C([]),t||l("warning","No projects data available from server");return}const d=a.map(c=>({id:c.id,project_name:c.project_name||"Unknown Project",customer_name:c.customer_name||"Unknown Customer",work_place:c.work_place||"",project_cost:c.project_cost||"0",mobile_number:c.mobile_number||"",gst_number:c.gst_number||"",remark:c.remark||"",paidamount:c.paidamount||0,customer_id:c.customer_id||c.id,company_id:c.company_id,machine_id:c.machine_id||[],customer:{name:c.customer_name||"Unknown",address:c.work_place||"N/A",mobile:c.mobile_number||"N/A"},start_date:c.start_date,end_date:c.end_date})).filter(c=>c.project_name&&c.customer_id);C(d)}catch(s){console.error("Error fetching projects:",s),C([]),t||l("danger","Failed to fetch projects")}finally{le(!1)}},[]);o.useEffect(()=>{var t,s,r,a;T&&u&&(q({projectId:u.projectId,customer_id:u.customer_id,customer_name:((t=u.customer)==null?void 0:t.name)||"",address:((s=u.customer)==null?void 0:s.address)||"",mobile_number:((r=u.customer)==null?void 0:r.mobile)||"",customer:u.customer,invoiceType:u.invoiceType,invoiceDate:u.invoiceDate,discount:u.discount||0,payed:u.paidamount||0,finalAmount:u.finalAmount||0,start_date:u.start_date||"",end_date:u.end_date||""}),ze(u.items||[{work_type:"",qty:0,price:0,total_price:0,remark:""}]),W(((a=u.customer)==null?void 0:a.name)||""))},[T,u]),o.useEffect(()=>{H()},[H]),o.useEffect(()=>{const t=setTimeout(()=>{h&&h.length>0?H(h):h.length===0&&(C([]),E(!1))},100);return()=>clearTimeout(t)},[h,H]),o.useEffect(()=>{if(h&&M.length>0){const t=h.toLowerCase(),s=M.filter(r=>r.project_name&&r.project_name.toLowerCase().includes(t)||r.customer_name&&r.customer_name.toLowerCase().includes(t)||r.work_place&&r.work_place.toLowerCase().includes(t)||r.mobile_number&&r.mobile_number.includes(t)||r.remark&&r.remark.toLowerCase().includes(t));console.log("Filtered projects:",s,"Query:",h),K(s)}else K([])},[h,M]);const He=async()=>{try{const t=await L("/api/machineLog");ee(t||[])}catch(t){l("danger","Error fetching machine logs: "+t)}},Qe=()=>{L("/api/operatorsByCompanyIdOperator").then(t=>{$e(t||[]),f(!1)}).catch(t=>{console.log(t.message),f(!1)})};o.useEffect(()=>{He(),Qe()},[]),o.useEffect(()=>{const t=s=>{re.current&&!re.current.contains(s.target)&&D.current&&!D.current.contains(s.target)&&E(!1)};return B&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[B]);const Ve=async()=>{try{const t=await L("/api/machine-operators");Oe(t)}catch(t){console.error("Error fetching machineries:",t),l("danger","Error fetching machineries")}},Ye=async()=>{try{const t=await L("/api/machine-price");qe(t)}catch(t){console.error("Error fetching machineries:",t),l("danger","Error fetching machineries")}};o.useEffect(()=>{Ve(),Ye()},[]);const ne=o.useCallback(t=>{if(!t||!t.machine_id||!Array.isArray(t.machine_id)||b.length===0){X([]);return}const s=b.filter(r=>t.machine_id.includes(String(r.id)));X(s)},[b]);o.useEffect(()=>{if(b.length>0&&i.projectId){const t=M.find(s=>s.id===i.projectId);t&&ne(t)}},[b,i.projectId,M,ne]),o.useEffect(()=>{if(!i.projectId)return;const t=setTimeout(async()=>{try{const s=Number(i.payed)||0;await V(`/api/projects/${i.projectId}/paidamount`,{paidamount:s})}catch(s){console.error("Failed updating project paidamount:",s)}},500);return()=>clearTimeout(t)},[i.projectId,i.payed]),o.useEffect(()=>{if(!i.projectId||Z.length===0){O([]);return}const s=Z.filter(r=>String(r.project_id)===String(i.projectId)).filter(r=>r.isPaid==0);O(s)},[Z,i.projectId]);const Ae=o.useCallback(t=>{if(!t||b.length===0)return"N/A";const s=b.find(r=>String(r.id)===String(t));return(s==null?void 0:s.machine_name)||"N/A"},[b]),Ie=t=>{const s=parseFloat(t.project_cost)||0,r=parseFloat(i.discount)||0,a=Math.max(0,s-r);q(d=>({...d,projectId:t.id,payed:t.paidamount,customer_id:t.customer_id,customer_name:t.customer_name,address:t.work_place,mobile_number:t.mobile_number,start_date:t.start_date,end_date:t.end_date,projectCost:s,finalAmount:a,company_id:t.company_id,customer:{name:t.customer_name,address:t.customer.address,mobile:t.customer.mobile},selectedMachines:[]})),E(!1),W(t.customer_name),C([]),ne(t)},Xe=()=>{q(t=>({...t,projectId:null,customer_id:null,customer_name:"",address:"",mobile_number:"",customer:{name:"",address:"",mobile:""},projectCost:0,payed:0,finalAmount:0,selectedMachines:[]})),W(""),E(!1),C([]),X([])},Ee=()=>{E(!1),U(t=>({...t,customer_name:h||""})),G(!0)},Q=t=>{const{name:s,value:r}=t.target;if(s==="mobile_number"){const a=r.replace(/\D/g,"");if(a.length>10)return;U(d=>({...d,mobile_number:a}));return}if(s==="gst_number"){if(r.length>15)return;U(a=>({...a,gst_number:r}));return}U(a=>({...a,[s]:r}))},Pe=async t=>{if(t.preventDefault(),!g.customer_name.trim()){l("danger","Customer name is required");return}if(!g.mobile_number||!/^[6-9]\d{9}$/.test(g.mobile_number)){l("danger","Please enter a valid 10-digit mobile number");return}try{f(!0);const s={customer_name:g.customer_name,mobile_number:g.mobile_number,gst_number:g.gst_number||"",work_place:g.work_place||"",project_name:"",project_cost:"",supervisor_id:"",commission:"",start_date:"",end_date:"",is_visible:!0,remark:"",operator_id:[""],machine_id:[]};await Y("/api/projects",s);let r=null;try{const a=await L(`/api/projects?searchQuery=${encodeURIComponent(g.customer_name)}`),d=Array.isArray(a)?a:a==null?void 0:a.data;if(d&&Array.isArray(d)){const c=d.map(n=>({id:n.id,project_name:n.project_name||"Unknown Project",customer_name:n.customer_name||"Unknown Customer",work_place:n.work_place||"",project_cost:n.project_cost||"0",mobile_number:n.mobile_number||"",gst_number:n.gst_number||"",remark:n.remark||"",paidamount:n.paidamount||0,customer_id:n.customer_id||n.id,company_id:n.company_id,machine_id:n.machine_id||[],customer:{name:n.customer_name||"Unknown",address:n.work_place||"N/A",mobile:n.mobile_number||"N/A"},start_date:n.start_date,end_date:n.end_date})).filter(n=>n.project_name&&n.customer_id);r=c.find(n=>n.customer_name.toLowerCase()===g.customer_name.toLowerCase()&&n.mobile_number===g.mobile_number)||c[0]||null}}catch(a){console.error("Error fetching newly created customer project:",a)}r?(Ie(r),l("success","Customer added and selected successfully")):l("success","Customer added successfully, please search to select"),G(!1),U({customer_name:"",mobile_number:"",gst_number:"",work_place:""}),C([]),K([])}catch(s){console.error("Error adding customer from invoice:",s),l("danger","Failed to add customer")}finally{f(!1)}},Je=t=>{const{name:s,value:r}=t.target,a=s==="discount"||s==="paidAmount"?parseFloat(r)||0:r;q(d=>{const c={...d,[s]:a};if(s==="discount"){const n=parseFloat(d.projectCost)||0,m=parseFloat(a)||0;c.finalAmount=Math.max(0,n-m)}return c})},Ke=t=>{se(t.id),z(String(t.price_per_hour??0))},Ze=()=>{se(null),z("")},et=async t=>{const s=Number(ae);if(isNaN(s)||s<0){l("danger","Enter a valid price");return}try{const r=await V(`/api/machine-logs/${t.id}/price`,{price_per_hour:s});if(r&&r.error){l("danger","Failed to update price");return}O(a=>a.map(d=>String(d.id)===String(R)?{...d,price_per_hour:s}:d)),typeof ee=="function"&&ee(a=>Array.isArray(a)?a.map(d=>String(d.id)===String(R)?{...d,price_per_hour:s}:d):a),se(null),z(""),l("success","Price updated successfully")}catch(r){console.error("Error updating log price:",r),l("danger","Error updating price")}},tt=t=>{te(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},rt=async t=>{if(t.preventDefault(),!t.currentTarget.checkValidity()){Re(!0);return}if(!i.projectId||!i.customer_id){l("danger","Please select a customer");return}try{if(f(!0),i.projectId){const n=Number(i.payed)||0;try{await V(`/api/projects/${i.projectId}/paidamount`,{paidamount:n})}catch(m){console.error("Failed to update project paidamount on submit:",m)}}const r=N.filter(n=>x.includes(n.id));console.log("Selected Rows:",r);const a=r.length>0?r[0].company_id:i.company_id;if(r.length===0&&!(y&&Number(P)>0)&&!(v&&Number(k)>0)){l("warning","Select logs, enable Advance Payment, or enable Fixed Bid Work"),f(!1);return}const d=r.reduce((n,m)=>{const j=Number(m.machine_start??m.start_reading??0)||0,w=Number(m.machine_end??m.end_reading??0)||0,oe=m.actual_machine_hr!=null&&!isNaN(Number(m.actual_machine_hr))?Number(m.actual_machine_hr):Math.max(0,w-j),S=Number(m.price_per_hour)||0;return n+oe*S},0);let c=null;if(r.length>0){console.log("ðŸ”„ Updating isPaid=1 for logs:",x);const n=x.map(j=>V(`/api/machine-logs/${j}/isPaid`,{isPaid:1}));await Promise.all(n),console.log("âœ… ALL selected logs updated to isPaid = 1"),O(j=>j.map(w=>x.includes(w.id)?{...w,isPaid:1}:w)),te([]);const m={project_id:i.projectId,company_id:a,total:d,paid_amount:0,worklog_ids:x};if(T&&ie)await ie(m),l("success",`${r.length} logs marked as paid`);else{const j=await Y("/api/project-payments",m);j&&(l("success",`Invoice created! ${r.length} logs marked as PAID âœ…`),c=j.id)}}if(y&&Number(P)>0){const n=await Y("/api/project-payments",{company_id:a,project_id:i.projectId,total:Number(P),paid_amount:Number(P),is_advance:!0,transaction_id:xe||null,mode:he||null,remark:_e||null});n&&n.id&&(l("success","Advance payment invoice created"),c||(c=n.id))}if(v&&Number(k)>0){if(Number(F)>Number(k)){l("danger","Advance amount cannot be greater than Total amount"),f(!1);return}const n=await Y("/api/project-payments",{company_id:a,project_id:i.projectId,total:Number(k),paid_amount:Number(F)||0,is_fixed_bid:!0,transaction_id:Number(F)>0?we:null,mode:Number(F)>0?ye:"Fixed Bid",remark:ke||null,date:i.invoiceDate});n&&n.id&&(l("success","Fixed Bid Work invoice created"),c||(c=n.id))}c&&setTimeout(()=>{We(`/payment-page/${c}`)},1e3)}catch(r){console.error("Submit error:",r),l("danger","Failed to create invoice")}finally{f(!1)}};return e.jsx(ce,{children:e.jsx(A,{xs:12,children:e.jsxs(lt,{className:"mb-4",children:[e.jsx(ut,{children:e.jsx("strong",{children:T?"Edit Invoice":"Create Invoice"})}),e.jsxs(mt,{children:[e.jsxs(Te,{validated:Be,onSubmit:rt,children:[e.jsxs(ce,{className:"mb-3",children:[e.jsxs(A,{md:6,children:[e.jsxs(p,{children:["Customer Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("div",{ref:re,style:{position:"relative"},children:[e.jsxs(ht,{children:[e.jsx(_,{type:"text",value:h,onChange:t=>{W(t.target.value),E(!0)},placeholder:"Search by customer name, location, mobile...",required:!0}),e.jsx(pt,{children:e.jsx(Le,{icon:xt})}),h&&e.jsx(I,{color:"link",onClick:Xe,className:"position-absolute end-0 me-5",children:e.jsx(Le,{icon:gt})})]}),de&&B&&h.length>0&&e.jsxs("div",{className:"dropdown-menu show p-2",children:[e.jsx(Fe,{size:"sm"})," Loading customers..."]}),B&&J.length>0&&e.jsxs("div",{ref:D,className:"dropdown-menu show",style:{maxHeight:"300px",overflowY:"auto"},children:[J.map(t=>e.jsxs("div",{className:"dropdown-item cursor-pointer p-2 border-bottom",onClick:()=>Ie(t),onMouseEnter:s=>s.target.style.backgroundColor="#f8f9fa",onMouseLeave:s=>s.target.style.backgroundColor="white",children:[e.jsx("div",{className:"fw-medium text-primary",children:t.customer_name}),t.work_place&&e.jsxs("div",{className:"small text-muted",children:[e.jsx("strong",{children:"Location:"})," ",t.work_place]}),t.mobile_number&&e.jsxs("div",{className:"small text-muted",children:[e.jsx("strong",{children:"Mobile:"})," ",t.mobile_number]})]},t.id)),e.jsx("div",{className:"dropdown-item text-center",children:e.jsxs("button",{type:"button",className:"btn btn-sm btn-primary w-100",onClick:Ee,children:['Add customer "',h,'"']})})]}),h.length>0&&J.length===0&&B&&e.jsx("div",{ref:D,className:"dropdown-menu show",style:{maxHeight:"300px",overflowY:"auto"},children:e.jsx("div",{className:"dropdown-item text-center",children:e.jsxs("button",{type:"button",className:"btn btn-sm btn-primary w-100",onClick:Ee,children:['Add customer "',h,'"']})})})]}),i.customer_name&&e.jsxs("div",{className:"mt-1 p-2 bg-light rounded border",children:[e.jsxs("div",{className:"small text-success",children:[e.jsx("strong",{children:"Selected:"})," ",i.customer_name]}),i.customer.address&&e.jsxs("div",{className:"small text-muted",children:[e.jsx("strong",{children:"Location:"})," ",i.customer.address]})]})]}),e.jsxs(A,{md:6,children:[e.jsxs(p,{children:["Invoice Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(_,{type:"date",name:"invoiceDate",value:i.invoiceDate,onChange:Je,required:!0})]})]}),N.length>0&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("h6",{className:"fw-semibold mb-3",children:["Project Logs (Total : ",N.length,") |",e.jsxs("span",{className:"text-primary ms-2",children:["Selected: ",x.length]})]}),e.jsx("div",{className:"table-container",style:{width:"100%",overflowX:"auto",overflowY:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#fff",WebkitOverflowScrolling:"touch"},children:e.jsxs("table",{className:"table table-bordered align-middle",style:{minWidth:"1200px",width:"100%",tableLayout:"fixed",margin:0},children:[e.jsx("thead",{className:"table-light",style:{position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"50px"},className:"text-center align-middle",children:e.jsx("input",{type:"checkbox",checked:x.length===N.length&&x.length>0,onChange:t=>{const s=t.target.checked;te(s?N.map(r=>r.id):[])}})}),e.jsx("th",{style:{width:"90px",minWidth:"90px"},className:"text-center align-middle",children:"Date"}),e.jsx("th",{style:{width:"110px",minWidth:"100px"},className:"text-center align-middle",children:"Machine"}),e.jsx("th",{style:{width:"100px",minWidth:"90px"},className:"text-center align-middle",children:"Operator"}),e.jsx("th",{style:{width:"80px"},className:"text-center align-middle",children:"Start"}),e.jsx("th",{style:{width:"80px"},className:"text-center align-middle",children:"End"}),e.jsx("th",{style:{width:"80px"},className:"text-center align-middle",children:"Net"}),e.jsx("th",{style:{width:"70px"},className:"text-center align-middle",children:"Mode"}),e.jsx("th",{style:{width:"90px"},className:"text-center align-middle",children:"Price/Hr"}),e.jsx("th",{style:{width:"100px"},className:"text-center align-middle",children:"Total"}),e.jsx("th",{style:{width:"100px"},className:"text-center align-middle",children:"Action"})]})}),e.jsxs("tbody",{children:[N.map((t,s)=>{const r=Number(t.machine_start??t.start_reading??0)||0,a=Number(t.machine_end??t.end_reading??0)||0,d=t.actual_machine_hr!=null&&!isNaN(Number(t.actual_machine_hr))?Number(t.actual_machine_hr):Math.max(0,a-r),c=String(t.work_date).slice(0,10).split("-").reverse().join("-"),n=Ue.find(S=>S.id==t.operator_id)||{name:"N/A"},m=String(t.id)===String(R)?Number(ae||0):Number(t.price_per_hour||0),j=d*m,w=De.find(S=>S.id===Number(t.mode_id)),oe=w?w.mode:"N/A";return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"checkbox",checked:x.includes(t.id),onChange:()=>tt(t.id)})}),e.jsx("td",{className:"text-center small",children:c||"N/A"}),e.jsx("td",{className:"text-truncate small",style:{maxWidth:"110px"},title:Ae(t.machine_id),children:Ae(t.machine_id)}),e.jsx("td",{className:"text-truncate small",style:{maxWidth:"100px"},title:n.name,children:n.name}),e.jsx("td",{className:"text-center",children:r}),e.jsx("td",{className:"text-center",children:a}),e.jsx("td",{className:"text-center",children:d}),e.jsx("td",{className:"text-center small",children:oe}),e.jsx("td",{children:String(t.id)===String(R)?e.jsx("input",{type:"number",value:ae,min:0,step:"0.01",onChange:S=>z(S.target.value),style:{width:"70px",fontSize:"0.875rem"},className:"form-control form-control-sm"}):e.jsxs("div",{className:"text-center small",children:["â‚¹",m]})}),e.jsxs("td",{className:"text-center small",children:["â‚¹",j.toFixed(2)]}),e.jsx("td",{className:"text-center",children:String(t.id)===String(R)?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",color:"success",className:"me-1",onClick:()=>et(t),children:"Save"}),e.jsx(I,{size:"sm",color:"secondary",variant:"outline",onClick:Ze,children:"Cancel"})]}):e.jsx(I,{size:"sm",color:"info",className:"text-white",onClick:()=>Ke(t),children:"Edit"})})]},s)}),x.length>0&&(()=>{const t=N.filter(r=>x.includes(r.id)).reduce((r,a)=>{const d=Number(a.machine_start??a.start_reading??0)||0,c=Number(a.machine_end??a.end_reading??0)||0,n=a.actual_machine_hr!=null&&!isNaN(Number(a.actual_machine_hr))?Number(a.actual_machine_hr):Math.max(0,c-d);return r+n},0),s=N.filter(r=>x.includes(r.id)).reduce((r,a)=>{const d=Number(a.machine_start??a.start_reading??0)||0,c=Number(a.machine_end??a.end_reading??0)||0,n=a.actual_machine_hr!=null&&!isNaN(Number(a.actual_machine_hr))?Number(a.actual_machine_hr):Math.max(0,c-d),m=Number(a.price_per_hour)||0;return r+n*m},0);return e.jsxs("tr",{className:"fw-bold table-success",children:[e.jsx("td",{className:"text-center align-middle",children:x.length}),e.jsx("td",{colSpan:"6",className:"text-end pe-3",children:"Grand Total:"}),e.jsx("td",{className:"text-center",children:t.toFixed(2)}),e.jsx("td",{}),e.jsxs("td",{className:"text-end pe-3",children:["â‚¹",s.toFixed(2)]}),e.jsx("td",{})]})})()]})]})})]}),i.projectId&&e.jsxs("div",{className:`my-2 ${y?"p-3":"px-3 py-2"} bg-light rounded border`,children:[e.jsxs("div",{className:`form-check form-switch d-flex align-items-center gap-2 ${y?"mb-3":"mb-0"}`,children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"advanceSwitch",checked:y,disabled:v,onChange:t=>{const s=t.target.checked;me(s),s&&(fe(!1),be(""),Ne(""),ve(""),Ce(""),Se(""))}}),e.jsx("label",{className:"form-check-label mb-0 fw-semibold",htmlFor:"advanceSwitch",children:"Advance Payment"})]}),y&&e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsxs(p,{children:["Advance Amount ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"number",min:"0",placeholder:"Enter amount",value:P,onChange:t=>ue(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Transaction ID"}),e.jsx(_,{type:"text",placeholder:"Enter transaction ID",value:xe,onChange:t=>ge(t.target.value)})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Mode"}),e.jsxs(Me,{value:he,onChange:t=>pe(t.target.value),children:[e.jsx("option",{value:"",children:"Select mode"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"UPI",children:"UPI and Online"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit",children:"Credit"})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Remark"}),e.jsx(_,{type:"text",placeholder:"Enter remark",value:_e,onChange:t=>je(t.target.value)})]})]})]}),i.projectId&&e.jsxs("div",{className:`my-2 ${v?"p-3":"px-3 py-2"} bg-light rounded border`,children:[e.jsxs("div",{className:`form-check form-switch d-flex align-items-center gap-2 ${v?"mb-3":"mb-0"}`,children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"fixedBidSwitch",checked:v,disabled:y,onChange:t=>{const s=t.target.checked;fe(s),s&&(me(!1),ue(""),pe(""),ge(""),je(""))}}),e.jsx("label",{className:"form-check-label mb-0 fw-semibold",htmlFor:"fixedBidSwitch",children:"Fixed Bid Work"})]}),v&&e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsxs(p,{children:["Total Amount ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(_,{type:"number",min:"0",placeholder:"Enter total amount",value:k,onChange:t=>be(t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Advance Amount"}),e.jsx(_,{type:"number",min:"0",placeholder:"Enter paid amount",value:F,onChange:t=>{const s=parseFloat(t.target.value)||0,r=parseFloat(k)||0;if(s>r){l("danger","Paid amount cannot be greater than Total amount");return}Ne(t.target.value)}})]}),Number(F)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Transaction ID"}),e.jsx(_,{type:"text",placeholder:"Enter transaction ID",value:we,onChange:t=>Ce(t.target.value)})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx(p,{children:"Mode"}),e.jsxs(Me,{value:ye,onChange:t=>ve(t.target.value),children:[e.jsx("option",{value:"",children:"Select mode"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"UPI",children:"UPI and Online"}),e.jsx("option",{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx("option",{value:"Credit",children:"Credit"})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(p,{children:"Description"}),e.jsx(_,{type:"text",placeholder:"Enter description",value:ke,onChange:t=>Se(t.target.value)})]})]})]}),e.jsx(I,{color:"primary",type:"submit",disabled:$||!i.projectId||!i.customer_id||de||x.length===0&&!(y&&Number(P)>0)&&!(v&&Number(k)>0),children:$?e.jsx(Fe,{size:"sm"}):T?"Update Invoice":"Submit Invoice"})]}),e.jsxs(ot,{visible:Ge,onClose:()=>G(!1),children:[e.jsx(ct,{closeButton:!0,children:"Add New Customer"}),e.jsx(it,{children:e.jsx(Te,{onSubmit:Pe,children:e.jsxs(ce,{className:"g-3",children:[e.jsxs(A,{md:12,children:[e.jsx(p,{children:"Customer Name"}),e.jsx(_,{type:"text",name:"customer_name",value:g.customer_name,onChange:Q,placeholder:"Enter Customer Name...",required:!0})]}),e.jsxs(A,{md:12,children:[e.jsx(p,{children:"Mobile Number"}),e.jsx(_,{type:"text",name:"mobile_number",value:g.mobile_number,onChange:Q,placeholder:"Enter Customer Mobile...",maxLength:10,required:!0})]}),e.jsxs(A,{md:12,children:[e.jsx(p,{children:"GST Number (Optional)"}),e.jsx(_,{type:"text",name:"gst_number",value:g.gst_number,onChange:Q,placeholder:"Enter GST number...",maxLength:15})]}),e.jsxs(A,{md:12,children:[e.jsx(p,{children:"Location"}),e.jsx(_,{type:"text",name:"work_place",value:g.work_place,onChange:Q,placeholder:"Enter Location..."})]})]})})}),e.jsxs(dt,{children:[e.jsx(I,{color:"secondary",variant:"outline",onClick:()=>G(!1),children:"Cancel"}),e.jsx(I,{color:"primary",onClick:Pe,disabled:$,children:$?"Saving...":"Save Customer"})]})]})]})]})})})};export{Ut as default};
