import{r as a,j as e}from"./index-Cn-F0xzs.js";import{a as N}from"./api-BUyL__Lx.js";import{a as p,b as r,d as ee}from"./index.esm-7oL-v0Yv.js";import{C as n,a as l}from"./CCardBody-OOd8gb1I.js";import{C as $}from"./CCardHeader-NWf5yg3Z.js";import{C as se}from"./CForm-CfRPYM1l.js";import{C as R}from"./CFormLabel-Dk6nlh4k.js";import{C as w}from"./CFormInput-CwIxlT0b.js";import{C as b}from"./DefaultLayout-pwnRm339.js";import{C as te,a as ae,b as C,c as d,d as re,e as m}from"./CTable-9p6lbBYR.js";import"./CFormControlWrapper-CeeeRFXe.js";import"./CFormControlValidation-P5rV7dKb.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-BsLkniud.js";import"./CNavItem-8JWznpb2.js";function A(i){const x=i.getFullYear(),g=String(i.getMonth()+1).padStart(2,"0"),j=String(i.getDate()).padStart(2,"0");return`${x}-${g}-${j}`}const ge=()=>{const i=a.useMemo(()=>new Date,[]),[x,g]=a.useState({start_date:A(new Date(i.getFullYear(),i.getMonth(),1)),end_date:A(new Date(i.getFullYear(),i.getMonth()+1,0))}),[j,D]=a.useState(!1),[v,T]=a.useState(""),[B,H]=a.useState(0),[Y,q]=a.useState(0),[I,k]=a.useState(0),[z,G]=a.useState(0),[_,J]=a.useState(0),[K,O]=a.useState(0),[o,Q]=a.useState([]),M=s=>{const{name:t,value:c}=s.target;g(h=>({...h,[t]:c}))},L=async()=>{var s,t;D(!0),T("");try{const{start_date:c,end_date:h}=x,[f,S,y,P]=await Promise.all([N(`/api/summerySalesReport?startDate=${c}&endDate=${h}`),N(`/api/profitLossReport?startDate=${c}&endDate=${h}`),N(`/api/machine-expense-report?startDate=${c}&endDate=${h}`),N("/api/customer")]),F=(f==null?void 0:f.totals)??{};H(Number(F.totalAmount||0)),q(Number(F.totalPaidAmount||0)),k(Number(F.totalRemainingAmount||0));const E=(S==null?void 0:S.summary)??{};G(Number(((s=E.expenses)==null?void 0:s.totalExpenses)||0)),J(Number(((t=E.profitLoss)==null?void 0:t.profitLossAmount)||0));const Z=(y==null?void 0:y.data)??[];Q(Z),O(Array.isArray(P)?P.length:0)}catch(c){T((c==null?void 0:c.message)||"Failed to load summary")}finally{D(!1)}};a.useEffect(()=>{L()},[]);const U=async s=>{s.preventDefault(),await L()},V=o.length,W=o.reduce((s,t)=>s+Number(t.profit||0),0),X=o.reduce((s,t)=>s+Number(t.loss||0),0),u=o.reduce((s,t)=>s+Number(t.net||0),0);return e.jsx(p,{children:e.jsx(r,{xs:12,children:e.jsxs(n,{className:"mb-4",children:[e.jsx($,{children:e.jsx("strong",{children:"Company Summary"})}),e.jsxs(l,{children:[e.jsx(se,{onSubmit:U,className:"mb-3",children:e.jsxs(p,{children:[e.jsx(r,{sm:4,children:e.jsxs("div",{className:"mb-2",children:[e.jsx(R,{htmlFor:"start_date",children:"Start Date"}),e.jsx(w,{type:"date",id:"start_date",name:"start_date",value:x.start_date,onChange:M,required:!0})]})}),e.jsx(r,{sm:4,children:e.jsxs("div",{className:"mb-2",children:[e.jsx(R,{htmlFor:"end_date",children:"End Date"}),e.jsx(w,{type:"date",id:"end_date",name:"end_date",value:x.end_date,onChange:M,required:!0})]})}),e.jsx(r,{sm:4,className:"d-flex align-items-end",children:e.jsx(ee,{color:"primary",type:"submit",disabled:j,children:j?"Loading...":"Refresh"})})]})}),v?e.jsx("div",{className:"text-danger mb-3",children:v}):null,e.jsxs(p,{className:"mb-3",children:[e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Total Sales"}),e.jsx("h5",{children:B.toFixed(2)})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Total Paid"}),e.jsx("h5",{children:Y.toFixed(2)})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Total Due"}),e.jsx("h5",{children:I.toFixed(2)})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Total Expenses"}),e.jsx("h5",{children:z.toFixed(2)})]})})})]}),e.jsxs(p,{className:"mb-4",children:[e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Profit / Loss"}),e.jsx("h5",{children:e.jsx(b,{color:_>=0?"success":"danger",children:_.toFixed(2)})})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Customers"}),e.jsx("h5",{children:K})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Machines"}),e.jsx("h5",{children:V})]})})}),e.jsx(r,{md:3,sm:6,className:"mb-2",children:e.jsx(n,{children:e.jsxs(l,{children:[e.jsx("div",{className:"text-muted",children:"Machine Net"}),e.jsx("h5",{children:e.jsx(b,{color:u>=0?"success":"danger",children:u.toFixed(2)})})]})})})]}),e.jsxs(n,{className:"mb-2",children:[e.jsx($,{children:e.jsx("strong",{children:"Machines Summary"})}),e.jsx(l,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs(te,{small:!0,children:[e.jsx(ae,{children:e.jsxs(C,{children:[e.jsx(d,{children:"Sr"}),e.jsx(d,{children:"Name"}),e.jsx(d,{children:"Reg No"}),e.jsx(d,{className:"text-end",children:"Profit"}),e.jsx(d,{className:"text-end",children:"Loss"}),e.jsx(d,{className:"text-end",children:"Net"})]})}),e.jsxs(re,{children:[o.map((s,t)=>e.jsxs(C,{children:[e.jsx(m,{children:s.sr_no??t+1}),e.jsx(m,{children:s.machine_name}),e.jsx(m,{children:s.reg_number}),e.jsx(m,{className:"text-end",children:Number(s.profit||0).toFixed(2)}),e.jsx(m,{className:"text-end",children:Number(s.loss||0).toFixed(2)}),e.jsx(m,{className:"text-end",children:e.jsx(b,{color:Number(s.net||0)>=0?"success":"danger",children:Number(s.net||0).toFixed(2)})})]},s.id??t)),o.length===0?e.jsx(C,{children:e.jsx(m,{colSpan:6,className:"text-center text-muted",children:"No machines found for selected period."})}):null,o.length>0?e.jsxs(C,{children:[e.jsx(d,{colSpan:3,children:"Totals"}),e.jsx(d,{className:"text-end",children:W.toFixed(2)}),e.jsx(d,{className:"text-end",children:X.toFixed(2)}),e.jsx(d,{className:"text-end",children:e.jsx(b,{color:u>=0?"success":"danger",children:u.toFixed(2)})})]}):null]})]})})})]})]})]})})})};export{ge as default};
