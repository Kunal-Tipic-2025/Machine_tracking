import{u as U,b as V,c as W,r,j as e,C as X}from"./index-DD5PpQvG.js";import{g as Y,a as C}from"./api-BUyL__Lx.js";import"./jspdf.es.min-3uQKM7L4.js";import"./jspdf.plugin.autotable-BF6AZAgr.js";import{u as q,C as G}from"./DefaultLayout-CqqVRJ58.js";import{a as v,b,d as J}from"./index.esm-Cf16sf0V.js";import{C as O,a as Q}from"./CCardBody-DIaUAcaG.js";import{C as Z}from"./CCardHeader-xDb1sBm5.js";import{C as D}from"./CFormLabel-nywbXjJ8.js";import{C as T}from"./CFormInput-Cn6Oxe7f.js";import{C as K,a as ee,b as j,c as l,d as se,e as c}from"./CTable-Dxzi_9_r.js";import"./typeof-QjJsDpFa.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-BpBLObvv.js";import"./CNavItem-BzisaWd0.js";import"./CFormControlWrapper-BZBLkUPy.js";import"./CFormControlValidation-CeKcElbP.js";const Ne=()=>{const _=U(),{showToast:N}=V();q("global");const{machineid:x}=W(),d=r.useMemo(()=>Y(),[]),[w,k]=r.useState([]),[I,L]=r.useState({}),[y,M]=r.useState(null),[o,te]=r.useState({key:null,direction:"asc"}),[F,S]=r.useState(!0),[ae,$]=r.useState(window.innerWidth<=768),[p,z]=r.useState(""),[h,B]=r.useState(""),P=async()=>{const a=((await C(`/api/expense1?company_id=${d.company_id}`))[0]||[]).filter(n=>Number(n.machine_id)===Number(x));k(a)},R=async()=>{const t=(await C("/api/expenseType")).reduce((a,n)=>(a[n.id]=n.name,a),{});L(t)},H=async()=>{const t=(await C("/api/machineries1")).find(a=>Number(a.id)===Number(x));M(t)};r.useEffect(()=>{(async()=>{if(!(d!=null&&d.company_id)||!x){N("danger","Missing company ID or machine ID"),S(!1);return}try{await Promise.all([P(),R(),H()])}catch(t){N("danger","Error loading data: "+t.message)}finally{S(!1)}})()},[x,d]),r.useEffect(()=>{const s=()=>{$(window.innerWidth<=768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const m=s=>({marginLeft:"8px",fontSize:"14px",opacity:o.key===s?1:.5,color:o.key===s?"#0d6efd":"#6c757d",transition:"all 0.2s ease"}),g=s=>{const t=parseFloat(s)||0,[a,n="00"]=t.toFixed(2).split("."),i=a.slice(-3),u=a.slice(0,-3);return`INR ${u.length>0?u.replace(/\B(?=(\d{2})+(?!\d))/g,",")+","+i:i}.${n}`},A=s=>{const t={day:"numeric",month:"short",year:"numeric"},n=new Date(s).toLocaleDateString("en-US",t).replace(",",""),[i,u]=n.split(" ");return`${u} ${i}`},f=r.useMemo(()=>{let s=w.map((t,a)=>({...t,sr_no:a+1}));return p&&(s=s.filter(t=>t.expense_date>=p)),h&&(s=s.filter(t=>t.expense_date<=h)),o.key?[...s].sort((t,a)=>{let n=t[o.key],i=a[o.key];return typeof n=="string"&&(n=n.toLowerCase()),typeof i=="string"&&(i=i.toLowerCase()),n<i?o.direction==="asc"?-1:1:n>i?o.direction==="asc"?1:-1:0}):s},[w,p,h,o]),E=r.useMemo(()=>f.reduce((s,t)=>s+(parseFloat(t.total_price)||0),0),[f]);return F?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{color:"primary",size:"lg"}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading machine expenses..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        // Similar styles as in MachineExpenses.jsx, adapted for this component
        .table-container { height: 350px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; }
        // ... (copy relevant styles)
      `}),e.jsx(v,{children:e.jsx(b,{xs:12,children:e.jsxs(O,{className:"mb-4 text-center",children:[e.jsxs(Z,{children:[e.jsx("strong",{className:"fs-5",children:`Expenses for ${(y==null?void 0:y.machine_name)||"Machine"} `}),e.jsx(J,{color:"secondary",onClick:()=>_(-1),className:"float-start mt-2",children:"Back"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Expense: "}),e.jsx(G,{color:"danger",children:`${g(E)}`})]})]}),e.jsxs(Q,{children:[e.jsxs(v,{className:"mb-2 align-items-center gap-5",children:[e.jsx(b,{xs:12,md:3,children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(D,{className:"mb-0 flex-shrink-0",style:{width:"90px"},children:"Start Date :"}),e.jsx(T,{type:"date",value:p,onChange:s=>z(s.target.value),style:{flex:1}})]})}),e.jsx(b,{xs:12,md:3,children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(D,{className:" mb-0 flex-shrink-0",style:{width:"90px"},children:"End Date :"}),e.jsx(T,{type:"date",value:h,onChange:s=>B(s.target.value),style:{flex:1}})]})})]}),e.jsx("div",{className:"table-container",style:{width:"100%",overflowX:"auto",overflowY:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#fff"},children:e.jsxs(K,{hover:!0,striped:!0,bordered:!0,color:"light",className:"mb-0",children:[e.jsx(ee,{style:{position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},children:e.jsxs(j,{children:[e.jsxs(l,{className:"text-center align-middle",children:["Sr No ",e.jsx("span",{style:m("sr_no")})]}),e.jsxs(l,{className:"text-center align-middle",children:["Date ",e.jsx("span",{style:m("expense_date")})]}),e.jsxs(l,{className:"text-center align-middle",children:["Type ",e.jsx("span",{style:m("expense_id")})]}),e.jsxs(l,{className:"text-center align-middle",children:["Description ",e.jsx("span",{style:m("desc")})]}),e.jsxs(l,{className:"text-center align-middle",children:["Amount ",e.jsx("span",{style:m("total_price")})]})]})}),e.jsxs(se,{children:[f.length===0?e.jsx(j,{children:e.jsx(c,{colSpan:6,className:"text-center py-4",children:"No expenses found for this machine."})}):f.map(s=>e.jsxs(j,{children:[e.jsx(c,{children:s.sr_no}),e.jsx(c,{children:A(s.expense_date)}),e.jsx(c,{children:I[s.expense_id]||"-"}),e.jsx(c,{children:s.desc||"-"}),e.jsx(c,{children:g(s.total_price)})]},s.id)),e.jsxs(j,{children:[e.jsx(l,{colSpan:4,className:"text-end",children:"Total"}),e.jsx(l,{children:g(E)})]})]})]})})]})]})})})]})};export{Ne as default};
