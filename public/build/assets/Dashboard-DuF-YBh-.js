import{r as f,_ as Wa,R as ie,g as qa,f as Ia,P as D,n as $a,j as e,b as za}from"./index-DD5PpQvG.js";import{a as X,b as A,d as I}from"./index.esm-Cf16sf0V.js";import{C as Oa}from"./index.esm-BdStmKzv.js";import{e as na,g as Qa,a as Q,p as Z,j as Ua,c as Va}from"./api-BUyL__Lx.js";import{u as ra,a as Ke,b as Xe,c as ea,d as aa,e as ta}from"./DefaultLayout-CqqVRJ58.js";import{C as oa,a as la}from"./CCardBody-DIaUAcaG.js";import{g as Ga}from"./companyPdf-CFIb5U2a.js";import{C as he}from"./RawMaterial-BpBLObvv.js";import{C as Ae}from"./CForm-DHMglVb5.js";import{C as M}from"./CFormLabel-nywbXjJ8.js";import{C as ne}from"./CFormSelect-BN9mb7wv.js";import{C as K}from"./CFormInput-Cn6Oxe7f.js";import{C as Ya}from"./CFormCheck-Zn8UkK2E.js";import"./cil-user-Dlmw-Gem.js";import"./CNavItem-BzisaWd0.js";import"./jspdf.es.min-3uQKM7L4.js";import"./typeof-QjJsDpFa.js";import"./jspdf.plugin.autotable-BF6AZAgr.js";import"./TipicConsultech-B6_BeNSe.js";import"./CFormControlWrapper-BZBLkUPy.js";import"./CFormControlValidation-CeKcElbP.js";var ce=f.forwardRef(function(h,w){var x,T=h.action,P=h.chart,k=h.className,F=h.color,G=h.title,u=h.value,i=Wa(h,["action","chart","className","color","title","value"]);return ie.createElement(oa,qa({className:Ia((x={},x["bg-".concat(F)]=F,x["text-white"]=F,x),k)},i,{ref:w}),ie.createElement(la,{className:"pb-0 d-flex justify-content-between align-items-start"},ie.createElement("div",null,u&&ie.createElement("div",{className:"fs-4 fw-semibold"},u),G&&ie.createElement("div",null,G)),T),P)});ce.propTypes={action:D.node,chart:D.oneOfType([D.string,D.node]),className:D.string,color:$a,title:D.oneOfType([D.string,D.node]),value:D.oneOfType([D.string,D.node,D.number])};ce.displayName="CWidgetStatsA";var N=function(h,w){if(!(typeof window>"u")&&!(typeof document>"u")){var x=document.body;return window.getComputedStyle(x,null).getPropertyValue(h).replace(/^\s/,"")}};const ia=h=>{const w=na(),{t:x}=ra("global"),T=f.useRef(null),P=f.useRef(null),[k,F]=f.useState({currentSales:0,currentExpense:0,currentPandL:0,currentMonth:""});new Date().getMonth();const u=(c,L=0)=>c==null||isNaN(c)?"0 â‚¹":`${Math.round(Number(c))} â‚¹`;function i(){var ae,d;if(h.totalSales!==void 0&&h.totalExpense!==void 0){const $=Number(h.totalSales)||0,Y=Number(h.totalExpense)||0,fe=$-Y;F(b=>({...b,currentSales:$,currentExpense:Y,currentPandL:fe,currentMonth:"All"}));return}let c=((ae=h.reportMonth)==null?void 0:ae.monthlySales)||[],L=((d=h.reportMonth)==null?void 0:d.monthlyExpense)||[];const U=c.reduce(($,Y)=>$+(Number(Y)||0),0),C=L.reduce(($,Y)=>$+(Number(Y)||0),0),xe=U-C;F($=>({...$,currentSales:U,currentExpense:C,currentPandL:xe,currentMonth:"All"}))}f.useEffect(()=>{i()},[h.reportMonth,h.totalSales,h.totalExpense]),f.useEffect(()=>{document.documentElement.addEventListener("ColorSchemeChange",()=>{T.current&&setTimeout(()=>{T.current.data.datasets[0].pointBackgroundColor=N("--cui-primary"),T.current.update()}),P.current&&setTimeout(()=>{P.current.data.datasets[0].pointBackgroundColor=N("--cui-info"),P.current.update()})})},[T,P]);const ee=c=>c===0?u(Math.abs(c)):`${u(Math.abs(c))} (${c>0?x("LABELS.profit"):x("LABELS.loss")})`,z=c=>c===0?"info":c>0?"success":"danger";return e.jsx(e.Fragment,{children:(w===0||w===1)&&e.jsxs(X,{className:h.className,xs:{gutter:4},children:[e.jsx(A,{sm:4,xl:4,xxl:4,children:e.jsx(ce,{className:"pb-3",style:{backgroundColor:"#e5ed05"},value:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fs-4",style:{color:"black"},children:u(k.currentSales)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"black"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]}),title:e.jsxs("span",{style:{color:"black"},children:[x("LABELS.sales")," ",e.jsxs("strong",{children:["(",h.totalWorkingReading," hrs.)"]})]})})}),e.jsx(A,{sm:4,xl:4,xxl:4,children:e.jsx(ce,{className:"pb-3",style:{backgroundColor:"#f73434"},value:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"fs-4",style:{color:"white"},children:u(k.currentExpense)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"white"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]}),title:e.jsx("span",{style:{color:"white"},children:x("LABELS.expenses")})})}),e.jsx(A,{sm:4,xl:4,xxl:4,className:"vh-[40%]",children:e.jsx(ce,{className:"pb-3",color:z(k.currentPandL),value:e.jsx(e.Fragment,{children:e.jsxs("div",{"d-flex":!0,children:[e.jsx("span",{className:"fs-4",style:{color:"white"},children:ee(k.currentPandL)}),e.jsxs("span",{className:"fs-6 fw-normal",style:{color:"white"},children:["Â ",x("LABELS.in")," ",k.currentMonth]})]})}),title:e.jsx("span",{style:{color:"white"},children:x("LABELS.profit_loss")})})})]})})};ia.propTypes={className:D.string,withCharts:D.bool};const Ha=h=>{const w=f.useRef(null),x=c=>Math.round((c+Number.EPSILON)*100)/100;f.useEffect(()=>{document.documentElement.addEventListener("ColorSchemeChange",()=>{w.current&&setTimeout(()=>{w.current.options.scales.x.grid.borderColor=N("--cui-border-color-translucent"),w.current.options.scales.x.grid.color=N("--cui-border-color-translucent"),w.current.options.scales.x.ticks.color=N("--cui-body-color"),w.current.options.scales.y.grid.borderColor=N("--cui-border-color-translucent"),w.current.options.scales.y.grid.color=N("--cui-border-color-translucent"),w.current.options.scales.y.ticks.color=N("--cui-body-color"),w.current.update()})})},[w]);const T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let P=(h.monthlySales||Array(12).fill(0)).map(c=>x(c)),k=(h.monthlyExpense||Array(12).fill(0)).map(c=>x(c)),F=(h.monthlyPandL||Array(12).fill(0)).map(c=>x(c)),G=T;if(!(P.some(c=>c!==0)||k.some(c=>c!==0)||F.some(c=>c!==0))&&(h.totalSales!==void 0||h.totalExpense!==void 0)){const c=x(Number(h.totalSales)||0),L=x(Number(h.totalExpense)||0),U=x(h.totalPandL!==void 0?Number(h.totalPandL):(Number(h.totalSales)||0)-(Number(h.totalExpense)||0));P=[c],k=[L],F=[U],G=["All"]}const i=[...P,...k,...F.map(c=>Math.abs(c))],ee=i.length?Math.max(...i):0,z=ee===0?10:ee+ee*.1;return x(P.reduce((c,L)=>c+(L||0),0)),x(k.reduce((c,L)=>c+(L||0),0)),x(F.reduce((c,L)=>c+(L||0),0)),e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},children:[e.jsx("div",{style:{flex:"1 1 250px",minWidth:"200px"}}),e.jsxs("div",{style:{display:"flex",gap:"clamp(8px, 2vw, 20px)",flexWrap:"wrap",alignItems:"center",justifyContent:window.innerWidth<768?"flex-start":"flex-end",flex:"1 1 300px",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:N("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${N("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#4A90E2",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:N("--cui-body-color"),whiteSpace:"nowrap"},children:"Profit & Loss"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:N("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${N("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#2ECC71",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:N("--cui-body-color"),whiteSpace:"nowrap"},children:"Work Done Amount"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px)",backgroundColor:N("--cui-body-bg"),borderRadius:"6px",border:`1px solid ${N("--cui-border-color")}`,minWidth:"fit-content"},children:[e.jsx("div",{style:{width:"clamp(10px, 1.5vw, 12px)",height:"clamp(10px, 1.5vw, 12px)",backgroundColor:"#E74C3C",borderRadius:"2px",flexShrink:0}}),e.jsx("span",{style:{fontSize:"clamp(11px, 1.8vw, 13px)",fontWeight:"500",color:N("--cui-body-color"),whiteSpace:"nowrap"},children:"Expense"})]})]})]}),e.jsx("div",{style:{width:"100%",overflow:"hidden"},children:e.jsx(Oa,{ref:w,style:{height:"clamp(250px, 40vh, 400px)",marginTop:"clamp(20px, 3vw, 40px)",width:"100%"},data:{labels:G,datasets:[{label:"Profit & Loss",backgroundColor:"#4A90E2",borderColor:"#4A90E2",borderWidth:1,data:F,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40},{label:"Work Done Amount",backgroundColor:"#2ECC71",borderColor:"#2ECC71",borderWidth:1,data:P,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40},{label:"Expense",backgroundColor:"#E74C3C",borderColor:"#E74C3C",borderWidth:1,data:k,maxBarThickness:window.innerWidth<768?15:window.innerWidth<1024?25:40}]},options:{maintainAspectRatio:!1,responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(c){const L=x(c.raw);return`${c.dataset.label}: ${L}`}},titleFont:{size:window.innerWidth<768?12:14},bodyFont:{size:window.innerWidth<768?11:13}},datalabels:{display:!1}},scales:{x:{grid:{color:N("--cui-border-color-translucent"),drawOnChartArea:!1},ticks:{color:N("--cui-body-color"),font:{size:window.innerWidth<768?10:12},maxRotation:window.innerWidth<768?45:0,minRotation:0},categoryPercentage:1,barPercentage:1},y:{beginAtZero:!0,border:{color:N("--cui-border-color-translucent")},grid:{color:N("--cui-border-color-translucent")},max:z,ticks:{color:N("--cui-body-color"),maxTicksLimit:window.innerWidth<768?4:5,stepSize:Math.ceil(z/(window.innerWidth<768?4:5)),font:{size:window.innerWidth<768?10:12},callback:function(c){return x(c)+"k"}}}},interaction:{mode:"index",intersect:!1},elements:{bar:{borderRadius:2}},layout:{padding:{top:10,left:window.innerWidth<768?5:10,right:window.innerWidth<768?5:10,bottom:5}},animation:{onComplete:function(c){c&&c.config&&c.config.options&&c.config.options.plugins&&(c.config.options.plugins.datalabels={display:!1})}}}})})]})},sa=[{value:1,label:"1 Month"},{value:3,label:"3 Months"},{value:6,label:"6 Months"},{value:12,label:"Yearly"}],gt=h=>{var qe,Ie,$e,ze,Oe;const w=na(),[x,T]=f.useState({monthlySales:Array(12).fill(0),monthlyExpense:Array(12).fill(0),monthlyPandL:Array(12).fill(0)}),[P,k]=f.useState([]),[F,G]=f.useState(""),{showToast:u}=za(),[i,ee]=f.useState(Qa()),[z,c]=f.useState(null),[L,U]=f.useState(!1),[C,xe]=f.useState({machineCount:0,totalProfit:0,totalExpenseAll:0,totalNet:0,customerCount:0,totalInvoices:0,totalBilled:0,totalPaid:0,totalOutstanding:0,totalSales:0,ytdPandL:0,totalProjects:0,totalWorkingReading:0}),ae=((qe=i==null?void 0:i.company_info)==null?void 0:qe.appMode)??"advance",{t:d,i18n:$}=ra("global");$.language;const[Y,fe]=f.useState({plans:[]}),[b,H]=f.useState({visible:!1,product:null,addedQty:0,maxAddable:0}),[te,Pe]=f.useState(""),re=f.useRef(!1),ca=a=>{const t=a.target.value,n=b.maxAddable;if(t===""){H(s=>({...s,addedQty:""})),re.current=!1;return}const o=parseInt(t,10);isNaN(o)||o<0?(H(s=>({...s,addedQty:0})),re.current=!1):o>n?(H(s=>({...s,addedQty:n})),re.current||(u("warning",d("MESSAGES.maximum_stock_limit",{max:n})),re.current=!0)):(H(s=>({...s,addedQty:o})),re.current=!1)},da=async()=>{var a,t;try{const n=b.product.id,o=b.product.product_id,s={size_id:n,added_qty:Number(b.addedQty)},r=await Z(`/api/product/${o}/update-quantity`,s);r.success!==!1?(u("success",d("MESSAGES.stock_updated_success")),H({visible:!1,product:null,addedQty:0,maxAddable:0}),me()):u("danger",d("MESSAGES.update_stock_failed",{error:r.message||"-"}))}catch(n){const o=((t=(a=n.response)==null?void 0:a.data)==null?void 0:t.message)||n.message||"-";u("danger",d("MESSAGES.update_stock_failed",{error:o}))}},[y,W]=f.useState({visible:!1,localNameEdited:!1,formData:{name:"",localName:"",slug:"",categoryId:0,incStep:1,desc:"",multiSize:!1,show:!0,returnable:!0,showOnHome:!0,unit:"",qty:"",stock:"",oPrice:"",media:[],sizes:[]},images:[]}),ma=()=>{var n,o;const a=((o=(n=i==null?void 0:i.company_info)==null?void 0:n.subscribed_plan_name)==null?void 0:o.toLowerCase())||"";return["monthly business essential (start-up) - credit report","monthly business essential (start-up) - advanced booking","quarterly business essential (start-up) - credit report","quarterly business essential (start-up) - advanced booking","half-yearly business essential (start-up) - credit report","half-yearly business essential (start-up) - advanced booking","annually business essential (start-up) - credit report","annually business essential (start-up) - advanced booking"].includes(a)},[q,O]=f.useState({visible:!1,csvFile:null,isUploading:!1,message:"",isError:!1}),[ua,oe]=f.useState(!1),[l,pa]=f.useState(null),[de,ha]=f.useState([]),[j,se]=f.useState({plan_id:1,duration:1,validity_date:""}),[xa,Fe]=f.useState(!1),[fa,ye]=f.useState(!1),ge=async()=>{try{if(w===1&&(i!=null&&i.company_id)){Fe(!0),console.log("Fetching subscription status for company:",i.company_id);const a=await Q(`/api/company/subscription-status/${i.company_id}`);a&&(console.log("Subscription status received:",a),pa(a),a.is_expired||a.is_expiring_soon?(ye(!0),a.is_expired&&oe(!0)):ye(!1))}}catch(a){console.error("Error fetching subscription status:",a),u("danger","Failed to fetch subscription status")}finally{Fe(!1)}},be=()=>{W(a=>({...a,visible:!1}))},le=a=>{const{name:t,value:n}=a.target;if(["qty","stock","incStep"].includes(t)){if(n===""){W(r=>({...r,formData:{...r.formData,[t]:""}}));return}let s=parseFloat(n);if(isNaN(s)||s<0)return;if(t==="stock"){const r=parseFloat(y.formData.qty)||0;if(r>0&&s>r){u("warning",`Stock cannot exceed capacity (${r})`);return}}if(t==="qty"){const r=parseFloat(y.formData.stock)||0;if(r>0&&s<r){u("warning",`Capacity cannot be less than current stock (${r})`);return}}W(r=>({...r,formData:{...r.formData,[t]:s}}));return}if(t==="oPrice"){if(n===""){W(r=>({...r,formData:{...r.formData,[t]:""}}));return}if(!/^\d*\.?\d{0,2}$/.test(n))return;W(r=>({...r,formData:{...r.formData,[t]:n}}));return}W(t==="name"?s=>({...s,formData:{...s.formData,name:n,localName:s.localNameEdited?s.formData.localName:n}}):t==="localName"?s=>({...s,localNameEdited:!0,formData:{...s.formData,localName:n}}):s=>({...s,formData:{...s.formData,[t]:n}}))},ya=a=>{const{name:t,checked:n}=a.target;W(o=>({...o,formData:{...o.formData,[t]:n}}))},ga=async a=>{try{if(!y||!Array.isArray(y.images)||y.images.length===0)return console.log("âœ… No images to upload."),{success:!0};const t=y.images.filter(Boolean);if(t.length===0)return console.log("âœ… All images were empty or invalid, skipping upload."),{success:!0};const n=new FormData;t.forEach((s,r)=>{n.append("images[]",s)}),n.append("product_id",a.toString()),console.log("ðŸ“¤ Uploading images for product ID:",a);const o=await Va("/api/product/media/multiple",n);return console.log("âœ… Image upload success:",o),{success:!0,response:o}}catch(t){return console.error("âŒ Image upload failed:",t),{success:!1,error:t}}},ba=async a=>{a.preventDefault();const t=a.target;if(!t.checkValidity()){t.classList.add("was-validated");return}const n=y.formData.oPrice,o=parseFloat(n);if(isNaN(o)||o<0){u("danger","Please enter a valid selling price");return}const s=parseFloat(y.formData.qty)||0,r=parseFloat(y.formData.stock)||0;if(r>s){u("danger",`Initial stock (${r}) cannot exceed capacity (${s})`);return}let p={...y.formData,sizes:[]};p.slug=p.name.replace(/[^\w]/g,"_"),y.formData.multiSize||(p.sizes.push({name:p.name,localName:p.localName,qty:p.qty,oPrice:n,dPrice:n,stock:p.stock,show:!0,returnable:p.returnable}),delete p.oPrice,delete p.qty,delete p.stock);try{const m=await Z("/api/product",p);console.log("âœ… Product creation response:",m),m&&m.id?(u("success","Product added successfully"),console.log("ðŸ“¦ Created product ID:",m.id),console.log("ðŸ–¼ï¸ Images before upload:",y.images),(await ga(m.id)).success?Array.isArray(y.images)&&y.images.filter(Boolean).length&&u("success","Images uploaded successfully"):u("warning","Product saved, but image upload failed."),be(),me()):m&&m.message?u("danger",m.message):u("danger","Unexpected response from server.")}catch(m){if(console.error("âŒ Product creation error:",m),m.response){const v=m.response.status,S=m.response.data;v===422&&S.errors?Object.entries(S.errors).forEach(([_e,Ne])=>{Ne.forEach(Se=>{u("danger",Se)})}):S.message?u("danger",S.message):u("danger",`Server error (${v}).`)}else m.request?u("danger","Network error. Please check your connection."):u("danger","An unexpected error occurred. Please try again.")}},Be=()=>{O(a=>({...a,visible:!1}))},ja=a=>{const t=a.target.files[0];O(n=>({...n,csvFile:t,message:"",isError:!1}))},va=async()=>{var t,n,o;if(!q.csvFile){O(s=>({...s,message:"Please select a CSV file to upload.",isError:!0}));return}if(q.csvFile.type!=="text/csv"&&!q.csvFile.name.endsWith(".csv")){O(s=>({...s,message:"Invalid file type. Please upload a valid CSV file.",isError:!0}));return}const a=new FormData;a.append("csv_file",q.csvFile);try{O(p=>({...p,isUploading:!0}));const s=await Ua("/api/uploadProducts",a,{headers:{"Content-Type":"multipart/form-data"}}),r=((t=s==null?void 0:s.data)==null?void 0:t.message)||(s==null?void 0:s.message);r?(O(p=>({...p,message:r,isError:!1,csvFile:null})),u("success","Products uploaded successfully!"),await me()):O(p=>({...p,message:"Upload failed. Check CSV format.",isError:!0}))}catch(s){console.error("Upload error:",s);const r=((o=(n=s.response)==null?void 0:n.data)==null?void 0:o.error)||"Upload failed. Check CSV format.";O(p=>({...p,message:r,isError:!0})),u("danger",r)}finally{O(s=>({...s,isUploading:!1}))}},wa=()=>{const a=document.createElement("a");a.href="sample_products_template.csv",a.download="SampleProductTemplate.csv",document.body.appendChild(a),a.click(),document.body.removeChild(a)};f.useEffect(()=>{try{ae==="advance"&&(async()=>{const t=await Q("/api/getMonthlyReportSummeries");T(t)})()}catch(a){u("danger","Error occurred "+a)}},[]);const me=async()=>{try{const a=await Q("/api/stock");k(a)}catch{u("danger","Error occurred while fetching stock")}};f.useEffect(()=>{me()},[]);const Me=a=>{const t=parseFloat(a)||0;if(isNaN(t))return"0.00";const[n,o="00"]=t.toFixed(2).split("."),s=n.slice(-3),r=n.slice(0,-3);return`${r?r.replace(/\B(?=(\d{2})+(?!\d))/g,",")+","+s:s}.${o}`};f.useEffect(()=>{const a=i==null?void 0:i.company_id;if(!a)return;let t=!1;return(async()=>{try{U(!0);const[o,s,r,p,m]=await Promise.all([Q("/api/machineries1").catch(()=>[]),Q(`/api/machineLog?company_id=${a}`).catch(()=>[]),Q(`/api/expense1?company_id=${a}`).catch(()=>[[]]),Q(`/api/project-payments?company_id=${a}`).catch(()=>[]),Q(`/api/myProjects?company_id=${a}`).catch(()=>[])]),v=Array.isArray(o)?o:[],S=Array.isArray(s)?s:[],_e=Array.isArray(r)?Array.isArray(r[0])?r[0]:r:[],Ne=Array.isArray(p)?p:[],Se=Array.isArray(m)?m.length:0,Ca=g=>v.reduce((_,E)=>{const R=g.filter(J=>Number(J.machine_id)===Number(E.id)).reduce((J,Ee)=>{const He=parseFloat(Ee.start_reading)||0,Je=parseFloat(Ee.end_reading)||0,Ze=parseFloat(Ee.price_per_hour)||0;return J+(Je>He&&Ze>0?(Je-He)*Ze:0)},0);return _+R},0),La=(g=>g.reduce((_,E)=>{const R=parseFloat(E.start_reading),J=parseFloat(E.end_reading);return!isNaN(R)&&!isNaN(J)&&J>R?_+(J-R):_},0))(S),Ea=g=>g.reduce((_,E)=>_+(parseFloat(E.total_price)||0),0),Aa=v.length,Pa=Ca(S),Qe=Ea(_e),Ue=Ne.filter(g=>g.company_id===a),Fa=Ue.reduce((g,_)=>{var R;const E=((R=_.project)==null?void 0:R.customer_name)||"Unknown";return g[E]=g[E]||[],g[E].push(_),g},{}),Ba=Object.keys(Fa).length,pe=Ue.filter(g=>!g.is_advance),Ma=pe.length,ke=pe.reduce((g,_)=>g+Number(_.total||0),0),Ve=pe.reduce((g,_)=>g+Number(_.paid_amount||0),0),Da=ke-Ve,Ge=ke,Ra=Ge-Qe,Ce=Array(12).fill(0);pe.forEach(g=>{const _=g.created_at||g.invoice_date;if(!_)return;const E=new Date(_);if(Number.isNaN(E.getTime()))return;const R=E.getMonth();Ce[R]+=Number(g.total||0)});const Le=Array(12).fill(0);_e.forEach(g=>{const _=g.expense_date||g.created_at;if(!_)return;const E=new Date(_);if(Number.isNaN(E.getTime()))return;const R=E.getMonth();Le[R]+=Number(g.total_price||0)});const Ye=Ce.map((g,_)=>g-Le[_]),Ta=Ye.reduce((g,_)=>g+_,0);t||(xe({machineCount:Aa,totalProfit:Pa,totalExpenseAll:Qe,totalNet:Ra,customerCount:Ba,totalInvoices:Ma,totalBilled:ke,totalPaid:Ve,totalOutstanding:Da,totalSales:Ge,ytdPandL:Ta,totalProjects:Se,totalWorkingReading:La}),T({monthlySales:Ce,monthlyExpense:Le,monthlyPandL:Ye}))}catch{u("danger","Failed to load dashboard summary")}finally{t||U(!1)}})(),()=>{t=!0}},[i==null?void 0:i.company_id]),f.useEffect(()=>{(async()=>{await Promise.all([ge(),_a()])})();const t=setInterval(()=>{ge()},5*60*1e3);return()=>clearInterval(t)},[i==null?void 0:i.company_id]);const _a=async()=>{try{const a=await Q("/api/detailsForCompany");console.log("Raw response:",a);const t=(a==null?void 0:a.plans)||[];fe(o=>({...o,plans:t}));const n=t.filter(o=>{var r;const s=((r=o.name)==null?void 0:r.toLowerCase())||"";return(s.includes("monthly")||s.includes("annually")||s.includes("quarterly")||s.includes("half-yearly"))&&!s.includes("free trial")});console.log("Filtered Plans:",n),ha(n)}catch(a){console.error("Error fetching plans:",a),u("danger","Failed to fetch subscription plans")}},De=(a=null)=>{const t=a??j.duration;if(!(l!=null&&l.subscription_validity)){const p=new Date,m=new Date(p);return m.setMonth(m.getMonth()+parseInt(t)),m.toISOString().split("T")[0]}const n=new Date(l.subscription_validity),o=new Date,s=n>o?n:o,r=new Date(s);return r.setMonth(r.getMonth()+parseInt(t)),r.toISOString().split("T")[0]},Re=a=>{var o,s,r,p;const{name:t,value:n}=a.target;if(t==="plan_id"){const m=de.find(S=>S.id===parseInt(n));let v=1;(o=m==null?void 0:m.name)!=null&&o.toLowerCase().includes("annually")?v=12:(s=m==null?void 0:m.name)!=null&&s.toLowerCase().includes("monthly")?v=1:(r=m==null?void 0:m.name)!=null&&r.toLowerCase().includes("quarterly")?v=3:(p=m==null?void 0:m.name)!=null&&p.toLowerCase().includes("half-yearly")&&(v=6),se(S=>({...S,plan_id:n,duration:v,validity_date:De(v)}))}else se(m=>({...m,[t]:n}))},Te=a=>{const t=parseInt(a.target.value);se(n=>({...{...n,duration:t},validity_date:De()}))};f.useEffect(()=>{if(j.duration&&(l!=null&&l.subscription_validity)){const a=new Date(l.subscription_validity),t=new Date,n=a>t?a:t,o=new Date(n);o.setMonth(o.getMonth()+parseInt(j.duration));const s=o.toISOString().split("T")[0];s!==j.validity_date&&se(r=>({...r,validity_date:s}))}},[j.duration,j.plan_id,l]);const je=a=>Math.round(a*5)/5,B=()=>de.find(a=>a.id==j.plan_id),ve=()=>{const a=B();if(!a)return 0;const n=a.price*j.duration/1.18;return je(n)},we=()=>{const a=B();if(!a)return 0;const t=a.price*j.duration,n=t/1.18,o=t-n;return je(o)},V=()=>{const a=B();if(!a)return 0;const t=a.price*j.duration;return je(t)},Na=(a,t)=>{var n,o,s,r,p;try{const m={company:{company_name:((n=i==null?void 0:i.company_info)==null?void 0:n.company_name)||(i==null?void 0:i.name)||"N/A",phone_no:(i==null?void 0:i.mobile)||((o=i==null?void 0:i.company_info)==null?void 0:o.phone_no)||"N/A",email_id:(i==null?void 0:i.email)||((s=i==null?void 0:i.company_info)==null?void 0:s.email_id)||"N/A"},plan:{name:((r=B())==null?void 0:r.name)||"Selected Plan",price:((p=B())==null?void 0:p.price)||0},transaction_id:(a==null?void 0:a.razorpay_payment_id)||"N/A",total_amount:ve(),gst:we(),payable_amount:V(),valid_till:j.validity_date,created_at:new Date().toISOString(),renewal_duration:j.duration};console.log("Generating PDF with data:",m);const v=Ga(m);return console.log("PDF generated successfully:",v),u("success","Receipt downloaded successfully!"),v}catch(m){console.error("Error generating PDF receipt:",m),u("warning","Subscription renewed successfully, but failed to generate receipt PDF")}},Sa=a=>a.is_expired?"expired":a.is_trial?"trial":a.days_remaining<15?"critical":a.days_remaining<=30?"warning":"active",ka=a=>a.is_expired||a.days_remaining<15?"danger":a.is_trial||a.days_remaining<=30?"warning":"success",We=async()=>{var a;try{if(!j.plan_id||!j.duration){u("danger","Please select a plan and duration");return}if(!window.Razorpay){const o=document.createElement("script");o.src="https://checkout.razorpay.com/v1/checkout.js",await new Promise((s,r)=>{o.onload=s,o.onerror=r,document.body.appendChild(o)})}const t={amount:V()},n=await Z("/api/create-order",t);if(n){const o={key:n.key,amount:n.order.amount,currency:n.order.currency,order_id:n.order.id,name:"Subscription Renewal",description:`${(a=B())==null?void 0:a.name} - ${j.duration} months`,handler:async r=>{try{const p=await Z("/api/verify-payment",{razorpay_order_id:r.razorpay_order_id,razorpay_payment_id:r.razorpay_payment_id,razorpay_signature:r.razorpay_signature});if(p!=null&&p.success){const m={company_id:i.company_id,plan_id:j.plan_id,total_amount:V(),valid_till:j.validity_date,transaction_id:r.razorpay_payment_id,transaction_status:"success",renewal_type:"extension"},v=await Z("/api/company-receipt",m),S=await Z("/api/company/update-validity",{company_id:i.company_id,valid_till:j.validity_date,plan_id:j.plan_id});v!=null&&v.success&&(S!=null&&S.success)?(u("success","Subscription renewed successfully!"),setTimeout(()=>{Na(r,v)},1e3),oe(!1),ye(!1),await ge()):u("danger","Payment successful but failed to update subscription. Please contact support.")}else u("danger","Payment verification failed")}catch(p){u("danger","Payment successful but failed to update subscription: "+p),console.error("Renewal error:",p)}},prefill:{name:i.name,email:i.email,contact:i.mobile},theme:{color:"#3399cc"}},s=new window.Razorpay(o);s.open(),s.on("payment.failed",async r=>{var p,m,v;console.error("Payment Failed:",r.error),u("danger","Payment failed. Please try again.");try{const S={company_id:i.company_id,plan_id:j.plan_id,user_id:i.id,total_amount:V(),valid_till:j.validity_date,transaction_id:((m=(p=r.error)==null?void 0:p.metadata)==null?void 0:m.payment_id)??"failed",transaction_status:((v=r.error)==null?void 0:v.description)??"Failed",renewal_type:"extension_failed"};await Z("/api/company-receipt",S)}catch(S){console.error("Error logging failed payment:",S)}})}}catch(t){console.error("Payment error:",t),u("danger","Something went wrong with payment: "+t.message)}},ue=(a,t)=>{const n=parseInt(a)||0,o=parseInt(t)||1,s=n/o*100;return s<20?{level:"critical",color:"danger",strobe:!0,percentage:s.toFixed(1),description:"Critical - Less than 20% stock remaining"}:s>=20&&s<=50?{level:"low",color:"warning",strobe:!0,percentage:s.toFixed(1),description:"Low - 20-50% stock remaining"}:{level:"good",color:"success",strobe:!1,percentage:s.toFixed(1),description:"Good - More than 50% stock remaining"}};return P.filter(a=>{if(!a.product||!a.product.showOnHome)return!1;const t=(a.name||"").toLowerCase(),n=(a.localName||"").toLowerCase(),o=F.toLowerCase(),s=t.includes(o)||n.includes(o);if(z){const r=a.stock/a.qty*100;if(z==="critical"&&r>=20||z==="low"&&(r<20||r>50)||z==="good"&&r<=50)return!1}return s}),xa&&!l?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):l!=null&&l.is_expired&&w===1?e.jsx(e.Fragment,{children:e.jsxs(Ke,{visible:!0,backdrop:"static",keyboard:!1,size:"lg",children:[e.jsx(Xe,{closeButton:!1,children:e.jsx(ea,{children:"Subscription Expired"})}),e.jsxs(aa,{children:[e.jsx(he,{color:"danger",children:e.jsxs("div",{children:[e.jsx("h5",{children:"Your subscription has expired!"}),e.jsxs("p",{children:["Your subscription expired on ",l.validity_date_formatted,"."]}),e.jsx("p",{children:"Please renew your subscription to continue using the service."})]})}),e.jsxs(Ae,{children:[e.jsxs(X,{children:[e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"billing_type",children:"Billing Type"}),e.jsxs(ne,{id:"billing_type",name:"billing_type",value:te,onChange:a=>{Pe(a.target.value),se(t=>({...t,plan_id:""}))},children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"half-yearly",children:"Half-Yearly"}),e.jsx("option",{value:"annually",children:"Annually"})]})]})}),e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"plan_id",children:"Select Plan"}),e.jsx(ne,{id:"plan_id",name:"plan_id",value:j.plan_id,onChange:Re,options:[{value:"",label:"Select a plan..."},...de.filter(a=>{var n;const t=((n=a.name)==null?void 0:n.toLowerCase())||"";return te?t.includes(te.toLowerCase()):t.includes("monthly")}).map(a=>({value:a.id,label:`${a.name} (â‚¹${a.price}/month incl. GST)`}))]})]})}),e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"duration",children:"Duration"}),e.jsx(ne,{id:"duration",name:"duration",value:j.duration,onChange:Te,options:sa,disabled:!0})]})})]}),e.jsx(X,{children:e.jsx(A,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"validity_date",children:"New Validity Date"}),e.jsx(K,{type:"date",id:"validity_date",name:"validity_date",value:j.validity_date,readOnly:!0})]})})}),B()&&e.jsxs(he,{color:"info",children:[e.jsx("h6",{children:"Payment Summary"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Plan: ",(Ie=B())==null?void 0:Ie.name]}),e.jsxs("p",{className:"mb-1",children:["Duration: ",j.duration," months"]}),e.jsxs("p",{className:"mb-1",children:["Rate: â‚¹",($e=B())==null?void 0:$e.price,"/month (incl. GST)"]})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Base Amount: â‚¹",ve()]}),e.jsxs("p",{className:"mb-1",children:["GST (18%): â‚¹",we()]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:["Total: â‚¹",V()]})})]})]})]})]})]}),e.jsx(ta,{children:e.jsxs(I,{color:"primary",onClick:We,disabled:!B(),size:"lg",children:["Pay â‚¹",V()," & Renew Now"]})})]})}):e.jsxs(e.Fragment,{children:[fa&&l&&e.jsxs("div",{className:`subscription-banner ${Sa(l)}`,children:[e.jsx("style",{children:`
        @keyframes flicker {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.7; }
        }
        
        .subscription-banner {
          border-radius: 5px;
          margin-bottom: 20px;
          animation: flicker 2s infinite;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 15px;
          flex-wrap: wrap;
        }
        
        /* Expired - Red */
        .subscription-banner.expired {
          background-color: #f8d7da;
          border: 1px solid #f5c6cb;
          color: #721c24;
        }
        
        /* Critical (less than 15 days) - Red */
        .subscription-banner.critical {
          background-color: #f8d7da;
          border: 1px solid #f5c6cb;
          color: #721c24;
        }
        
        /* Warning (1 month or less) - Yellow */
        .subscription-banner.warning {
          background-color: #fff3cd;
          border: 1px solid #ffeaa7;
          color: #856404;
        }
        
        /* Free Trial - Orange */
        .subscription-banner.trial {
          background-color: #ffe8d1;
          border: 1px solid #ffb347;
          color: #8b4513;
        }
        
        /* Active (more than 1 month) - Green */
        .subscription-banner.active {
          background-color: #d4edda;
          border: 1px solid #c3e6cb;
          color: #155724;
        }
        
        .subscription-banner .banner-text {
          font-weight: bold;
          flex: 1;
          min-width: 300px;
          margin-right: 15px;
        }
        
        .subscription-banner .banner-button {
          flex-shrink: 0;
        }
        
        /* Mobile Responsive - Text left, button right like in your image */
        @media (max-width: 767px) {
          .subscription-banner {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            gap: 10px;
          }
          
          .subscription-banner .banner-text {
            min-width: auto;
            margin-right: 10px;
            font-size: 13px;
            line-height: 1.3;
            text-align: left;
            flex: 1;
          }
          
          .subscription-banner .banner-button {
            flex-shrink: 0;
            width: auto;
          }
        }
        
        /* Small mobile devices */
        @media (max-width: 480px) {
          .subscription-banner {
            padding: 10px;
            gap: 8px;
          }
          
          .subscription-banner .banner-text {
            font-size: 12px;
            line-height: 1.2;
            margin-right: 8px;
          }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
          .subscription-banner {
            padding: 8px;
            gap: 6px;
          }
          
          .subscription-banner .banner-text {
            font-size: 11px;
            margin-right: 6px;
          }
        }
      `}),e.jsx("div",{className:"banner-text",children:l.is_expired?e.jsxs("span",{children:["Your subscription has expired! Your subscription expired on ",l.validity_date_formatted,". Please renew your subscription to continue using the service."]}):e.jsx("span",{children:l.is_trial?`Free trial expiring in ${Math.abs(l.days_remaining)} days on ${l.validity_date_formatted}. Upgrade now to continue using the service.`:`Subscription expiring in ${Math.abs(l.days_remaining)} days on ${l.validity_date_formatted}. Renew now to avoid service interruption.`})}),e.jsx("div",{className:"banner-button",children:e.jsx(I,{color:ka(l),size:"sm",onClick:()=>oe(!0),style:{fontWeight:"bold"},children:l.is_trial?"Upgrade Now":"Renew Now"})})]}),ae==="advance"&&e.jsx(ia,{className:"mb-2",reportMonth:x,totalSales:C.totalSales,totalExpense:C.totalExpenseAll,totalWorkingReading:C.totalWorkingReading}),(w===0||w===1)&&e.jsxs(X,{className:"g-2 mb-3",children:[e.jsx(A,{xs:12,md:4,children:e.jsxs("div",{className:"rounded p-2 text-center bg-primary text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Total Machines"}),e.jsx("strong",{className:"fs-6",children:L?"-":C.machineCount})]})}),e.jsx(A,{xs:12,md:4,children:e.jsxs("div",{className:`rounded p-2 text-center shadow-sm ${C.totalSales-C.totalOutstanding>=0?"bg-success text-white":"bg-danger text-white"}`,children:[e.jsx("small",{className:"d-block",children:"Payment Received"}),e.jsx("strong",{className:"fs-6",children:L?"-":Me(C.totalSales-C.totalOutstanding)})]})}),e.jsx(A,{xs:12,md:4,children:e.jsxs("div",{className:"rounded p-2 text-center bg-danger text-white shadow-sm",children:[e.jsx("small",{className:"d-block",children:"Credit Amount"}),e.jsx("strong",{className:"fs-6",children:L?"-":Me(C.totalOutstanding)})]})})]}),e.jsxs(Ke,{visible:ua,onClose:l!=null&&l.is_expired?void 0:()=>oe(!1),backdrop:l!=null&&l.is_expired?"static":!0,keyboard:!(l!=null&&l.is_expired),size:"lg",children:[e.jsx(Xe,{closeButton:!(l!=null&&l.is_expired),children:e.jsx(ea,{children:l!=null&&l.is_expired?"Subscription Expired":"Subscription Expiring Soon"})}),e.jsxs(aa,{children:[e.jsx(he,{color:l!=null&&l.is_expired?"danger":"warning",children:l!=null&&l.is_expired?e.jsxs("div",{children:[e.jsx("h5",{children:"Your subscription has expired!"}),e.jsxs("p",{children:["Your subscription expired ",Math.abs(l.days_remaining)," days ago on ",l.validity_date_formatted,"."]}),e.jsx("p",{children:"Please renew your subscription to continue using the service."})]}):e.jsxs("div",{children:[e.jsx("h5",{children:"Subscription Expiring Soon!"}),e.jsxs("p",{children:["Your subscription will expire in ",l==null?void 0:l.days_remaining," days on ",l==null?void 0:l.validity_date_formatted,"."]}),e.jsx("p",{children:"Renew now to avoid service interruption."})]})}),e.jsxs(Ae,{children:[e.jsxs(X,{children:[e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"billing_type",children:"Billing Type"}),e.jsxs(ne,{id:"billing_type",name:"billing_type",value:te,onChange:a=>{Pe(a.target.value),se(t=>({...t,plan_id:""}))},children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"half-yearly",children:"Half-Yearly"}),e.jsx("option",{value:"annually",children:"Annually"})]})]})}),e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"plan_id",children:"Select Plan"}),e.jsx(ne,{id:"plan_id",name:"plan_id",value:j.plan_id,onChange:Re,options:[{value:"",label:"Select a plan..."},...de.filter(a=>{var n;const t=((n=a.name)==null?void 0:n.toLowerCase())||"";return te?t.includes(te.toLowerCase()):t.includes("monthly")}).map(a=>({value:a.id,label:`${a.name} (â‚¹${a.price}/month incl. GST)`}))]})]})}),e.jsx(A,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"duration",children:"Duration"}),e.jsx(ne,{id:"duration",name:"duration",value:j.duration,onChange:Te,options:sa,disabled:!0})]})})]}),e.jsx(X,{children:e.jsx(A,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{htmlFor:"validity_date",children:"New Validity Date"}),e.jsx(K,{type:"date",id:"validity_date",name:"validity_date",value:j.validity_date,readOnly:!0})]})})}),B()&&e.jsxs(he,{color:"info",children:[e.jsx("h6",{children:"Payment Summary"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Plan: ",(ze=B())==null?void 0:ze.name]}),e.jsxs("p",{className:"mb-1",children:["Duration: ",j.duration," months"]}),e.jsxs("p",{className:"mb-1",children:["Rate: â‚¹",(Oe=B())==null?void 0:Oe.price,"/month (incl. GST)"]})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("p",{className:"mb-1",children:["Base Amount: â‚¹",ve()]}),e.jsxs("p",{className:"mb-1",children:["GST (18%): â‚¹",we()]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:["Total: â‚¹",V()]})})]})]})]})]})]}),e.jsxs(ta,{children:[!(l!=null&&l.is_expired)&&e.jsx(I,{color:"secondary",onClick:()=>oe(!1),children:"Later"}),e.jsxs(I,{color:"primary",onClick:We,disabled:!B(),children:["Pay â‚¹",V()," & Renew"]})]})]}),y.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0.5rem auto",maxWidth:"min(600px, calc(100vw - 1rem))",width:"100%"},children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:d("LABELS.create_new_product")}),e.jsx("button",{type:"button",className:"btn-close",onClick:be})]}),e.jsx("div",{className:"modal-body",children:e.jsxs(Ae,{className:"needs-validation",noValidate:!0,onSubmit:ba,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-12 col-sm-6 mb-3 mb-sm-0",children:[e.jsx(M,{htmlFor:"pname",children:e.jsx("b",{children:d("LABELS.product_name")})}),e.jsx(K,{type:"text",id:"pname",placeholder:d("LABELS.product_name"),name:"name",value:y.formData.name,onChange:le,required:!0,feedbackInvalid:d("LABELS.please_provide_name"),feedbackValid:d("LABELS.looks_good")}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.product_name_required")})]}),e.jsxs("div",{className:"col-12 col-sm-6",children:[e.jsx(M,{htmlFor:"plname",children:e.jsx("b",{children:d("LABELS.local_name")})}),e.jsx(K,{type:"text",id:"plname",placeholder:d("LABELS.local_name"),name:"localName",value:y.formData.localName,onChange:le}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.local_name_required")})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-12 col-sm-4 mb-3 mb-sm-0",children:[e.jsx(M,{htmlFor:"qty",children:e.jsx("b",{children:d("LABELS.capacity")})}),e.jsx(K,{type:"number",id:"qty",placeholder:"0",min:"0",onWheel:a=>a.target.blur(),name:"qty",value:y.formData.qty,onChange:le,required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.quantity_required")})]}),e.jsxs("div",{className:"col-12 col-sm-4 mb-3 mb-sm-0",children:[e.jsx(M,{htmlFor:"stock",children:e.jsx("b",{children:d("LABELS.initial_stock")})}),e.jsx(K,{type:"number",id:"stock",placeholder:"0",min:"0",onWheel:a=>a.target.blur(),max:y.formData.qty||void 0,name:"stock",value:y.formData.stock,onChange:le,required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.initial_stock_required")}),y.formData.qty&&y.formData.stock>y.formData.qty&&e.jsxs("div",{className:"text-danger small mt-1",children:["Stock cannot exceed capacity (",y.formData.qty,")"]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx(M,{htmlFor:"oPrice",children:e.jsx("b",{children:d("LABELS.selling_price")})}),e.jsx(K,{type:"text",id:"oPrice",placeholder:"0.00",name:"oPrice",onWheel:a=>a.target.blur(),value:y.formData.oPrice,onChange:le,onBlur:a=>{const t=a.target.value;if(t&&!isNaN(parseFloat(t))){const n=parseFloat(t).toFixed(2);W(o=>({...o,formData:{...o.formData,oPrice:n}}))}},pattern:"^\\d*\\.?\\d{0,2}$",title:"Please enter a valid price (up to 2 decimal places)",required:!0}),e.jsx("div",{className:"invalid-feedback",children:d("LABELS.selling_price_required")})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(M,{children:e.jsx("b",{children:"Upload Images"})}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",className:"form-control",onChange:a=>{W(t=>({...t,images:[...a.target.files]}))}})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsx(Ya,{id:"show",label:d("LABELS.show_for_invoicing"),name:"show",checked:y.formData.show,onChange:ya})})}),e.jsxs("div",{className:"modal-footer d-flex gap-2",children:[e.jsx(I,{color:"secondary",onClick:be,className:"flex-fill flex-sm-grow-0",children:d("LABELS.cancel")}),e.jsx(I,{color:"success",type:"submit",className:"flex-fill flex-sm-grow-0",disabled:y.formData.stock>y.formData.qty||!y.formData.name||!y.formData.qty||!y.formData.oPrice,children:d("LABELS.create_product")})]})]})})]})})}),q.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:d("LABELS.upload_product_csv")}),e.jsx("button",{type:"button",className:"btn-close",onClick:Be})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3 d-flex align-items-center",children:[e.jsx("strong",{className:"me-2",children:d("LABELS.sample_csv_template")}),e.jsxs(I,{color:"success",variant:"outline",size:"sm",title:d("LABELS.download_sample_template"),onClick:wa,children:["ðŸ“¥ ",d("LABELS.download")]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"csvFile",className:"form-label",children:e.jsx("strong",{children:d("LABELS.select_csv_file")})}),e.jsx("input",{type:"file",id:"csvFile",className:"form-control",accept:".csv",onChange:ja})]}),q.message&&e.jsx("div",{className:`alert ${q.isError?"alert-danger":"alert-success"}`,role:"alert",children:q.message})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(I,{color:"secondary",onClick:Be,children:d("LABELS.cancel")}),e.jsx(I,{color:"success",onClick:va,disabled:q.isUploading||!q.csvFile,children:q.isUploading?d("LABELS.uploading"):d("LABELS.upload_csv")})]})]})})}),b.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[d("LABELS.add_stock")," - ",b.product.name]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>H({visible:!1,product:null,addedQty:0,maxAddable:0})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("p",{className:"mb-1",children:[e.jsxs("b",{children:[d("LABELS.total_quantity"),":"]})," ",e.jsx("span",{className:"badge bg-primary",children:b.product.qty??0})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("p",{className:"mb-1",children:[e.jsxs("b",{children:[d("LABELS.current_stock"),":"]})," ",e.jsx("span",{className:`badge ${ue(b.product.stock??0,b.product.qty||1).color==="danger"?"bg-danger":ue(b.product.stock??0,b.product.qty||1).color==="warning"?"bg-warning text-dark":"bg-success"}`,style:{animation:ue(b.product.stock??0,b.product.qty||1).strobe?"stockStrobe 1.5s infinite":"none"},children:b.product.stock??0})]})})]}),e.jsx("div",{className:"alert alert-info",children:e.jsxs("small",{children:[e.jsxs("strong",{children:[d("LABELS.stock_percentage"),":"]})," ",ue(b.product.stock??0,b.product.qty||1).percentage,"% ",d("LABELS.of_total_quantity")]})}),b.maxAddable>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsxs("b",{children:[d("LABELS.stock_to_add"),":"]}),e.jsxs("small",{className:"text-muted ms-2",children:["(",d("LABELS.max"),": ",b.maxAddable,")"]})]}),e.jsx("input",{type:"number",min:"1",max:b.maxAddable,onWheel:a=>a.target.blur(),className:"form-control custom-placeholder",placeholder:`${d("LABELS.enter_stock_to_add")} (${d("LABELS.max")}: ${b.maxAddable})`,value:b.addedQty,onChange:ca})]}),e.jsx("div",{className:"alert alert-success",children:e.jsxs("small",{children:[e.jsxs("strong",{children:[d("LABELS.after_adding"),":"]})," ",d("LABELS.stock_will_be")," ",(b.product.stock??0)+(parseInt(b.addedQty)||0)," / ",b.product.qty??0]})})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsxs("strong",{children:[d("LABELS.stock_is_full"),"!"]})," ",d("LABELS.stock_full_message")]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(I,{color:"secondary",onClick:()=>H({visible:!1,product:null,addedQty:0,maxAddable:0}),children:d("LABELS.cancel")}),e.jsx(I,{color:"primary",onClick:da,disabled:!b.addedQty||parseInt(b.addedQty)<1||b.maxAddable<=0,children:d("LABELS.add_stock")})]})]})})}),(w===0||w===1)&&ae==="advance"&&!ma()&&e.jsx(oa,{className:"mt-4 mb-4",children:e.jsxs(la,{children:[e.jsxs(X,{children:[e.jsxs(A,{sm:5,children:[e.jsx("h4",{id:"traffic",className:"card-title mb-0",children:"P&L (In Thousands)"}),e.jsx("div",{className:"small text-body-secondary",children:"January - December"})]}),e.jsx(A,{sm:7,className:"d-none d-md-block"})]}),e.jsx(Ha,{monthlyPandL:x.monthlyPandL,monthlySales:x.monthlySales,monthlyExpense:x.monthlyExpense,totalSales:C.totalSales,totalExpense:C.totalExpenseAll,totalPandL:C.totalSales-C.totalExpenseAll,totalWorkingReading:C.totalWorkingReading})]})})]})};export{gt as default};
