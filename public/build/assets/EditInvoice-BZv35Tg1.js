import{c as g,u as v,e as _,r as s,b as h,j as c}from"./index-BTeA492D.js";import{a as S,b as I}from"./api-BUyL__Lx.js";import b from"./Invoice-Ddfiyh5H.js";import{u as j}from"./DefaultLayout-1THlq5Yf.js";/* empty css                */import"./index.esm-UVM2W3HN.js";import"./ChargeTypeModal-saJI5du2.js";import"./CForm-DLTIQo7N.js";import"./CFormLabel-N-ZSSVsb.js";import"./CFormInput-C-f2xD8x.js";import"./CFormControlWrapper-B0MocaRk.js";import"./CFormControlValidation-CspEyxkQ.js";import"./CFormCheck-ivdAOR5w.js";import"./CCardBody-BDPTx9XL.js";import"./CCardHeader-7X8EpRUb.js";import"./CInputGroup-CO3LbqLS.js";import"./CInputGroupText-DcS059QV.js";import"./cil-search-CDkY_4k-.js";import"./cil-x-0440B5Ce.js";import"./CFormSelect-B_ay71cr.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-DvMRSoFa.js";import"./CNavItem-Dms8XRKU.js";const W=()=>{const{id:a}=g(),m=v(),d=_(),i=new URLSearchParams(d.search).get("convertTo"),[l,p]=s.useState(null),[u,f]=s.useState(!0),[y,T]=s.useState(!1),{showToast:r}=h(),{t:o}=j("global");s.useEffect(()=>{(async()=>{try{const e=await S(`/api/order/${a}`);console.log("Fetched order:",e),e?(p({projectId:e.project_id||null,projectName:e.customer_name||"N/A",customer_id:e.id||null,customer:{name:e.customer_name||"Unknown",address:e.address||"N/A",mobile:e.mobile_number||"N/A"},lat:e.lat||"",long:"",payLater:e.payLater||!1,isSettled:e.isSettled||!1,invoiceDate:e.invoiceDate,deliveryTime:e.deliveryTime||"",deliveryDate:e.deliveryDate,invoiceType:i?parseInt(i):e.invoiceType||3,items:(e.items||[]).map(t=>({work_type:t.work_type||"",qty:t.qty||0,price:t.price||0,total_price:t.total_price||0,remark:t.remark||null})),orderStatus:i?parseInt(i):e.orderStatus,totalAmount:e.totalAmount||0,discount:e.discount||0,balanceAmount:e.finalAmount-e.paidAmount,paidAmount:e.paidAmount||0,finalAmount:e.finalAmount||0,paymentType:e.paymentType||0}),T(!0)):r("danger","No order data found")}catch(e){console.error("Fetch order error:",e),r("danger",o("TOAST.fetch_order_failed"))}finally{f(!1)}})()},[a,i,r,o]);const A=async n=>{try{const e={...n,id:a,project_id:n.projectId,remainingBalance:n.finalAmount-n.paidAmount};console.log("Updating order:",e);const t=await I(`/api/order/${a}`,e);t!=null&&t.success?(r("success",o("TOAST.order_updated")),m(`/invoice-details/${a}`)):r("danger",(t==null?void 0:t.message)||o("TOAST.update_failed"))}catch(e){console.error("Update error:",e),r("danger",o("TOAST.update_error"))}};return u||!y?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(b,{editMode:!0,initialData:l,onSubmit:A})};export{W as default};
