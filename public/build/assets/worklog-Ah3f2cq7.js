import{r as i,b as ja,u as xa,j as a}from"./index-BaFO0fBD.js";import{d as h,c as A,a as O,b as f}from"./index.esm-6sS0QU7y.js";import{g as ya,a as T,p as de,c as va}from"./api-BUyL__Lx.js";import{S as me}from"./react-select.esm-DeuiOKyF.js";import{N as Ca}from"./NewCustomerModal-Bn8IwF1H.js";import{a as We,b as $e,c as ze,d as He,e as Le,g as wa}from"./DefaultLayout-CO5Zw0Z5.js";import{C as j}from"./CFormLabel-zcG2lLqz.js";import{C as N}from"./CFormInput-Bf1zI-co.js";import{C as Sa}from"./RawMaterial-D7bfBri4.js";import{C as U,a as B}from"./CCardBody-C_DcNhkI.js";import{C as ba}from"./CCardHeader-uQH1AYuq.js";import{C as Na}from"./CForm-aAQP41oT.js";import{C as Oe}from"./CInputGroup-jXSXCS9j.js";import{c as Ue}from"./cil-x-0440B5Ce.js";import{c as Be}from"./cil-file-CeQgYs_D.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-BebhqztA.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./cil-user-Dlmw-Gem.js";import"./CNavItem-BYh17SIg.js";import"./CFormControlWrapper-DiPXZd7c.js";import"./CFormControlValidation-D0XpqgJc.js";var ka=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M471.993,112h-89.2L366.551,65.25a32.023,32.023,0,0,0-30.229-21.5H175.241a31.991,31.991,0,0,0-30.294,21.691L129.1,112h-89.1a24.027,24.027,0,0,0-24,24V448a24.027,24.027,0,0,0,24,24H471.993a24.027,24.027,0,0,0,24-24V136A24.027,24.027,0,0,0,471.993,112Zm-8,328H48.007V144h104.01l23.224-68.25H336.322L360.032,144H463.993Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M256,168A114,114,0,1,0,370,282,114.13,114.13,0,0,0,256,168Zm0,196a82,82,0,1,1,82-82A82.093,82.093,0,0,1,256,364Z' class='ci-primary'/>"];const ee=()=>new Date().toISOString().split("T")[0],Ve=()=>({project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null,work_type_id:""}]}),Xa=()=>{var Ie;const o=ya(),p=o==null?void 0:o.type;o==null||o.name;const[m,y]=i.useState(()=>{var e;return{project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:p===2&&((e=o==null?void 0:o.id)==null?void 0:e.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null,work_type_id:""}]}}),{showToast:c}=ja(),[De,ae]=i.useState(!1),[he,V]=i.useState([]),[D,C]=i.useState(""),[Q,ue]=i.useState([]),[I,Qe]=i.useState([]),[Ze,se]=i.useState([]),[qe,w]=i.useState(!1),[pe,Ye]=i.useState(0),[W,Z]=i.useState(!1),[ge,q]=i.useState(null),[te,Y]=i.useState(null),[re,Ge]=i.useState(null),[$,Xe]=i.useState(""),[k,S]=i.useState([]);i.useState([]);const[fe,_e]=i.useState(!1),[je,xe]=i.useState(!1),[ye,ne]=i.useState([]),[z,R]=i.useState({}),[Je,b]=i.useState({}),[Ke,ie]=i.useState(!1),[ea,aa]=i.useState(""),[M,sa]=i.useState(!1),[ve,Ce]=i.useState([]);i.useEffect(()=>{(async()=>{try{const r=(await T("/api/workingType")||[]).map(t=>({value:t.id,label:t.type_of_work}));Ce(r)}catch(s){console.error("Error fetching work types",s)}})()},[]);const[G,we]=i.useState("environment"),X=i.useCallback(()=>{var e;y({project_id:"",project_name:"",date:ee(),machineReading:[{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:p===2&&((e=o==null?void 0:o.id)==null?void 0:e.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,price_per_hour:0,machine_start_pic:null,machine_end_pic:null,work_type_id:""}]}),C(""),S([]),E(!1),se([]),w(!1),R({}),b({})},[p,o==null?void 0:o.id]);i.useEffect(()=>{X()},[X]);const[F,E]=i.useState(!1);xa();const Se=async(e,s)=>{if(!e)return c("danger","No image file to upload."),null;const r=new FormData;r.append("file",e),r.append("dest",s);try{const t=await va("/api/fileUpload",r);if(t&&t.success)return c("success",t.message),t.fileName;throw new Error(t.message||"File upload failed.")}catch(t){return console.error("Error uploading image:",t),c("danger",t.message||"Could not upload image."),null}},H=i.useRef(null),oe=i.useRef(null),P=i.useRef(null);i.useRef(!1),Q.filter(e=>Ze.includes(e.value));const[ta,J]=i.useState(!1),[ce,be]=i.useState(""),[K,Ne]=i.useState(null),ra=async()=>{var e,s;if(!ce.trim()){c("danger","Please enter work type name");return}try{const r=await de("/api/saveWorkingType",{type_of_work:ce.trim()});c("success","Work type added successfully");const t={value:r.data.id,label:r.data.type_of_work};Ce(l=>[...l,t]),R(l=>({...l,[K]:t.label})),b(l=>({...l,[K]:!1})),K!==null&&_(K,"work_type_id",t.value),be(""),Ne(null),J(!1)}catch(r){console.error(r);const t=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message||"Failed to add work type";c("danger",t)}},na=e=>{R(s=>({...s,[e]:""})),b(s=>({...s,[e]:!0}))},ke=e=>e?ve.filter(s=>s.label.toLowerCase().includes(e.toLowerCase())):ve,le=i.useCallback(async e=>{try{const s=await T(`/api/projects?searchQuery=${e}`);V(s||[])}catch(s){console.error("Error fetching projects:",s),V([])}},[]);i.useEffect(()=>{T("/api/operatorsByType").then(e=>{const s=e.map(r=>({value:r.id.toString(),label:r.name}));if(p===2&&(o!=null&&o.id)){const r=s.find(t=>t.value===o.id.toString());ue(r?[r]:s)}else ue(s)}).catch(e=>{console.error("Error fetching operators:",e)})},[p,o==null?void 0:o.id]),i.useEffect(()=>{(async()=>{try{const s=await T("/api/machine-operators");console.log("machines from workslog",s),Array.isArray(s)&&Qe(s)}catch(s){console.error("Error fetching machineries:",s)}})()},[]),i.useEffect(()=>{(async()=>{try{const s=await T("/api/machine-price");console.log("machine prices",s),Array.isArray(s)?ne(s):(console.error("Unexpected response format:",s),ne([]))}catch(s){console.error("Error fetching machine prices:",s),ne([])}})()},[]),i.useEffect(()=>{const e=setTimeout(()=>{le(D)},300);return()=>clearTimeout(e)},[D,le]);const ia=()=>{C(""),le(""),w(!0)},Re=i.useCallback(async()=>{if(!M)try{const e={video:{facingMode:G,width:{ideal:1280},height:{ideal:720}}},s=await navigator.mediaDevices.getUserMedia(e);P.current=s,H.current&&(H.current.srcObject=s)}catch(e){console.error("Camera access failed:",e),c("danger","Camera access denied. Please allow camera permission."),sa(!0)}},[G,M,c]),L=i.useCallback(()=>{P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null)},[]),Me=i.useCallback((e,s=.7,r=800,t=600)=>new Promise(l=>{const n=document.createElement("canvas"),d=n.getContext("2d"),g=new Image;g.onload=()=>{let{width:u,height:x}=g;if(u>r||x>t){const v=Math.min(r/u,t/x);u*=v,x*=v}n.width=u,n.height=x,d.drawImage(g,0,0,u,x),n.toBlob(v=>{const _a=new File([v],"machine_photo.jpg",{type:"image/jpeg",lastModified:Date.now()});l(_a)},"image/jpeg",s)},g.src=URL.createObjectURL(e)}),[]),oa=i.useCallback(async()=>{if(!H.current||!oe.current)return;const e=oe.current,s=H.current,r=e.getContext("2d");e.width=s.videoWidth,e.height=s.videoHeight,r.drawImage(s,0,0),e.toBlob(async t=>{if(t){q(URL.createObjectURL(t));const l=await Me(t);Y(l),c("success","Photo captured successfully")}},"image/jpeg",.8)},[Me,c]),Fe=i.useCallback((e,s)=>{Ge(e),Xe(s),q(null),Y(null),Z(!0)},[]),ca=i.useCallback(async()=>{if(!te){c("warning","Please capture a photo");return}const s=await Se(te,$==="start"?"machine_start_photos":"machine_end_photos");if(s){if(F&&$==="end"){const r=[...k];r[re].machine_end_pic=s,S(r)}else{const r=$==="start"?"machine_start_pic":"machine_end_pic",t=[...m.machineReading];t[re][r]=s,y({...m,machineReading:t})}Z(!1),q(null),Y(null),L()}},[te,re,$,m,k,F,L,c,Se]),la=(e,s)=>{const r=[...m.machineReading];r[e][s]=null,y({...m,machineReading:r})},da=(e,s)=>{if(!e||!s)return 0;const r=parseFloat(s)-parseFloat(e);return r>=0?r.toFixed(2):0},_=(e,s,r)=>{const t=[...m.machineReading];t[e][s]=r,(s==="machine_start"||s==="machine_end")&&(t[e].actual_machine_hr=da(t[e].machine_start,t[e].machine_end)),y({...m,machineReading:t})},Ee=(e,s,r)=>{const t=[...k];if(s==="machine_end"){let d=r.replace(/[^0-9.]/g,"");const g=d.split(".");g.length>2&&(d=g[0]+"."+g.slice(1).join("")),t[e][s]=d}else t[e][s]=r;const l=parseFloat(t[e].start_reading)||0,n=parseFloat(t[e].machine_end);!isNaN(n)&&n>0?t[e].actual_machine_hr=(n-l>=0?n-l:0).toFixed(2):t[e].actual_machine_hr=0,S(t)},Pe=i.useCallback(async e=>{if(!e)return[];try{const s=await T(`/api/pending?project_id=${e}`);return console.log("pending",s),Array.isArray(s)?s:[]}catch(s){return console.error("Error fetching pending readings from server",s),[]}},[]),Ae=async e=>{y(s=>({...s,project_id:e.id,project_name:e.project_name})),se(e.operator_id||[]),C(e.customer_name),V([]),w(!1);try{const s=await Pe(e.id);s&&s.length>0?(c("info",`Found ${s.length} machine(s) with pending end readings.`),S(s),E(!0)):(c("success","No pending readings found. You can add new start readings."),E(!1))}catch(s){console.error("Error fetching pending readings:",s),c("danger","Failed to check project status from the server.")}},ma=e=>{e?(Ae(e),c("success","Customer added and selected successfully")):c("success","Customer added successfully, please search to select"),V([]),ie(!1)},ha=(e,s)=>{y(r=>({...r,[e]:s}))},ua=i.useCallback(async e=>{_e(!0);try{console.log("validReadings"),console.log(e);const s=e.map(r=>{const t={project_id:m.project_id,machine_id:r.machine_id,operator_id:r.operator_id,mode_id:r.mode_id,work_type_id:r.work_type_id,machine_start:r.machine_start,date:m.date,machine_start_pic:r.machine_start_pic};return de("/api/start",t)});await Promise.all(s)}finally{_e(!1)}},[m.date,m.project_id]),pa=async()=>{if(!m.project_id){c("danger","Please select a Customer.");return}p===2&&(m.machineReading=m.machineReading.map(t=>({...t,operator_id:o.id.toString()})));const e=[],s=[],r=[];if(m.machineReading.forEach((t,l)=>{const n=t.operator_id&&t.machine_id&&t.mode_id&&t.work_type_id&&t.machine_start,d=p===2?!!t.machine_start_pic:!0;n&&d?e.push(t):n?d||s.push(l+1):r.push(l+1)}),e.length===0){s.length>0?c("danger",`Start photo is required for row(s): ${s.join(", ")}. Please upload a photo.`):r.length>0?c("danger",`Incomplete data in row(s): ${r.join(", ")}. Please fill machine, mode, and start reading.`):c("danger","Please add at least one complete machine reading.");return}try{await ua(e),c("success",`${e.length} start reading(s) saved successfully.`);const t=await Pe(m.project_id);t.length>0?(S(t),E(!0)):(X(),c("success","Form cleared. Ready to add a new work log."))}catch{c("danger","Error saving start readings. Please try again.")}},ga=i.useCallback(async e=>{if(!e||!e.id)throw new Error("Invalid reading to update");const s={machine_end:parseFloat(e.machine_end).toFixed(2),machine_end_pic:e.machine_end_pic};return await de(`/api/end/${e.id}`,s)},[]),fa=async()=>{const e=[],s=[],r=[];if(k.forEach((t,l)=>{var u;const n=parseFloat(t.machine_end),d=parseFloat(t.start_reading)||0,g=((u=I.find(x=>x.id===parseInt(t.machine_id)))==null?void 0:u.machine_name)||`Machine #${t.machine_id}`;if(isNaN(n)){r.push(g);return}if(n<=d){s.push(g);return}p===2&&!t.machine_end_pic&&e.push(g)}),e.length>0){c("danger",`End photo is required for: ${e.slice(0,3).join(", ")}${e.length>3?` and ${e.length-3} more`:""}.`);return}if(s.length>0){c("danger",`End reading must be greater than start reading for: ${s.slice(0,3).join(", ")}${s.length>3?` and ${s.length-3} more`:""}.`);return}if(r.length>0){c("danger",`Invalid end reading (not a number) for: ${r.slice(0,3).join(", ")}${r.length>3?` and ${r.length-3} more`:""}.`);return}xe(!0);try{const t=k.map(n=>ga(n));await Promise.all(t),c("success","All end readings have been submitted successfully!"),ae(!0),setTimeout(()=>ae(!1),2500);const l=Ve();y(l),S([]),E(!1),C(""),se([]),w(!1),X(),c("success","Form reset. Ready for new entry.")}catch(t){c("danger","An error occurred while saving end readings."),console.error(t)}finally{xe(!1)}},Te=i.useCallback(e=>e?I.filter(s=>Array.isArray(s.operator_id)&&s.operator_id.includes(String(e))).map(s=>({value:s.id,label:s.machine_name})):[],[I]);return i.useEffect(()=>{if(!W){L();return}if(!M){const e=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent);we(e?"environment":"user")}},[W,M,L]),i.useEffect(()=>{!W||M||(L(),Re())},[G,W,M]),i.useEffect(()=>{p===2&&(o!=null&&o.id)&&Ye(o.id.toString())},[p,o==null?void 0:o.id]),a.jsxs("div",{className:"",children:[a.jsxs(We,{visible:ta,onClose:()=>J(!1),alignment:"center",children:[a.jsx($e,{children:a.jsx(ze,{children:"Add New Work Type"})}),a.jsxs(He,{children:[a.jsx(j,{children:"Work Type Name"}),a.jsx(N,{type:"text",placeholder:"e.g. Excavation, Heavy Lifting",value:ce,onChange:e=>be(e.target.value)})]}),a.jsxs(Le,{children:[a.jsx(h,{color:"secondary",onClick:()=>J(!1),children:"Cancel"}),a.jsx(h,{color:"primary",onClick:ra,children:"Save"})]})]}),a.jsxs("div",{fluid:!0,children:[De&&a.jsx(Sa,{color:"success",dismissible:!0,onClose:()=>ae(!1),children:"Form submitted successfully!"}),a.jsxs(U,{className:"",children:[a.jsx(ba,{className:"bg-primary text-white",children:a.jsxs("h1",{className:"mb-2 h4 d-flex align-items-center",children:[a.jsx(A,{icon:wa,className:"me-2"})," Daily Work"]})}),a.jsx(B,{className:"p-2",children:a.jsxs(Na,{children:[a.jsx(U,{className:"mb-4 border-0",color:"info",textColor:"dark",children:a.jsx(B,{className:"bg-info-subtle rounded rounded-lg",children:a.jsxs(O,{className:"g-3",children:[a.jsxs(f,{md:6,children:[a.jsx(j,{children:"Customer Name"}),a.jsxs(Oe,{children:[a.jsx(N,{type:"text",value:D,onChange:e=>{C(e.target.value),w(!0)},placeholder:"Search for a customer...",disabled:F}),m.project_name&&a.jsx(h,{type:"button",color:"danger",variant:"outline",onClick:()=>{y(Ve()),S([]),E(!1),C(""),w(!1)},children:"âœ•"}),a.jsx(h,{type:"button",color:"danger",variant:"outline",onClick:ia,children:"Show All"})]}),qe&&a.jsx("div",{className:"border rounded bg-white",style:{maxHeight:"150px",overflowY:"auto"},children:he.length>0?he.map(e=>a.jsxs("div",{className:"p-2 hover-bg-light",style:{cursor:"pointer"},onClick:()=>{Ae(e),C(e.customer_name),w(!1)},children:[a.jsx("div",{children:e.customer_name}),a.jsx("div",{className:"text-muted small",style:{fontSize:"0.85em"},children:e.mobile_number||"No Mobile"})]},e.id)):a.jsxs("div",{className:"p-2",children:[a.jsx("div",{children:"No Customer found."}),a.jsx(h,{color:"primary",size:"sm",className:"mt-2",onClick:()=>{aa(D),ie(!0)},children:"Add New Customer"})]})})]}),a.jsxs(f,{md:6,children:[a.jsx(j,{children:"Date "}),a.jsx(N,{type:"date",value:m.date||ee(),onChange:e=>ha("date",e.target.value),disabled:F||p===2})]})]})})}),F?a.jsx(U,{className:"mb-4 border-0",color:"warning",textColor:"dark",children:a.jsxs(B,{className:"bg-warning-subtle rounded rounded-lg",children:[a.jsx("h5",{className:"text-warning-emphasis mb-3 d-flex align-items-center",children:"Add Machine End Readings"}),k.map((e,s)=>{var g;const r=((g=Q.find(u=>u.value===e.operator_id))==null?void 0:g.label)||"N/A",t=ye.find(u=>u.id===parseInt(e.mode_id)),l=t?t.mode.charAt(0).toUpperCase()+t.mode.slice(1).replace(/-/g," "):"N/A",n=I.find(u=>u.id===parseInt(e.machine_id)),d=(n==null?void 0:n.machine_name)||"N/A";return a.jsx(U,{className:"mb-3",children:a.jsx(B,{children:a.jsxs(O,{className:"align-items-center gx-3",children:[a.jsx(f,{md:4,children:a.jsxs("div",{className:"p-2 border border-secondary rounded bg-light",children:[a.jsxs("p",{className:"mb-1",children:[a.jsx("strong",{children:"Operator:"})," ",r]}),a.jsxs("p",{className:"mb-0",children:[a.jsx("strong",{children:"Machine:"})," ",d]}),a.jsxs("p",{className:"mb-0",children:[a.jsx("strong",{children:"Mode:"})," ",l]})]})}),a.jsxs(f,{md:2,className:"text-center",children:[a.jsx(j,{children:"Total Reading"}),a.jsx("p",{className:"fw-bold fs-5 mb-0",children:(Math.max((parseFloat(e.machine_end)||0)-(parseFloat(e.start_reading)||0),0)||0).toFixed(2)})]}),a.jsx(f,{sm:4,children:a.jsxs(O,{className:"gx-2 align-items-end",children:[a.jsxs(f,{xs:6,children:[a.jsx(j,{children:"Start Reading"}),a.jsx(N,{type:"text",value:e.start_reading,readOnly:!0,disabled:!0})]}),a.jsxs(f,{xs:6,children:[a.jsxs(j,{children:["End Reading ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(N,{type:"text",inputMode:"numeric",pattern:"[0-9]*\\.?[0-9]*",value:e.machine_end||"",placeholder:"0",invalid:e.machine_end!==void 0&&e.machine_end!==""&&parseFloat(e.machine_end)<=parseFloat(e.start_reading),onChange:u=>{let x=u.target.value.replace(/[^0-9.]/g,"");const v=x.split(".");v.length>2&&(x=v[0]+"."+v.slice(1).join("")),Ee(s,"machine_end",x)}}),e.machine_end!==void 0&&e.machine_end!==""&&parseFloat(e.machine_end)<=parseFloat(e.start_reading)&&a.jsxs("small",{className:"text-danger d-block",children:["End reading must be greater than ",e.start_reading]})]})]})}),a.jsxs(f,{md:2,children:[a.jsxs(j,{children:["End Photo  ",p===2&&a.jsx("span",{style:{color:"red"},children:"*"})]}),e.machine_end_pic?a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx("span",{className:"text-success small",children:"âœ“ Captured"}),a.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>Ee(s,"machine_end_pic",null),children:a.jsx(A,{icon:Ue})})]}):a.jsx(h,{color:"primary",size:"sm",onClick:()=>Fe(s,"end"),disabled:!e.machine_end,className:"w-100",children:"ðŸ“· End Reading Photo"})]})]})})},e.id)})]})}):a.jsx(U,{className:"mb-4 border-0",color:"success",textColor:"dark",children:a.jsxs(B,{className:"bg-success-subtle rounded rounded-lg",children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-center md:mb-3",children:[a.jsx("h5",{className:"text-success mb-3 d-flex align-items-center",children:"Add Machine Start Readings"}),p===1&&a.jsxs("div",{className:"d-flex gap-2",children:[m.machineReading.length>1&&a.jsx(h,{color:"danger",variant:"outline",type:"button",size:"md",className:"d-flex align-items-center",onClick:()=>{if(m.machineReading.length<=1)return;const e=[...m.machineReading];e.pop(),y(s=>({...s,machineReading:e}))},children:"Remove Last"}),a.jsx(h,{color:"success",variant:"outline",type:"button",size:"md",className:"d-flex align-items-center",onClick:()=>y(e=>{var s;return{...e,machineReading:[...e.machineReading,{uid:Date.now().toString()+Math.random().toString(36).slice(2),operator_id:p===2&&((s=o==null?void 0:o.id)==null?void 0:s.toString())||"",machine_id:"",mode_id:"",mode:"",machine_start:"",machine_end:"",actual_machine_hr:0,machine_start_pic:null,machine_end_pic:null}]}}),children:"Add"})]})]}),a.jsx(O,{className:"g-1",children:m.machineReading.map((e,s)=>{var l;const r=I.find(n=>n.id===parseInt(e.machine_id)),t=(l=r==null?void 0:r.mode_id)!=null&&l.length?ye.filter(n=>r.mode_id.map(String).includes(String(n.id))).map(n=>({price_per_hour:n.price,id:n.id,value:n.id,label:n.mode.charAt(0).toUpperCase()+n.mode.slice(1).replace(/-/g," ")})):[];return a.jsxs(O,{className:"mb-2 gx-1",children:[p===1&&a.jsxs(f,{xs:12,md:3,className:"p-1",children:[a.jsxs(j,{children:["Select Operator ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(me,{options:Q,isSearchable:!0,placeholder:"Operators",value:Q.find(n=>n.value===e.operator_id)||null,onChange:n=>{_(s,"operator_id",n?n.value:""),_(s,"machine_id",""),_(s,"mode_id",""),_(s,"mode","")}})]}),a.jsxs(f,{xs:12,md:3,className:"p-1",children:[a.jsxs(j,{children:["Select Machine ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(me,{options:Te(e.operator_id||pe),isSearchable:!0,placeholder:"Machinery",value:Te(e.operator_id||pe).find(n=>n.value===e.machine_id)||null,onChange:n=>{_(s,"machine_id",n?n.value:""),_(s,"mode_id",""),_(s,"mode","")}})]}),a.jsxs(f,{xs:12,md:2,className:"p-1",children:[a.jsxs(j,{children:["Select Mode ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsx(me,{options:t,isSearchable:!1,placeholder:"Select Mode",isDisabled:!e.machine_id||t.length===0,value:t.find(n=>n.value===e.mode_id)||null,onChange:n=>{_(s,"mode_id",n?n.value:""),_(s,"price_per_hour",n?n.price_per_hour:0)}})]}),a.jsxs(f,{xs:12,md:3,className:"p-1",children:[a.jsxs(j,{children:["Work Type ",a.jsx("span",{style:{color:"red"},children:"*"})]}),a.jsxs(Oe,{children:[a.jsx(N,{type:"text",value:z[s]||"",onChange:n=>{R(d=>({...d,[s]:n.target.value})),b(d=>({...d,[s]:!0}))},placeholder:"Search work type..."}),z[s]&&a.jsx(h,{type:"button",color:"danger",variant:"outline",size:"sm",onClick:()=>{_(s,"work_type_id",""),R(n=>({...n,[s]:""})),b(n=>({...n,[s]:!1}))},children:"âœ•"}),!z[s]&&a.jsx(h,{type:"button",color:"primary",variant:"outline",size:"sm",onClick:()=>na(s),children:"Show All"})]}),Je[s]&&a.jsx("div",{className:"border rounded bg-white position-absolute",style:{maxHeight:"200px",overflowY:"auto",zIndex:1e3,width:"calc(100% - 0.5rem)"},children:ke(z[s]).length>0?ke(z[s]).map(n=>a.jsx("div",{className:"p-2 hover-bg-light",style:{cursor:"pointer"},onClick:()=>{_(s,"work_type_id",n.value),R(d=>({...d,[s]:n.label})),b(d=>({...d,[s]:!1}))},children:n.label},n.value)):a.jsxs("div",{className:"p-2",children:[a.jsx("div",{children:"No work type found."}),a.jsx(h,{color:"primary",size:"sm",className:"mt-2",onClick:()=>{Ne(s),J(!0),b(n=>({...n,[s]:!1}))},children:"Add New Work Type"})]})})]}),a.jsxs(f,{xs:12,md:1,className:"p-1",children:[a.jsx(j,{children:"Start Reading"}),a.jsx(N,{type:"text",inputMode:"numeric",pattern:"[0-9.:]*",value:e.machine_start===0?"":e.machine_start,placeholder:"0",onChange:n=>{let d=n.target.value.replace(/[^0-9.:]/g,"");_(s,"machine_start",d===""?0:d)}})]}),a.jsxs(f,{xs:12,md:2,className:"p-1",children:[a.jsx(j,{children:"Start Reading Photo "}),e.machine_start_pic?a.jsxs("div",{className:"d-flex align-items-center gap-2 w-100",children:[a.jsx("span",{className:"text-muted small",children:"Photo captured"}),a.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>la(s,"machine_start_pic"),children:a.jsx(A,{icon:Ue})})]}):a.jsx(h,{color:"primary",size:"sm",onClick:()=>Fe(s,"start"),disabled:!e.machine_start,className:"w-100",children:"ðŸ“· Start Reading Photo"})]})]},e.uid||s)})})]})}),a.jsx("div",{className:"d-flex justify-content-center",children:F?a.jsxs(h,{color:"warning",size:"lg",className:"px-5 d-flex align-items-center",onClick:fa,disabled:je,children:[a.jsx(A,{icon:Be,className:"me-2"})," ",je?"Saving...":"Save End Readings"]}):a.jsxs(h,{color:"danger",size:"lg",className:"px-5 d-flex align-items-center",onClick:pa,disabled:fe,children:[a.jsx(A,{icon:Be,className:"me-2"})," ",fe?"Saving...":"Save Start Readings"]})})]})})]}),a.jsxs(We,{visible:W,onClose:()=>Z(!1),size:"lg",alignment:"center",children:[a.jsxs($e,{className:"d-flex align-items-center justify-content-between",children:[a.jsx("div",{className:"d-flex align-items-center",children:a.jsx(ze,{className:"me-3",children:$==="start"?"ðŸ“¸ Capture Start Photo":"ðŸ“· Capture End Photo"})}),a.jsxs("div",{className:"d-flex align-items-center gap-3",children:[P.current&&a.jsx("span",{className:"text-muted small",children:((Ie=P.current.getVideoTracks()[0])==null?void 0:Ie.getSettings().facingMode)==="environment"?"Rear Camera Active":"Front Camera Active"}),a.jsx(h,{color:"primary",variant:"outline",size:"sm",className:"rounded-pill px-3 fw-semibold shadow-sm",onClick:()=>{we(e=>e==="environment"?"user":"environment")},children:G==="environment"?"Switch to Front":"Switch to Rear"})]})]}),a.jsx(He,{children:a.jsx("div",{className:"text-center",children:ge?a.jsxs("div",{children:[a.jsx("div",{className:"mb-3",children:a.jsx("img",{src:ge,alt:"Captured",className:"img-fluid rounded",style:{maxHeight:"400px",objectFit:"cover"}})}),a.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[a.jsx(h,{color:"secondary",onClick:()=>{q(null),Y(null),Re()},children:"Retake"}),a.jsx(h,{color:"success",onClick:ca,children:"Submit Photo"})]})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"position-relative mb-3",children:[a.jsx("video",{ref:H,autoPlay:!0,playsInline:!0,muted:!0,className:"w-100 rounded",style:{maxHeight:"400px",objectFit:"cover"}}),a.jsx("canvas",{ref:oe,style:{display:"none"}})]}),a.jsxs(h,{color:"primary",size:"lg",onClick:oa,className:"mb-3",children:[a.jsx(A,{icon:ka,className:"me-2"})," Capture Photo"]})]})})}),a.jsx(Le,{children:a.jsx(h,{color:"secondary",onClick:()=>Z(!1),children:"Cancel"})})]}),a.jsx(Ca,{visible:Ke,onClose:()=>ie(!1),onSuccess:ma,initialName:ea})]})]})};export{Xa as default};
