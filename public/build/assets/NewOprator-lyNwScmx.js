import{r as j,b as w,u as M,j as e}from"./index-WEbTLRLZ.js";import{a as v,p as F,b as P}from"./api-Ba1wfMeh.js";import{C as D,a as L}from"./CCardBody-CtNgr8m7.js";import{C as O}from"./CCardHeader-LFhc_ZAM.js";import{C as T}from"./CForm-J01-VhG4.js";import{a as l,b as o,d as y}from"./index.esm-CZeMoYDH.js";import{C as c}from"./CFormLabel-D964ZFYD.js";import{C as d}from"./CFormInput-D3dwui72.js";import{C as $}from"./CFormTextarea-WC5Zi1sh.js";import{C as N}from"./CFormSelect-CH5m41hJ.js";import"./CFormControlWrapper-DljGJ9Vz.js";const Q=()=>{const[n,m]=j.useState({name:"",mobile:"",address:"",bank_name:"",account_number:"",adhar_number:"",ifsc_code:"",pan_number:"",gst_no:"",payment:"",type:"1",project_id:"",show:!0}),[A,f]=j.useState([]),[b,C]=j.useState([]),[u,g]=j.useState([]),{showToast:i}=w(),_=M();j.useEffect(()=>{v("/api/projects").then(r=>f(Array.isArray(r)?r:[])).catch(r=>{console.error(r),f([])}),v("/api/machine-operators").then(r=>C(Array.isArray(r)?r:[])).catch(r=>{console.error(r),C([])})},[]);const p=r=>{const{name:a,value:s,type:h,checked:t}=r.target;m(x=>({...x,[a]:h==="checkbox"?t:s}))},S=async r=>{var s,h;if(r.preventDefault(),!n.name.trim()){i("danger","Name is required");return}if(!n.mobile||n.mobile.length!==10){i("danger","Mobile number must be 10 digits");return}if(!n.address.trim()){i("danger","Address is required");return}if(!n.type){i("danger","Role is required");return}if(n.type==="0"&&!n.project_id){i("danger","Project is required for Supervisor");return}if((n.type==="0"||n.type==="1")&&!n.payment){i("danger","Payment is required for Supervisor and Operator");return}if(n.type==="2"&&!n.gst_no.trim()){i("danger","GST Number is required for Vendor");return}if(n.bank_name&&!n.account_number){i("danger","Account Number is required when Bank Name is provided");return}if(n.account_number&&!n.bank_name){i("danger","Bank Name is required when Account Number is provided");return}if((n.bank_name||n.account_number)&&!n.ifsc_code){i("danger","IFSC Code is required when bank details are provided");return}const a={...n,project_id:n.type==="1"||n.type==="2"?"0":n.project_id,payment:n.type==="2"?"0":n.payment};try{const t=await F("/api/operators",a),x=(t==null?void 0:t.id)||((s=t==null?void 0:t.data)==null?void 0:s.id);x&&u.length>0&&await E(x,u),i("success","User created successfully!"),m({name:"",mobile:"",address:"",bank_name:"",account_number:"",adhar_number:"",ifsc_code:"",pan_number:"",gst_no:"",payment:"",type:"",project_id:"",commission:"",show:!0}),g([]),_("/OpratorList")}catch(t){console.error("Error creating user:",((h=t.response)==null?void 0:h.data)||t.message),i("danger","Failed to create user")}},E=async(r,a)=>{try{for(const s of a){const h=b.find(t=>t.id===s);if(h){const t=Array.isArray(h.operator_id)?h.operator_id.map(String):[];if(!t.includes(String(r))){const x=[...t,String(r)];await P(`/api/machine-operators/${s}`,{operator_id:x})}}}i("success","Machines assigned successfully!")}catch(s){console.error("Error assigning machines:",s),i("danger","Failed to assign some machines")}},k=r=>{r&&!u.includes(r)&&g([...u,r])},q=r=>{g(u.filter(a=>a!==r))};return e.jsxs(D,{className:"mb-4",children:[e.jsx(O,{children:e.jsx("strong",{children:"Create operator"})}),e.jsx(L,{children:e.jsxs(T,{onSubmit:S,children:[e.jsxs(l,{className:"mb-3",children:[e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(d,{type:"text",name:"name",placeholder:"Enter Name",value:n.name,onChange:p,required:!0})]}),e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["Mobile ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(d,{type:"text",name:"mobile",placeholder:"Enter Mobile Number (10 digits)",maxLength:10,value:n.mobile,onChange:r=>{const a=r.target.value;/^\d*$/.test(a)&&a.length<=10&&m(s=>({...s,mobile:a}))},required:!0})]})]}),e.jsx(l,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsxs(c,{children:["Address ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx($,{name:"address",placeholder:"Enter Address",value:n.address,onChange:p,required:!0})]})}),e.jsxs(l,{className:"mb-3",children:[e.jsxs(o,{md:4,children:[e.jsx(c,{children:"Bank Name"}),e.jsx(d,{name:"bank_name",placeholder:"Enter Bank Name",value:n.bank_name,onChange:p})]}),e.jsxs(o,{md:4,children:[e.jsx(c,{children:"Account Number"}),e.jsx(d,{name:"account_number",placeholder:"Enter Account Number",maxLength:18,value:n.account_number,onChange:r=>{const a=r.target.value;/^\d*$/.test(a)&&m(s=>({...s,account_number:a}))}})]}),e.jsxs(o,{md:4,children:[e.jsx(c,{children:"IFSC Code"}),e.jsx(d,{name:"ifsc_code",placeholder:"Enter IFSC Code (11 characters)",maxLength:11,value:n.ifsc_code,onChange:r=>{const a=r.target.value.toUpperCase();/^[A-Z0-9]*$/.test(a)&&m(s=>({...s,ifsc_code:a}))}})]})]}),e.jsxs(l,{className:"mb-3",children:[e.jsxs(o,{md:6,children:[e.jsx(c,{children:"Aadhar Number"}),e.jsx(d,{name:"adhar_number",placeholder:"Enter Aadhar Number (12 digits)",maxLength:12,value:n.adhar_number,onChange:r=>{const a=r.target.value;/^\d*$/.test(a)&&m(s=>({...s,adhar_number:a}))}})]}),e.jsxs(o,{md:6,children:[e.jsx(c,{children:"PAN Number"}),e.jsx(d,{name:"pan_number",placeholder:"Enter PAN Number (10 characters)",maxLength:10,value:n.pan_number,onChange:r=>{const a=r.target.value.toUpperCase();/^[A-Z0-9]*$/.test(a)&&m(s=>({...s,pan_number:a}))}})]})]}),n.type==="0"&&e.jsxs(l,{className:"mb-3",children:[e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["Payment ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(d,{type:"number",name:"payment",placeholder:"Enter Payment Amount",min:"0",value:n.payment,onKeyDown:r=>{["-","e","E"].includes(r.key)&&r.preventDefault()},onChange:p,required:!0})]}),e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["Select Project ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(N,{name:"project_id",value:n.project_id,onChange:p,required:!0,children:[e.jsx("option",{value:"",children:"Select Project"}),A.map(r=>e.jsx("option",{value:String(r.id),children:r.project_name},r.id))]})]})]}),n.type==="1"&&e.jsxs(l,{className:"mb-3",children:[e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["Payment ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(d,{type:"number",name:"payment",placeholder:"Enter Payment Amount",min:"0",value:n.payment,onKeyDown:r=>{["-","e","E"].includes(r.key)&&r.preventDefault()},onChange:p,required:!0})]}),e.jsxs(o,{md:6,children:[e.jsx(c,{children:"Commission "}),e.jsx(d,{type:"number",name:"commission",placeholder:"Enter Commission Amount",min:"0",value:n.commission,onKeyDown:r=>{["-","e","E"].includes(r.key)&&r.preventDefault()},onChange:p})]})]}),n.type==="2"&&e.jsx(l,{className:"mb-3",children:e.jsxs(o,{md:6,children:[e.jsxs(c,{children:["GST Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(d,{name:"gst_no",placeholder:"Enter GST Number (15 characters)",maxLength:15,value:n.gst_no,onChange:r=>{const a=r.target.value.toUpperCase();/^[0-9A-Z]*$/.test(a)&&m(s=>({...s,gst_no:a}))},required:!0})]})}),e.jsx(l,{className:"mb-3",children:e.jsxs(o,{md:12,children:[e.jsx(c,{children:"Assign Machines"}),u.length>0&&e.jsxs("div",{className:"p-2 border rounded bg-light mb-2",children:[e.jsx("h6",{children:"Selected Machines:"}),u.map(r=>{const a=b.find(s=>s.id===r);return a?e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{children:["â€¢ ",a.machine_name]}),e.jsx(y,{color:"danger",size:"sm",variant:"outline",onClick:()=>q(r),children:"Remove"})]},r):null})]}),e.jsxs(N,{value:"",onChange:r=>k(parseInt(r.target.value)),children:[e.jsx("option",{value:"",children:"-- Select Machine to Add --"}),b.filter(r=>!u.includes(r.id)).map(r=>e.jsx("option",{value:r.id,children:r.machine_name},r.id))]})]})}),e.jsxs(l,{className:"mt-3",children:[e.jsx(o,{xs:"auto",children:e.jsx(y,{type:"submit",color:"primary",children:"Submit"})}),e.jsx(o,{xs:"auto",children:e.jsx(y,{type:"button",color:"secondary",onClick:()=>_("/OpratorList"),children:"Close"})})]})]})})]})};export{Q as default};
