import{c as g,u as v,e as _,r as s,b as h,j as c}from"./index-BM-84WYk.js";import{a as S,b as I}from"./api-BUyL__Lx.js";import b from"./Invoice-qnod1nJY.js";import{u as j}from"./DefaultLayout-DWs0eMK8.js";/* empty css                */import"./index.esm-CTbBYC_z.js";import"./CCardBody-CaiSzWxA.js";import"./CCardHeader-BQ0n1MDF.js";import"./CForm-B41EQLwC.js";import"./CFormLabel-BSmkn9I7.js";import"./CInputGroup-CjoHj6nu.js";import"./CFormInput-BRkWGjKH.js";import"./CFormControlWrapper-D5n2fvDj.js";import"./CFormControlValidation-lQ4ZFYm7.js";import"./CInputGroupText-4d8tVeae.js";import"./cil-search-CDkY_4k-.js";import"./cil-x-0440B5Ce.js";import"./CFormSelect-sGLx-yuQ.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-CaWWu20M.js";import"./CNavItem-B_dTsj2G.js";const Q=()=>{const{id:a}=g(),m=v(),d=_(),i=new URLSearchParams(d.search).get("convertTo"),[l,p]=s.useState(null),[u,f]=s.useState(!0),[y,T]=s.useState(!1),{showToast:r}=h(),{t:o}=j("global");s.useEffect(()=>{(async()=>{try{const e=await S(`/api/order/${a}`);console.log("Fetched order:",e),e?(p({projectId:e.project_id||null,projectName:e.customer_name||"N/A",customer_id:e.id||null,customer:{name:e.customer_name||"Unknown",address:e.address||"N/A",mobile:e.mobile_number||"N/A"},lat:e.lat||"",long:"",payLater:e.payLater||!1,isSettled:e.isSettled||!1,invoiceDate:e.invoiceDate,deliveryTime:e.deliveryTime||"",deliveryDate:e.deliveryDate,invoiceType:i?parseInt(i):e.invoiceType||3,items:(e.items||[]).map(t=>({work_type:t.work_type||"",qty:t.qty||0,price:t.price||0,total_price:t.total_price||0,remark:t.remark||null})),orderStatus:i?parseInt(i):e.orderStatus,totalAmount:e.totalAmount||0,discount:e.discount||0,balanceAmount:e.finalAmount-e.paidAmount,paidAmount:e.paidAmount||0,finalAmount:e.finalAmount||0,paymentType:e.paymentType||0}),T(!0)):r("danger","No order data found")}catch(e){console.error("Fetch order error:",e),r("danger",o("TOAST.fetch_order_failed"))}finally{f(!1)}})()},[a,i,r,o]);const A=async n=>{try{const e={...n,id:a,project_id:n.projectId,remainingBalance:n.finalAmount-n.paidAmount};console.log("Updating order:",e);const t=await I(`/api/order/${a}`,e);t!=null&&t.success?(r("success",o("TOAST.order_updated")),m(`/invoice-details/${a}`)):r("danger",(t==null?void 0:t.message)||o("TOAST.update_failed"))}catch(e){console.error("Update error:",e),r("danger",o("TOAST.update_error"))}};return u||!y?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(b,{editMode:!0,initialData:l,onSubmit:A})};export{Q as default};
