import{r as a,u as S,j as e,C as T}from"./index-BaFO0fBD.js";import{a as C,b as E}from"./api-BUyL__Lx.js";import{C as k,a as P}from"./CCardBody-C_DcNhkI.js";import{C as A}from"./CCardHeader-uQH1AYuq.js";import{d as _}from"./index.esm-6sS0QU7y.js";import{C as d}from"./RawMaterial-D7bfBri4.js";import{C as L,a as F,b as m,c as i,d as H,e as o}from"./CTable-BC39XzuD.js";import{C as R}from"./CFormSwitch-ClNXJ2kJ.js";import"./CFormLabel-zcG2lLqz.js";const $=()=>{const[h,u]=a.useState([]),[l,b]=a.useState(!0),[x,n]=a.useState({}),[c,p]=a.useState(""),[U,y]=a.useState([]),N=S();a.useEffect(()=>{if(c){const s=setTimeout(()=>{p("")},2e3);return()=>clearTimeout(s)}},[c]);const v=async()=>{try{const s=await C("/api/appUsers");console.log("All the users from users:",s.data);const t=s.data.filter(r=>r.type===2);console.log("Filtered users (type = 2):",t),y(t)}catch(s){console.error("Error fetching Users:",s),showToast("danger","Error fetching Users")}},g=async()=>{var s,t;try{const r=await C("/api/myProjects");u(Array.isArray(r)?r:[]),b(!1),n({})}catch(r){console.error("Error fetching projects:",r),u([]),n({general:((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch projects. Please check the server and try again."})}};a.useEffect(()=>{g(),v()},[]);const w=async(s,t)=>{var r,j;try{await E(`/api/projects/${s}`,{is_visible:!t}),p("Project visibility updated successfully!"),await g()}catch(f){console.error("Error updating visibility:",f),n({general:((j=(r=f.response)==null?void 0:r.data)==null?void 0:j.message)||"Failed to update project visibility."})}};return l?e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(T,{color:"primary",size:"lg"}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading customers..."})]}):e.jsx("div",{className:"container-lg p-2",children:e.jsxs(k,{children:[e.jsxs(A,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Customers"}),e.jsx(_,{color:"danger",onClick:()=>N("/projects/new"),children:"New Customer"})]}),e.jsxs(P,{children:[c&&e.jsx(d,{color:"success",children:c}),x.general&&e.jsx(d,{color:"danger",children:x.general}),l&&e.jsx(d,{color:"info",children:"Loading projects..."}),e.jsx("div",{className:"table-responsive",style:{width:"100%",overflowX:"auto",overflowY:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#fff"},children:e.jsxs(L,{hover:!0,striped:!0,bordered:!0,color:"light",className:"mb-0",children:[e.jsx(F,{style:{position:"sticky",top:0,backgroundColor:"#f8f9fa",zIndex:10},children:e.jsxs(m,{children:[e.jsx(i,{className:"text-center align-middle",children:"SR. NO."}),e.jsx(i,{className:"text-center align-middle",children:"Customer Name"}),e.jsx(i,{className:"text-center align-middle",children:"Location"}),e.jsx(i,{className:"text-center align-middle",children:"GST Number"}),e.jsx(i,{className:"text-center align-middle",children:"Visible"})]})}),e.jsx(H,{children:h.length>0?h.map((s,t)=>e.jsxs(m,{children:[e.jsx(o,{children:t+1}),e.jsx(o,{children:s.customer_name}),e.jsx(o,{children:s.work_place}),e.jsx(o,{children:s.gst_number||"N/A"}),e.jsx(o,{children:e.jsx(R,{checked:s.is_visible,onChange:()=>w(s.id,s.is_visible),disabled:l})})]},s.id)):e.jsx(m,{children:e.jsx(o,{colSpan:"9",className:"text-center",children:"No projects found."})})})]})})]})]})})};export{$ as default};
