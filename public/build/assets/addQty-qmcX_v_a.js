import{b as L,r as u,j as e}from"./index-Bp6YZ4a_.js";import{b as E}from"./api-BUyL__Lx.js";import{r as A,p as M}from"./Feilds-DKJTpBq7.js";import{u as B,a as T,b as w,c as Q,d as N,e as R}from"./DefaultLayout-Cl1ShzgU.js";import{a as d,b as s,d as j}from"./index.esm-CYpkJS97.js";import{C as r}from"./CFormLabel-D4tkwmcW.js";import{C as i}from"./CFormInput-Bho2i8i0.js";import{C as h}from"./CFormSelect-Dyi_UavP.js";import{C as D}from"./CFormCheck-CLKjKTIZ.js";import"./cil-user-Dlmw-Gem.js";import"./RawMaterial-DQRsRjmM.js";import"./CNavItem-DIKN9LSg.js";import"./CFormControlWrapper-CHuDwT-y.js";import"./CFormControlValidation-6izUS8cV.js";const Z=({visible:_,onClose:p,material:m,refreshList:g})=>{const{showToast:x}=L(),{t:c}=B("global"),[a,y]=u.useState({current_stock:0,unit:"",price:0,total:0,add_qty:0,contact:"",payment_by:"",payment_type:"",expense_flag:!1}),C=["kg","pcs","mg","ltr","bag"];u.useEffect(()=>{var t;if(m){const n=((t=m.logs)==null?void 0:t[0])||{};y({current_stock:n.current_stock||0,unit:n.unit||"",price:n.price||0,total:n.total||0,add_qty:0,expense_flag:!1})}},[m]);const l=t=>{const{name:n,type:v,value:f,checked:k}=t.target;y(F=>{const o={...F,[n]:v==="checkbox"?!!k:f};if(n==="add_qty"||n==="price"){const S=parseFloat(o.current_stock)+(parseFloat(o.add_qty)||0),q=parseFloat(o.price)||0;o.total=S*q}return o})},b=async()=>{try{await E(`/api/rawMaterial/addQty/${m.id}`,{add_qty:a.add_qty,price:a.price,unit:a.unit,contact:a.contact,payment_by:a.payment_by,payment_type:a.payment_type,expense_flag:!!a.expense_flag}),x("success","Quantity added successfully!"),g(),p()}catch(t){console.error(t),x("danger","Failed to update quantity")}};return e.jsxs(T,{visible:_,onClose:p,children:[e.jsx(w,{onClose:p,children:e.jsx(Q,{children:"Add Quantity"})}),e.jsxs(N,{children:[e.jsxs(d,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Current Stock"}),e.jsx(i,{value:a.current_stock,readOnly:!0})]}),e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Unit *"}),e.jsxs(h,{name:"unit",value:a.unit,onChange:l,children:[e.jsx("option",{value:"",children:"-- Select Unit --"}),C.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs(d,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Price"}),e.jsx(i,{name:"price",type:"number",min:"0",step:"0.01",value:a.price,onChange:t=>{const n=t.target.value.replace(/[^0-9.]/g,"");y({...a,price:n})}})]}),e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Total"}),e.jsx(i,{value:a.total,readOnly:!0})]})]}),e.jsx(d,{children:e.jsxs(s,{md:12,children:[e.jsx(r,{children:"Add Qty"}),e.jsx(i,{name:"add_qty",type:"number",min:"0",step:"1",value:a.add_qty,placeholder:"Enter quantity to add",onChange:t=>{const n=t.target.value.replace(/[^0-9]/g,"");y({...a,add_qty:n})}})]})}),e.jsxs(d,{className:"mb-3",children:[e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"contact",children:e.jsx("p",{children:c("LABELS.contact")})}),e.jsx(i,{type:"text",id:"contact",placeholder:c("LABELS.enter_contact"),name:"contact",value:a.contact,onChange:l,maxLength:10,inputMode:"numeric"})]}),e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"payment_by",children:e.jsx("p",{children:c("LABELS.payment_by")})}),e.jsxs(h,{id:"payment_by",name:"payment_by",value:a.payment_by,onChange:l,children:[e.jsx("option",{value:"",children:c("LABELS.select_payment_by")}),A.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"payment_type",children:e.jsx("p",{children:c("LABELS.payment_type")})}),e.jsxs(h,{id:"payment_type",name:"payment_type",value:a.payment_type,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:"Select Payment Type"}),M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})]}),e.jsx(d,{className:"mb-2",children:e.jsx(s,{children:e.jsx(D,{type:"checkbox",name:"expense_flag",id:"expense_flag",label:"Add in Expense Record...",checked:a.expense_flag,onChange:l})})})]}),e.jsxs(R,{children:[e.jsx(j,{color:"secondary",onClick:p,children:"Cancel"}),e.jsx(j,{color:"primary",onClick:b,children:"Save"})]})]})};export{Z as default};
